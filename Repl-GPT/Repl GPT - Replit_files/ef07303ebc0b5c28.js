;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="42301948-a6b1-107f-64d1-51c7d798ef60")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,764767,(e,t,n)=>{"use strict";var r=e.i(439725),i=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===r.default||void 0===r.default.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||i.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||i.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||i.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=i.DEFAULT_MAX_PENDING};i.DEFAULT_TIMEOUT=0,i.DEFAULT_MAX_OCCUPATION_TIME=0,i.DEFAULT_MAX_EXECUTION_TIME=0,i.DEFAULT_MAX_PENDING=1e3,i.prototype.acquire=function(e,t,n,i){if(Array.isArray(e))return this._acquireBatch(e,t,n,i);if("function"!=typeof t)throw Error("You must pass a function to execute");var o=null,a=null,s=null;"function"!=typeof n&&(i=n,n=null,s=new this.Promise(function(e,t){o=e,a=t})),i=i||{};var p=!1,l=null,u=null,c=null,d=this,y=function(t,r,i){u&&(clearTimeout(u),u=null),c&&(clearTimeout(c),c=null),t&&(d.queues[e]&&0===d.queues[e].length&&delete d.queues[e],d.domainReentrant&&delete d.domains[e]),p||(s?r?a(r):o(i):"function"==typeof n&&n(r,i),p=!0),t&&d.queues[e]&&d.queues[e].length>0&&d.queues[e].shift()()},f=function(n){if(p)return y(n);l&&(clearTimeout(l),l=null),d.domainReentrant&&n&&(d.domains[e]=r.default.domain);var o=i.maxExecutionTime||d.maxExecutionTime;if(o&&(c=setTimeout(function(){d.queues[e]&&y(n,Error("Maximum execution time is exceeded "+e))},o)),1===t.length){var a=!1;try{t(function(e,t){a||(a=!0,y(n,e,t))})}catch(e){a||(a=!0,y(n,e))}}else d._promiseTry(function(){return t()}).then(function(e){y(n,void 0,e)},function(e){y(n,e)})};d.domainReentrant&&r.default.domain&&(f=r.default.domain.bind(f));var T=i.maxPending||d.maxPending;if(d.queues[e])if(d.domainReentrant&&r.default.domain&&r.default.domain===d.domains[e])f(!1);else if(d.queues[e].length>=T)y(!1,Error("Too many pending tasks in queue "+e));else{var h=function(){f(!0)};i.skipQueue?d.queues[e].unshift(h):d.queues[e].push(h);var g=i.timeout||d.timeout;g&&(l=setTimeout(function(){l=null,y(!1,Error("async-lock timed out in queue "+e))},g))}else d.queues[e]=[],f(!0);var v=i.maxOccupationTime||d.maxOccupationTime;if(v&&(u=setTimeout(function(){d.queues[e]&&y(!1,Error("Maximum occupation time is exceeded in queue "+e))},v)),s)return s},i.prototype._acquireBatch=function(e,t,n,r){"function"!=typeof n&&(r=n,n=null);var i=this,o=e.reduceRight(function(e,t){return function(n){i.acquire(t,e,n,r)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===o.length?o(function(n,r){n?t(n):e(r)}):e(o())});o(n)},i.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},i.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},t.exports=i},650392,(e,t,n)=>{"use strict";t.exports=e.r(764767)},267710,644464,17886,e=>{"use strict";var t=e.i(297083),n=e.i(817556),r=e.i(862927),i=e.i(650392),o=e.i(906368);function a(e,t){return"string"==typeof e&&(e=Error(e)),o.withScope(function(n){n.setTag("ai-chat",!0),t&&n.setExtras(t),o.captureException(e)}),e}e.s(["sendErrorToSentry",()=>a],644464);var s=e.i(960933);e.i(837399),s.Type.Object({replId:s.Type.Union([s.Type.String(),s.Type.Null()]),orgId:s.Type.Optional(s.Type.String())}),s.Type.Object({userId:s.Type.Number(),orgId:s.Type.Optional(s.Type.String()),replId:s.Type.Optional(s.Type.String())});var p=s.Type.Object({token:s.Type.String()}),l=s.Type.Object({isAuthorized:s.Type.Literal(!0),code:s.Type.Literal("authorized"),message:s.Type.String()}),u=s.Type.Object({isAuthorized:s.Type.Literal(!1),code:s.Type.Union([s.Type.Literal("feature_disabled"),s.Type.Literal("feature_unsupported_for_non_teams"),s.Type.Literal("feature_unsupported_for_replit_teams"),s.Type.Literal("feature_unsupported_for_teams_edu"),s.Type.Literal("feature_unsupported_for_teams_pro"),s.Type.Literal("feature_unsupported_for_teams_free"),s.Type.Literal("insufficient_permissions"),s.Type.Literal("insufficient_quota"),s.Type.Literal("insufficient_budget"),s.Type.Literal("requires_payment_method"),s.Type.Literal("requires_active_subscription")]),message:s.Type.String()}),c=s.Type.Union([l,u]);s.Type.Object({basicModel:c,advancedModel:c,paidAgent:c,freeAgent:c,basicAssistant:c,advancedAssistant:c,modelFarm:c,openRouter:c,openAI:c,anthropic:c,gemini:c});var d={},y=new i.default;function f(e,i,o){return(0,t._)(function(){return(0,n._)(this,function(s){return[2,y.acquire(null!=e?e:"non-repl-key",function(){return(0,t._)(function(){var s,l,u;return(0,n._)(this,function(c){switch(c.label){case 0:if((s=d[i])&&new Date().getTime()<s.expiration)return[2,s.token];return[4,(0,t._)(function(){var t;return(0,n._)(this,function(n){switch(n.label){case 0:return[4,fetch("/ai/auth",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({replId:e,orgId:o})})];case 1:return[4,n.sent().json()];case 2:if(t=n.sent(),!r.Value.Check(p,t))throw a("Authentication to chat service failed",{detail:t});return[2,t.token]}})})()];case 1:return l=c.sent(),u=new Date().getTime()+18e5,d[i]={token:l,expiration:u},[2,l]}})})()})]})})()}e.s(["auth",()=>f],267710);var T=function(){var e=window.location.hostname;return e.includes("replit.com")&&!e.includes("staging.replit.com")};e.s(["isEnvProduction",()=>T],17886)},660670,806240,230153,351677,187822,170039,813702,281128,957410,e=>{"use strict";e.i(227062);var t,n,r,i,o,a,s,p,l,u,c,d,y,f,T,h,g,v,m,S,E,b,R,I,C,O,A,_,k,U,w,N,D,P,M,x,j,L,B,F,G,q,V,$,W,z,H,K,Y,Q,X,J,Z,ee,et,en,er,ei=e.i(627922),eo=e.i(878420),ea=e.i(64386),es=e.i(960933),ep={codec:ei.BinaryCodec,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!0,sessionDisconnectGraceMs:15e3,connectionTimeoutMs:1e4,handshakeTimeoutMs:1e4};(0,eo._)({},ep);var el=(0,ea._)((0,eo._)({},ep),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),eu=es.Type.Object({token:es.Type.String()}),ec=((t={})[t.AGENT_STATE_UNKNOWN=0]="AGENT_STATE_UNKNOWN",t[t.AGENT_STATE_RUNNING=1]="AGENT_STATE_RUNNING",t[t.AGENT_STATE_PAUSING=2]="AGENT_STATE_PAUSING",t[t.AGENT_STATE_PAUSED=3]="AGENT_STATE_PAUSED",t[t.AGENT_STATE_NOT_STARTED=4]="AGENT_STATE_NOT_STARTED",t),ed=((n={})[n.AGENT_FEEDBACK_UNKNOWN=0]="AGENT_FEEDBACK_UNKNOWN",n[n.AGENT_FEEDBACK_THUMB_UP=1]="AGENT_FEEDBACK_THUMB_UP",n[n.AGENT_FEEDBACK_THUMB_DOWN=2]="AGENT_FEEDBACK_THUMB_DOWN",n),ey=((r={})[r.SECRET_UNKNOWN=0]="SECRET_UNKNOWN",r[r.SECRET_COMPLETED=1]="SECRET_COMPLETED",r[r.SECRET_IGNORED=2]="SECRET_IGNORED",r),ef=((i={})[i.UNKNOWN=0]="UNKNOWN",i[i.LOVABLE=1]="LOVABLE",i[i.BOLT=2]="BOLT",i[i.REPLIT=3]="REPLIT",i[i.OTHER_GITHUB=4]="OTHER_GITHUB",i[i.FIGMA=5]="FIGMA",i[i.VERCEL=6]="VERCEL",i[i.BITBUCKET=7]="BITBUCKET",i),eT=((o={})[o.UNSPECIFIED=0]="UNSPECIFIED",o[o.PENDING=1]="PENDING",o[o.IN_PROGRESS=2]="IN_PROGRESS",o[o.COMPLETED=3]="COMPLETED",o[o.COMPLETED_PENDING_REVIEW=4]="COMPLETED_PENDING_REVIEW",o),eh=((a={})[a.STEP_UNKNOWN=0]="STEP_UNKNOWN",a[a.STEP_NOT_STARTED=1]="STEP_NOT_STARTED",a[a.STEP_IN_PROGRESS=2]="STEP_IN_PROGRESS",a[a.STEP_COMPLETE=3]="STEP_COMPLETE",a[a.STEP_FAILED=4]="STEP_FAILED",a[a.STEP_ABORTED=5]="STEP_ABORTED",a),eg=((s={})[s.UNKNOWN=0]="UNKNOWN",s[s.NEON_DATABASE=1]="NEON_DATABASE",s),ev=((p={})[p.NONE=0]="NONE",p[p.FLASK_VANILLA_JS=1]="FLASK_VANILLA_JS",p[p.PYTHON_API=2]="PYTHON_API",p[p.STREAMLIT=3]="STREAMLIT",p[p.FULLSTACK_JS=4]="FULLSTACK_JS",p[p.GAMESTACK_JS=5]="GAMESTACK_JS",p[p.CUSTOM=6]="CUSTOM",p[p.EXPO=7]="EXPO",p[p.AGENT=8]="AGENT",p[p.MOCKUP_JS=9]="MOCKUP_JS",p[p.BEST_EFFORT_FALLBACK=10]="BEST_EFFORT_FALLBACK",p),em=((l={})[l.UNKNOWN_TRIGGER_TYPE=0]="UNKNOWN_TRIGGER_TYPE",l[l.SLACK_MESSAGE=1]="SLACK_MESSAGE",l[l.TELEGRAM_MESSAGE=2]="TELEGRAM_MESSAGE",l[l.TIME_BASED=3]="TIME_BASED",l[l.CONNECTOR_TRIGGER=4]="CONNECTOR_TRIGGER",l),eS=((u={})[u.UNSPECIFIED=0]="UNSPECIFIED",u[u.FEATURE=1]="FEATURE",u[u.STACK=2]="STACK",u[u.STYLING=3]="STYLING",u),eE=((c={})[c.UNSPECIFIED=0]="UNSPECIFIED",c[c.GENERAL=1]="GENERAL",c[c.REPLIT_DOCUMENTATION=2]="REPLIT_DOCUMENTATION",c),eb=((d={})[d.UNKNOWN=0]="UNKNOWN",d[d.SUCCESSFUL=1]="SUCCESSFUL",d[d.RECURSION_LIMIT_REACHED=2]="RECURSION_LIMIT_REACHED",d[d.EXCEPTION=3]="EXCEPTION",d),eR=((y={})[y.UNKNOWN=0]="UNKNOWN",y[y.REPL_CREATION_V1=1]="REPL_CREATION_V1",y),eI=((f={})[f.UNSPECIFIED=0]="UNSPECIFIED",f[f.URL_SCREENSHOT=1]="URL_SCREENSHOT",f[f.URL_CRAWL_CONTENT=2]="URL_CRAWL_CONTENT",f[f.URL_AS_PROMPT=3]="URL_AS_PROMPT",f[f.URL_CRAWL_HTML=4]="URL_CRAWL_HTML",f[f.URL_CRAWL_BRANDING=5]="URL_CRAWL_BRANDING",f),eC=((T={})[T.GENERATION_STATE_UNKNOWN=0]="GENERATION_STATE_UNKNOWN",T[T.GENERATION_IN_PROGRESS=1]="GENERATION_IN_PROGRESS",T[T.GENERATION_REGENERATING=2]="GENERATION_REGENERATING",T[T.GENERATION_COMPLETE=3]="GENERATION_COMPLETE",T[T.GENERATION_ERROR=4]="GENERATION_ERROR",T),eO=((h={})[h.UNKNOWN=0]="UNKNOWN",h[h.ENGLISH=1]="ENGLISH",h[h.CRON=2]="CRON",h),eA=((g={})[g.UNKNOWN=0]="UNKNOWN",g[g.BASIC=1]="BASIC",g[g.ADVANCED=2]="ADVANCED",g[g.OVERRIDE=3]="OVERRIDE",g),e_=((v={})[v.UNKNOWN=0]="UNKNOWN",v[v.FILE=1]="FILE",v[v.INLINE=2]="INLINE",v),ek=((m={})[m.UNKNOWN=0]="UNKNOWN",m[m.CONSOLE=1]="CONSOLE",m[m.LSP=2]="LSP",m),eU=((S={})[S.UNKNOWN=0]="UNKNOWN",S[S.IN_PROGRESS=1]="IN_PROGRESS",S[S.COMPLETE=2]="COMPLETE",S),ew=((E={})[E.UNKNOWN=0]="UNKNOWN",E[E.EXPLAIN_CODE=1]="EXPLAIN_CODE",E[E.DEBUGGER=2]="DEBUGGER",E[E.GENERATE_CODE=3]="GENERATE_CODE",E[E.TRANSFORM_CODE=4]="TRANSFORM_CODE",E),eN=((b={})[b.UNKNOWN=0]="UNKNOWN",b[b.USER=1]="USER",b[b.AI=2]="AI",b[b.SERVICE=3]="SERVICE",b),eD=((R={})[R.UNKNOWN=0]="UNKNOWN",R[R.CHAT=1]="CHAT",R[R.INLINE_CHAT=2]="INLINE_CHAT",R[R.SINGLE_USE_SESSION=3]="SINGLE_USE_SESSION",R[R.REPL_CREATION=4]="REPL_CREATION",R[R.AGENT_SESSION=5]="AGENT_SESSION",R[R.HOSTING_DEBUG_SUMMARY=6]="HOSTING_DEBUG_SUMMARY",R[R.REPL_CREATION_V2=7]="REPL_CREATION_V2",R[R.REPL_CREATION_V3=8]="REPL_CREATION_V3",R[R.AGENT_REPLAY_SESSION=9]="AGENT_REPLAY_SESSION",R[R.SAMPLING_SESSION=10]="SAMPLING_SESSION",R[R.SUB_AGENT=11]="SUB_AGENT",R),eP=((I={})[I.UNKNOWN=0]="UNKNOWN",I[I.MAX_TOKENS=1]="MAX_TOKENS",I[I.STOP_TOKEN=2]="STOP_TOKEN",I[I.SAFETY=3]="SAFETY",I[I.RECITATION=4]="RECITATION",I[I.TOOL_CALLS=5]="TOOL_CALLS",I[I.CONTENT_FILTER=6]="CONTENT_FILTER",I),eM=((C={})[C.UNKNOWN=0]="UNKNOWN",C[C.NONE=1]="NONE",C[C.REPLIT_DOCS=2]="REPLIT_DOCS",C[C.GENERATE=3]="GENERATE",C[C.EXPLAIN=4]="EXPLAIN",C[C.TRANSFORM=5]="TRANSFORM",C[C.DEBUG=6]="DEBUG",C[C.FIND_INTENT=7]="FIND_INTENT",C[C.AGENT=8]="AGENT",C[C.ITERATIVE_AGENT=9]="ITERATIVE_AGENT",C),ex=((O={})[O.UNKNOWN=0]="UNKNOWN",O[O.FREE=1]="FREE",O[O.CORE=2]="CORE",O[O.TEAMS=3]="TEAMS",O),ej=((A={})[A.UNKNOWN=0]="UNKNOWN",A[A.MANUALLY_ABORTED=1]="MANUALLY_ABORTED",A[A.INCOMPLETE_UPDATE=2]="INCOMPLETE_UPDATE",A[A.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",A[A.USAGE_LIMIT=4]="USAGE_LIMIT",A[A.TEST_ERROR=5]="TEST_ERROR",A[A.INVALID_INPUT=6]="INVALID_INPUT",A[A.UNAUTHORIZED=7]="UNAUTHORIZED",A[A.AGENT_EXECUTION_ERROR=8]="AGENT_EXECUTION_ERROR",A[A.AI_QUOTA_ERROR_UNKNOWN=9]="AI_QUOTA_ERROR_UNKNOWN",A[A.AI_QUOTA_INSUFFICIENT_BUDGET=10]="AI_QUOTA_INSUFFICIENT_BUDGET",A[A.AI_QUOTA_NO_PAYMENT_METHOD=11]="AI_QUOTA_NO_PAYMENT_METHOD",A[A.AI_QUOTA_NO_SUBSCRIPTION=12]="AI_QUOTA_NO_SUBSCRIPTION",A),eL=((_={})[_.UNSPECIFIED=0]="UNSPECIFIED",_[_.GENERAL=1]="GENERAL",_[_.DISCUSSION=2]="DISCUSSION",_[_.INITIAL_PLANNING=3]="INITIAL_PLANNING",_[_.QUICK_EDIT=4]="QUICK_EDIT",_),eB=((k={})[k.UNSPECIFIED=0]="UNSPECIFIED",k[k.SYNC=1]="SYNC",k[k.ASYNC=2]="ASYNC",k[k.DESIGN=3]="DESIGN",k[k.BUILD=4]="BUILD",k),eF=((U={})[U.UNSPECIFIED=0]="UNSPECIFIED",U[U.LOW=1]="LOW",U[U.MEDIUM=2]="MEDIUM",U[U.HIGH=3]="HIGH",U[U.MAX=4]="MAX",U),eG=((w={})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.LITE=1]="LITE",w[w.PRO=2]="PRO",w),eq=((N={})[N.UNSPECIFIED=0]="UNSPECIFIED",N[N.REPLIT_UI=1]="REPLIT_UI",N[N.CHATGPT=2]="CHATGPT",N),eV=((D={})[D.UNSPECIFIED=0]="UNSPECIFIED",D[D.STANDARD=1]="STANDARD",D[D.ADVANCED=2]="ADVANCED",D),e$=((P={})[P.SET=0]="SET",P[P.ADD=1]="ADD",P[P.CLEAR=2]="CLEAR",P[P.APPEND=3]="APPEND",P),eW=((M={})[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.INSUFFICIENT_BUDGET=1]="INSUFFICIENT_BUDGET",M[M.REQUIRES_PAYMENT_METHOD=2]="REQUIRES_PAYMENT_METHOD",M[M.REQUIRES_ACTIVE_SUBSCRIPTION=3]="REQUIRES_ACTIVE_SUBSCRIPTION",M[M.AGENT_UNKNOWN_AUTHORIZATION_ERROR=4]="AGENT_UNKNOWN_AUTHORIZATION_ERROR",M[M.INSUFFICIENT_PERMISSIONS=5]="INSUFFICIENT_PERMISSIONS",M[M.INSUFFICIENT_QUOTA=6]="INSUFFICIENT_QUOTA",M[M.PAYMENT_DELINQUENT=7]="PAYMENT_DELINQUENT",M),ez=((x={})[x.NULL_VALUE=0]="NULL_VALUE",x),eH=((j={})[j.STRING=0]="STRING",j[j.INTEGER=1]="INTEGER",j),eK=((L={})[L.AGENT=0]="AGENT",L[L.USER=1]="USER",L[L.DEPLOYMENT=2]="DEPLOYMENT",L),eY=((B={})[B.UNSPECIFIED=0]="UNSPECIFIED",B[B.ZERO_RATED=1]="ZERO_RATED",B[B.NORMAL=2]="NORMAL",B),eQ=((F={})[F.UNSPECIFIED=0]="UNSPECIFIED",F[F.RAPID_BUILD_FEEDBACK=1]="RAPID_BUILD_FEEDBACK",F[F.FEEDBACK_REQUESTED=2]="FEEDBACK_REQUESTED",F[F.AGENT_USAGE_MAX_THRESHOLD=3]="AGENT_USAGE_MAX_THRESHOLD",F[F.AGENT_USAGE_LIMIT_THRESHOLD=4]="AGENT_USAGE_LIMIT_THRESHOLD",F[F.USER_RESPONSE=5]="USER_RESPONSE",F[F.PROPOSE_PLAN_TOOL=6]="PROPOSE_PLAN_TOOL",F[F.LAST_MESSAGE=7]="LAST_MESSAGE",F[F.SESSION_START=8]="SESSION_START",F[F.NEON_DATABASE_EVENT=9]="NEON_DATABASE_EVENT",F[F.GENERATE_3D_MODEL=10]="GENERATE_3D_MODEL",F[F.CONTINUE_WITH_PLAN=11]="CONTINUE_WITH_PLAN",F[F.WORKSPACE_TRIGGERED_AGENT=12]="WORKSPACE_TRIGGERED_AGENT",F[F.WORKSPACE_TRIGGERED_USER=13]="WORKSPACE_TRIGGERED_USER",F[F.WORKSPACE_TRIGGERED_DEPLOYMENT=14]="WORKSPACE_TRIGGERED_DEPLOYMENT",F[F.PROPOSE_MVP_PLAN=15]="PROPOSE_MVP_PLAN",F[F.INTERMEDIATE_CHECKPOINT=16]="INTERMEDIATE_CHECKPOINT",F[F.PREREVERT=17]="PREREVERT",F[F.REVERT=18]="REVERT",F[F.TEST=19]="TEST",F[F.PLAN_APPROVED=20]="PLAN_APPROVED",F[F.REACT_LOOP_CAP_HIT=21]="REACT_LOOP_CAP_HIT",F[F.SUCCESS_TOOL=22]="SUCCESS_TOOL",F[F.LOOP_END=23]="LOOP_END",F[F.AGENT_PAUSE=24]="AGENT_PAUSE",F[F.COMPLETED_TASK=25]="COMPLETED_TASK",F[F.PLAN_TO_BUILD_TRANSITION=26]="PLAN_TO_BUILD_TRANSITION",F),eX=((G={})[G.DISCOUNTED_EFFORT_UNSPECIFIED=0]="DISCOUNTED_EFFORT_UNSPECIFIED",G[G.DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE=1]="DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE",G),eJ=((q={})[q.REVERT_DATA_STAGE_UNKNOWN=0]="REVERT_DATA_STAGE_UNKNOWN",q[q.REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE=1]="REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE",q[q.REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS=2]="REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS",q[q.REVERT_DATA_STAGE_REVERTING_COMMIT=3]="REVERT_DATA_STAGE_REVERTING_COMMIT",q[q.REVERT_DATA_STAGE_RESTARTING_WORKFLOWS=4]="REVERT_DATA_STAGE_RESTARTING_WORKFLOWS",q[q.REVERT_DATA_STAGE_COMPLETE=5]="REVERT_DATA_STAGE_COMPLETE",q[q.REVERT_DATA_STAGE_ROLLING_BACK_DATABASE=6]="REVERT_DATA_STAGE_ROLLING_BACK_DATABASE",q[q.REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT=7]="REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT",q),eZ=((V={})[V.MEDIA_TYPE_UNKNOWN=0]="MEDIA_TYPE_UNKNOWN",V[V.MEDIA_TYPE_IMAGE=1]="MEDIA_TYPE_IMAGE",V[V.MEDIA_TYPE_VIDEO=2]="MEDIA_TYPE_VIDEO",V[V.MEDIA_TYPE_3D_MODEL=3]="MEDIA_TYPE_3D_MODEL",V),e0=(($={})[$.UNSPECIFIED=0]="UNSPECIFIED",$[$.ONE=1]="ONE",$[$.ALL=2]="ALL",$),e1=((W={})[W.UNSPECIFIED=0]="UNSPECIFIED",W[W.PENDING=1]="PENDING",W[W.ACKNOWLEDGED_CONTINUE_CURRENT_STEP=2]="ACKNOWLEDGED_CONTINUE_CURRENT_STEP",W[W.ACKNOWLEDGED_ABORT_CURRENT_STEP=3]="ACKNOWLEDGED_ABORT_CURRENT_STEP",W),e2=((z={})[z.SUCCESS=0]="SUCCESS",z[z.FAILURE=1]="FAILURE",z[z.UNABLE=3]="UNABLE",z),e3=((H={})[H.UNKNOWN=0]="UNKNOWN",H[H.THOUGHTS_ONLY=1]="THOUGHTS_ONLY",H[H.ALL_EVENTS=2]="ALL_EVENTS",H),e4=((K={})[K.UNSPECIFIED=0]="UNSPECIFIED",K[K.ENVIRONMENT_SETUP=1]="ENVIRONMENT_SETUP",K[K.SAMPLING=2]="SAMPLING",K[K.RANKING=3]="RANKING",K[K.APPLYING=4]="APPLYING",K[K.CONCLUDED=5]="CONCLUDED",K),e6=((Y={})[Y.UNSPECIFIED=0]="UNSPECIFIED",Y[Y.ENVIRONMENT_SETUP=5]="ENVIRONMENT_SETUP",Y[Y.IN_PROGRESS=1]="IN_PROGRESS",Y[Y.SUCCESSFUL=2]="SUCCESSFUL",Y[Y.FAILED=3]="FAILED",Y[Y.CHOSEN=4]="CHOSEN",Y),e8=((Q={})[Q.VISUAL_STARTED=0]="VISUAL_STARTED",Q[Q.VISUAL_COMPLETE_PENDING_REVIEW=1]="VISUAL_COMPLETE_PENDING_REVIEW",Q[Q.VISUAL_COMPLETE=2]="VISUAL_COMPLETE",Q[Q.MVP_STARTED=3]="MVP_STARTED",Q[Q.MVP_COMPLETE_PENDING_REVIEW=4]="MVP_COMPLETE_PENDING_REVIEW",Q[Q.MVP_COMPLETE=5]="MVP_COMPLETE",Q),e5=((X={})[X.UNKNOWN=0]="UNKNOWN",X[X.LOG_FILE=1]="LOG_FILE",X),e9=((J={})[J.UNSPECIFIED=0]="UNSPECIFIED",J[J.INFO=1]="INFO",J[J.WARNING=2]="WARNING",J[J.ERROR=3]="ERROR",J),e7=((Z={})[Z.NONE=0]="NONE",Z[Z.OPEN_MCP_PANE=1]="OPEN_MCP_PANE",Z),te=((ee={})[ee.UNSPECIFIED=0]="UNSPECIFIED",ee[ee.DEVELOPMENT=1]="DEVELOPMENT",ee[ee.PRODUCTION=2]="PRODUCTION",ee[ee.SHARED=3]="SHARED",ee),tt=((et={})[et.UNSPECIFIED=0]="UNSPECIFIED",et[et.ENV=1]="ENV",et[et.SECRET=2]="SECRET",et);e.s(["AgentAuthorizationFailedCode",()=>eW,"AgentInitialBuildMode",()=>eB,"AgentInitialBuildTier",()=>eG,"AgentMode",()=>eL,"AgentPlanStepStatus",()=>eh,"AgentRunState",()=>ec,"AgentStackTriggerType",()=>em,"AgentUserFeedbackType",()=>ed,"AlertLevel",()=>e9,"AlertNextAction",()=>e7,"AttachedFormType",()=>eR,"AutonomyLevel",()=>eF,"BYOPromptResponseParameterType",()=>eH,"BenchmarkConclusionReason",()=>eb,"BlueprintCategory",()=>eS,"CheckpointTriggerReason",()=>eQ,"CodeReferenceType",()=>e_,"CommitAuthor",()=>eK,"CommitBillingRate",()=>eY,"DebugErrorSource",()=>ek,"DiscountedEffortType",()=>eX,"EnvironmentType",()=>te,"EnvironmentVariableType",()=>tt,"EventErrorType",()=>ej,"EventState",()=>eU,"FileChangeGenerationState",()=>eC,"GeneralSubagentEventFilter",()=>e3,"GeneratedMediaType",()=>eZ,"InitialBuildPhase",()=>e8,"InlineMessageType",()=>ew,"MembershipType",()=>ex,"MessageAction",()=>eM,"MessageSource",()=>eq,"MessageStopReason",()=>eP,"ModelProfile",()=>eV,"ModelType",()=>eA,"NullValue",()=>ez,"ProjectImportSource",()=>ef,"RequestFeatureAddType",()=>eg,"RevertStatus",()=>eJ,"SamplingEventState",()=>e4,"SessionType",()=>eD,"SpecialFileType",()=>e5,"StackBlueprint",()=>ev,"StepTooComplexEventContentsState",()=>e1,"TaskStatus",()=>eT,"TrajectoryState",()=>e6,"TranslationTarget",()=>eO,"UITestingSubagentResultType",()=>e2,"UpdateEventOperationType",()=>e$,"UrlIntent",()=>eI,"UserSecretResponseStatus",()=>ey,"UserType",()=>eN,"WaitingForBackgroundJobType",()=>e0,"WebSearchType",()=>eE],806240);var tn=es.Type.Module({AgentRunState:es.Type.Enum(ec),AgentUserFeedbackType:es.Type.Enum(ed),UserSecretResponseStatus:es.Type.Enum(ey),ProjectImportSource:es.Type.Enum(ef),TaskStatus:es.Type.Enum(eT),AgentPlanStepStatus:es.Type.Enum(eh),RequestFeatureAddType:es.Type.Enum(eg),StackBlueprint:es.Type.Enum(ev),AgentStackTriggerType:es.Type.Enum(em),BlueprintCategory:es.Type.Enum(eS),WebSearchType:es.Type.Enum(eE),BenchmarkConclusionReason:es.Type.Enum(eb),AttachedFormType:es.Type.Enum(eR),UrlIntent:es.Type.Enum(eI),FileChangeGenerationState:es.Type.Enum(eC),TranslationTarget:es.Type.Enum(eO),ModelType:es.Type.Enum(eA),CodeReferenceType:es.Type.Enum(e_),DebugErrorSource:es.Type.Enum(ek),EventState:es.Type.Enum(eU),InlineMessageType:es.Type.Enum(ew),UserType:es.Type.Enum(eN),SessionType:es.Type.Enum(eD),MessageStopReason:es.Type.Enum(eP),MessageAction:es.Type.Enum(eM),MembershipType:es.Type.Enum(ex),EventErrorType:es.Type.Enum(ej),AgentMode:es.Type.Enum(eL),AgentInitialBuildMode:es.Type.Enum(eB),AutonomyLevel:es.Type.Enum(eF),AgentInitialBuildTier:es.Type.Enum(eG),MessageSource:es.Type.Enum(eq),ModelProfile:es.Type.Enum(eV),UpdateEventOperationType:es.Type.Enum(e$),AgentAuthorizationFailedCode:es.Type.Enum(eW),NullValue:es.Type.Enum(ez),BYOPromptResponseParameterType:es.Type.Enum(eH),CommitAuthor:es.Type.Enum(eK),CommitBillingRate:es.Type.Enum(eY),CheckpointTriggerReason:es.Type.Enum(eQ),DiscountedEffortType:es.Type.Enum(eX),RevertStatus:es.Type.Enum(eJ),GeneratedMediaType:es.Type.Enum(eZ),WaitingForBackgroundJobType:es.Type.Enum(e0),StepTooComplexEventContentsState:es.Type.Enum(e1),UITestingSubagentResultType:es.Type.Enum(e2),GeneralSubagentEventFilter:es.Type.Enum(e3),SamplingEventState:es.Type.Enum(e4),TrajectoryState:es.Type.Enum(e6),InitialBuildPhase:es.Type.Enum(e8),SpecialFileType:es.Type.Enum(e5),AlertLevel:es.Type.Enum(e9),AlertNextAction:es.Type.Enum(e7),EnvironmentType:es.Type.Enum(te),EnvironmentVariableType:es.Type.Enum(tt),RevertToCommitRequest:es.Type.Object({replId:es.Type.String(),targetCommitId:es.Type.String(),newSessionTitle:es.Type.String(),originalSessionId:es.Type.String(),databaseRollbackTimestamp:es.Type.String(),deploymentBuildId:es.Type.String(),rollbackDatabase:es.Type.Boolean(),revertedToSessionId:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),revertedToEventId:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),RevertToCommitResponse:es.Type.Object({revertedSessionId:es.Type.String()}),CloneSessionRequest:es.Type.Object({sessionId:es.Type.String(),newReplId:es.Type.String(),sessionType:es.Type.Optional(es.Type.Union([es.Type.Ref("SessionType"),es.Type.Undefined()]))}),CloneSessionResponse:es.Type.Object({clonedSessionId:es.Type.String()}),Ping:es.Type.Object({}),Pong:es.Type.Object({}),Event:es.Type.Object({id:es.Type.String(),parentEventId:es.Type.String(),contents:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContents"),es.Type.Undefined()])),context:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContext"),es.Type.Undefined()])),state:es.Type.Ref("EventState"),created:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),updated:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),sender:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),sessionId:es.Type.String(),updateEventOperations:es.Type.Array(es.Type.Ref("UpdateEventOperation")),typedUpdateEventOperations:es.Type.Array(es.Type.Ref("TypedUpdateEventOperation")),error:es.Type.Optional(es.Type.Union([es.Type.Ref("EventError"),es.Type.Undefined()])),agentStepId:es.Type.String()}),EventShape:es.Type.Object({id:es.Type.String(),parentEventId:es.Type.String(),created:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),AgentUserFeedback:es.Type.Object({type:es.Type.Ref("AgentUserFeedbackType"),comment:es.Type.String()}),SubmitAgentUserFeedbackRequest:es.Type.Object({sessionId:es.Type.String(),sourceEventId:es.Type.String(),feedback:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserFeedback"),es.Type.Undefined()])),sessionType:es.Type.Ref("SessionType")}),SubmitAgentUserFeedbackResponse:es.Type.Object({}),ReplAgentState:es.Type.Object({activeAgentSessionId:es.Type.String()}),Session:es.Type.Object({id:es.Type.String(),title:es.Type.String(),sessionType:es.Type.Ref("SessionType"),replId:es.Type.String(),events:es.Type.Array(es.Type.Ref("Event")),sessionCreationEventId:es.Type.String(),archived:es.Type.Boolean(),lastEventTime:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),created:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),updated:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),activeEventId:es.Type.String(),readOnly:es.Type.Boolean(),taskId:es.Type.String(),revertedToSessionId:es.Type.String(),revertedToEventId:es.Type.String()}),Secret:es.Type.Object({description:es.Type.String(),key:es.Type.String()}),SecretRequestAction:es.Type.Object({secrets:es.Type.Array(es.Type.Ref("Secret"))}),UserSecretResponse:es.Type.Object({key:es.Type.String(),status:es.Type.Ref("UserSecretResponseStatus")}),DeployRequest:es.Type.Object({}),DeployResponse:es.Type.Object({success:es.Type.Boolean()}),MessageButton:es.Type.Object({name:es.Type.String(),description:es.Type.String(),responseText:es.Type.String()}),DeployRequestAction:es.Type.Object({}),MessageButtonAction:es.Type.Object({buttons:es.Type.Array(es.Type.Ref("MessageButton"))}),AgentUserSecretsRequest:es.Type.Object({secrets:es.Type.Array(es.Type.Ref("Secret")),message:es.Type.String()}),AgentUserSecretsResponse:es.Type.Object({providedSecrets:es.Type.Array(es.Type.Ref("UserSecretResponse"))}),AgentDebugRequest:es.Type.Object({enabled:es.Type.Boolean(),isSelected:es.Type.Boolean()}),AgentDebugResponse:es.Type.Object({accepted:es.Type.Boolean()}),AgentContinueRequest:es.Type.Object({enabled:es.Type.Boolean(),isSelected:es.Type.Boolean()}),AgentContinueResponse:es.Type.Object({accepted:es.Type.Boolean()}),AgentNewFeatureRequest:es.Type.Object({featureName:es.Type.String(),id:es.Type.Number(),isSelected:es.Type.Boolean()}),UserMessageContents:es.Type.Object({content:es.Type.String(),uploadedFiles:es.Type.Array(es.Type.Ref("UploadedFile")),attachedUrls:es.Type.Array(es.Type.Ref("AttachedUrl"))}),AgentNewFeatureResponse:es.Type.Object({selectedFeatureId:es.Type.Number(),featureName:es.Type.String(),userMessage:es.Type.Optional(es.Type.Union([es.Type.Ref("UserMessageContents"),es.Type.Undefined()]))}),AgentDeployRequest:es.Type.Object({}),AgentDeployResponse:es.Type.Object({}),AgentAction:es.Type.Object({optionType:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("messageButtonAction"),value:es.Type.Ref("MessageButtonAction")}),es.Type.Object({$case:es.Type.Literal("secretRequestAction"),value:es.Type.Ref("SecretRequestAction")}),es.Type.Object({$case:es.Type.Literal("deployRequestAction"),value:es.Type.Ref("DeployRequestAction")}),es.Type.Undefined()]))}),AgentNextStepRequest:es.Type.Object({newFeatureRequests:es.Type.Array(es.Type.Ref("AgentNewFeatureRequest")),debugRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentDebugRequest"),es.Type.Undefined()])),keepWorkingRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentContinueRequest"),es.Type.Undefined()]))}),AgentNextStepResponse:es.Type.Object({response:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("newFeatureResponse"),value:es.Type.Ref("AgentNewFeatureResponse")}),es.Type.Object({$case:es.Type.Literal("debugResponse"),value:es.Type.Ref("AgentDebugResponse")}),es.Type.Object({$case:es.Type.Literal("keepWorkingResponse"),value:es.Type.Ref("AgentContinueResponse")}),es.Type.Undefined()]))}),AgentQueryBoolean:es.Type.Object({question:es.Type.String(),confirmText:es.Type.String(),rejectText:es.Type.String(),allowAutoConfirm:es.Type.Boolean()}),AgentQueryChoice:es.Type.Object({question:es.Type.String(),options:es.Type.Array(es.Type.String())}),AgentQueryText:es.Type.Object({question:es.Type.String(),responsePlaceholderText:es.Type.String()}),AgentQuery:es.Type.Object({queryType:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("booleanQuery"),value:es.Type.Ref("AgentQueryBoolean")}),es.Type.Object({$case:es.Type.Literal("choiceQuery"),value:es.Type.Ref("AgentQueryChoice")}),es.Type.Object({$case:es.Type.Literal("textQuery"),value:es.Type.Ref("AgentQueryText")}),es.Type.Undefined()]))}),AgentQueryBooleanResponse:es.Type.Object({response:es.Type.Boolean(),reason:es.Type.String()}),AgentQueryChoiceResponse:es.Type.Object({response:es.Type.String(),reason:es.Type.String()}),AgentQueryTextResponse:es.Type.Object({response:es.Type.String()}),AgentQueryNoResponse:es.Type.Object({}),AgentQueryResponse:es.Type.Object({responseType:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("booleanResponse"),value:es.Type.Ref("AgentQueryBooleanResponse")}),es.Type.Object({$case:es.Type.Literal("choiceResponse"),value:es.Type.Ref("AgentQueryChoiceResponse")}),es.Type.Object({$case:es.Type.Literal("textResponse"),value:es.Type.Ref("AgentQueryTextResponse")}),es.Type.Object({$case:es.Type.Literal("noResponse"),value:es.Type.Ref("AgentQueryNoResponse")}),es.Type.Undefined()]))}),QueryResponseContent:es.Type.Object({responses:es.Type.Array(es.Type.Ref("AgentQueryResponse"))}),QueryRequestContent:es.Type.Object({contextSummary:es.Type.String(),queries:es.Type.Array(es.Type.Ref("AgentQuery"))}),MarkTaskCompleteRequest:es.Type.Object({taskId:es.Type.String()}),UserMarkedTaskComplete:es.Type.Object({taskId:es.Type.String()}),ApproveTaskListRequest:es.Type.Object({taskListEventId:es.Type.String()}),ApproveTaskListResponse:es.Type.Object({taskListEventId:es.Type.String(),approved:es.Type.Boolean(),tasks:es.Type.Array(es.Type.Ref("Task")),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()]))}),ApproveInitialBuildMVPRequest:es.Type.Object({taskListEventId:es.Type.String(),userSecretsRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsRequest"),es.Type.Undefined()])),addingIntegrationRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AddingIntegrationsRequest"),es.Type.Undefined()]))}),ApproveInitialBuildMVPResponse:es.Type.Object({approved:es.Type.Boolean(),userSecretsResponse:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsResponse"),es.Type.Undefined()])),addingIntegrationsResponse:es.Type.Optional(es.Type.Union([es.Type.Ref("AddingIntegrationsResponse"),es.Type.Undefined()])),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseRequest:es.Type.Object({userSecretsRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsRequest"),es.Type.Undefined()])),addingIntegrationRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AddingIntegrationsRequest"),es.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseResponse:es.Type.Object({approved:es.Type.Boolean(),userSecretsResponse:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsResponse"),es.Type.Undefined()])),addingIntegrationsResponse:es.Type.Optional(es.Type.Union([es.Type.Ref("AddingIntegrationsResponse"),es.Type.Undefined()])),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()]))}),ApproveSqlQueryRequest:es.Type.Object({sqlQuery:es.Type.String(),executionReason:es.Type.String()}),ApproveSqlQueryResponse:es.Type.Object({sqlQueryEventId:es.Type.String(),approved:es.Type.Boolean()}),ApproveBlueprintRequest:es.Type.Object({blueprintName:es.Type.String(),blueprintDisplayName:es.Type.String()}),ApproveBlueprintResponse:es.Type.Object({blueprintEventId:es.Type.String(),approved:es.Type.Boolean(),blueprintName:es.Type.String()}),ConvertMockupToAppRequest:es.Type.Object({}),ConvertMockupToAppResponse:es.Type.Object({approved:es.Type.Boolean(),additionalComments:es.Type.String()}),AgentAskUserForActionRequest:es.Type.Object({request:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("nextStepRequest"),value:es.Type.Ref("AgentNextStepRequest")}),es.Type.Object({$case:es.Type.Literal("userSecretsRequest"),value:es.Type.Ref("AgentUserSecretsRequest")}),es.Type.Object({$case:es.Type.Literal("deployRequest"),value:es.Type.Ref("AgentDeployRequest")}),es.Type.Object({$case:es.Type.Literal("queryRequest"),value:es.Type.Ref("QueryRequestContent")}),es.Type.Object({$case:es.Type.Literal("markTaskCompleteRequest"),value:es.Type.Ref("MarkTaskCompleteRequest")}),es.Type.Object({$case:es.Type.Literal("approveTaskListRequest"),value:es.Type.Ref("ApproveTaskListRequest")}),es.Type.Object({$case:es.Type.Literal("approveSqlQueryRequest"),value:es.Type.Ref("ApproveSqlQueryRequest")}),es.Type.Object({$case:es.Type.Literal("addingIntegrationRequest"),value:es.Type.Ref("AddingIntegrationsRequest")}),es.Type.Object({$case:es.Type.Literal("approveInitialBuildMvpRequest"),value:es.Type.Ref("ApproveInitialBuildMVPRequest")}),es.Type.Object({$case:es.Type.Literal("approveInitialBuildVisualPhaseRequest"),value:es.Type.Ref("ApproveInitialBuildVisualPhaseRequest")}),es.Type.Object({$case:es.Type.Literal("approveBlueprintRequest"),value:es.Type.Ref("ApproveBlueprintRequest")}),es.Type.Object({$case:es.Type.Literal("environmentConfigRequest"),value:es.Type.Ref("EnvironmentConfigRequest")}),es.Type.Object({$case:es.Type.Literal("convertMockupToAppRequest"),value:es.Type.Ref("ConvertMockupToAppRequest")}),es.Type.Undefined()])),message:es.Type.String()}),AgentAskUserForActionResponse:es.Type.Object({response:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("nextStepResponse"),value:es.Type.Ref("AgentNextStepResponse")}),es.Type.Object({$case:es.Type.Literal("userSecretsResponse"),value:es.Type.Ref("AgentUserSecretsResponse")}),es.Type.Object({$case:es.Type.Literal("deployResponse"),value:es.Type.Ref("AgentDeployResponse")}),es.Type.Object({$case:es.Type.Literal("queryResponse"),value:es.Type.Ref("QueryResponseContent")}),es.Type.Object({$case:es.Type.Literal("userMarkedTaskComplete"),value:es.Type.Ref("UserMarkedTaskComplete")}),es.Type.Object({$case:es.Type.Literal("approveTaskListResponse"),value:es.Type.Ref("ApproveTaskListResponse")}),es.Type.Object({$case:es.Type.Literal("approveSqlQueryResponse"),value:es.Type.Ref("ApproveSqlQueryResponse")}),es.Type.Object({$case:es.Type.Literal("addingIntegrationsResponse"),value:es.Type.Ref("AddingIntegrationsResponse")}),es.Type.Object({$case:es.Type.Literal("approveInitialBuildMvpResponse"),value:es.Type.Ref("ApproveInitialBuildMVPResponse")}),es.Type.Object({$case:es.Type.Literal("approveInitialBuildVisualPhaseResponse"),value:es.Type.Ref("ApproveInitialBuildVisualPhaseResponse")}),es.Type.Object({$case:es.Type.Literal("approveBlueprintResponse"),value:es.Type.Ref("ApproveBlueprintResponse")}),es.Type.Object({$case:es.Type.Literal("envVarsResponse"),value:es.Type.Ref("EnvironmentConfigResponse")}),es.Type.Object({$case:es.Type.Literal("convertMockupToAppResponse"),value:es.Type.Ref("ConvertMockupToAppResponse")}),es.Type.Undefined()])),requestEventId:es.Type.String()}),SetupImportedProjectEventContents:es.Type.Object({importSource:es.Type.Ref("ProjectImportSource"),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()]))}),ProjectImportCompletedData:es.Type.Object({}),MemoryCompressionData:es.Type.Object({}),TaskListData:es.Type.Object({tasks:es.Type.Array(es.Type.Ref("Task")),commitData:es.Type.Optional(es.Type.Union([es.Type.Ref("CommitData"),es.Type.Undefined()])),agentMode:es.Type.Ref("AgentMode"),estimatedUsageCents:es.Type.Number()}),Task:es.Type.Object({id:es.Type.String(),content:es.Type.String(),status:es.Type.Ref("TaskStatus"),oldStatus:es.Type.Ref("TaskStatus"),updated:es.Type.Boolean(),summary:es.Type.String(),extraDetails:es.Type.String()}),EventContents:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("sessionCreationEventContents"),value:es.Type.Ref("SessionCreationEventContents")}),es.Type.Object({$case:es.Type.Literal("messageEventContents"),value:es.Type.Ref("MessageEventContents")}),es.Type.Object({$case:es.Type.Literal("inlineActionEventContents"),value:es.Type.Ref("InlineActionEventContents")}),es.Type.Object({$case:es.Type.Literal("localShellExecutionEventContents"),value:es.Type.Ref("LocalShellExecutionEventContents")}),es.Type.Object({$case:es.Type.Literal("shellSuggestionEventContents"),value:es.Type.Ref("ShellSuggestionEventContents")}),es.Type.Object({$case:es.Type.Literal("translateEventContents"),value:es.Type.Ref("TranslateEventContents")}),es.Type.Object({$case:es.Type.Literal("byoPromptEventContents"),value:es.Type.Ref("BYOPromptEventContents")}),es.Type.Object({$case:es.Type.Literal("agentPlanEventContents"),value:es.Type.Ref("AgentPlanEventContents")}),es.Type.Object({$case:es.Type.Literal("agentTimelineEventContents"),value:es.Type.Ref("AgentTimelineEventContents")}),es.Type.Object({$case:es.Type.Literal("benchmarkConclusion"),value:es.Type.Ref("BenchmarkConclusionEventContents")}),es.Type.Object({$case:es.Type.Literal("revertEventContents"),value:es.Type.Ref("RevertEventContents")}),es.Type.Object({$case:es.Type.Literal("hostingDebugSummaryEventContents"),value:es.Type.Ref("HostingDebugSummaryEventContents")}),es.Type.Object({$case:es.Type.Literal("approvePlanEventContents"),value:es.Type.Ref("ApprovePlanEventContents")}),es.Type.Object({$case:es.Type.Literal("userSecretsResponseEventContents"),value:es.Type.Ref("UserSecretsResponseEventContents")}),es.Type.Object({$case:es.Type.Literal("replCreationEventContents"),value:es.Type.Ref("ReplCreationEventContents")}),es.Type.Object({$case:es.Type.Literal("iterativeAgentEventContents"),value:es.Type.Ref("IterativeAgentEventContents")}),es.Type.Object({$case:es.Type.Literal("stepTooComplexEventContents"),value:es.Type.Ref("StepTooComplexEventContents")}),es.Type.Object({$case:es.Type.Literal("stepTooComplexAcknowledgementEventContents"),value:es.Type.Ref("StepTooComplexAcknowledgementEventContents")}),es.Type.Object({$case:es.Type.Literal("agentAskUserForActionRequest"),value:es.Type.Ref("AgentAskUserForActionRequest")}),es.Type.Object({$case:es.Type.Literal("agentAskUserForActionResponse"),value:es.Type.Ref("AgentAskUserForActionResponse")}),es.Type.Object({$case:es.Type.Literal("integrationTestEventContents"),value:es.Type.Ref("IntegrationTestEventContents")}),es.Type.Object({$case:es.Type.Literal("contextComplexityEventContents"),value:es.Type.Ref("ContextComplexityEventContents")}),es.Type.Object({$case:es.Type.Literal("eventTooLargeEventContents"),value:es.Type.Ref("EventTooLargeEventContents")}),es.Type.Object({$case:es.Type.Literal("startRapidBuildEventContents"),value:es.Type.Ref("StartRapidBuildEventContents")}),es.Type.Object({$case:es.Type.Literal("databaseNudgeEventContents"),value:es.Type.Ref("DatabaseNudgeEventContents")}),es.Type.Object({$case:es.Type.Literal("rapidBuildConcluded"),value:es.Type.Ref("RapidBuildConcludedData")}),es.Type.Object({$case:es.Type.Literal("versionMigrated"),value:es.Type.Ref("VersionMigratedData")}),es.Type.Object({$case:es.Type.Literal("rapidBuildStarted"),value:es.Type.Ref("RapidBuildStartedData")}),es.Type.Object({$case:es.Type.Literal("requestFeatureAddData"),value:es.Type.Ref("RequestFeatureAdd")}),es.Type.Object({$case:es.Type.Literal("triggerCheckpointEventContents"),value:es.Type.Ref("TriggerCheckpointEventContents")}),es.Type.Object({$case:es.Type.Literal("setupImportedProjectEventContents"),value:es.Type.Ref("SetupImportedProjectEventContents")}),es.Type.Object({$case:es.Type.Literal("tipRecommendation"),value:es.Type.Ref("UserTipRecommendationData")}),es.Type.Object({$case:es.Type.Literal("subagentRunning"),value:es.Type.Ref("SubagentRunningData")}),es.Type.Object({$case:es.Type.Literal("uiTestingSubagentExecutionEventContents"),value:es.Type.Ref("UITestingSubagentExecutionEventContents")}),es.Type.Object({$case:es.Type.Literal("initialBuildStateUpdateEventContents"),value:es.Type.Ref("InitialBuildStateUpdateEventContents")}),es.Type.Object({$case:es.Type.Literal("agentConfigUpdateEventContents"),value:es.Type.Ref("AgentConfigUpdateEventContents")}),es.Type.Object({$case:es.Type.Literal("cloudBudgetExceededEventContents"),value:es.Type.Ref("CloudBudgetExceededEventContents")}),es.Type.Undefined()])),benchmarkParameters:es.Type.Optional(es.Type.Union([es.Type.Ref("BenchmarkParameters"),es.Type.Undefined()]))}),EventContext:es.Type.Object({metadata:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("sessionCreationEventContext"),value:es.Type.Ref("SessionCreationEventContext")}),es.Type.Object({$case:es.Type.Literal("messageEventContext"),value:es.Type.Ref("MessageEventContext")}),es.Type.Object({$case:es.Type.Literal("inlineActionEventContext"),value:es.Type.Ref("InlineActionEventContext")}),es.Type.Object({$case:es.Type.Literal("localShellExecutionEventContext"),value:es.Type.Ref("LocalShellExecutionEventContext")}),es.Type.Object({$case:es.Type.Literal("shellSuggestionEventContext"),value:es.Type.Ref("ShellSuggestionEventContext")}),es.Type.Object({$case:es.Type.Literal("translateEventContext"),value:es.Type.Ref("TranslateEventContext")}),es.Type.Object({$case:es.Type.Literal("byoPromptEventContext"),value:es.Type.Ref("BYOPromptEventContext")}),es.Type.Object({$case:es.Type.Literal("agentPlanEventContext"),value:es.Type.Ref("AgentPlanEventContext")}),es.Type.Object({$case:es.Type.Literal("agentTimelineEventContext"),value:es.Type.Ref("AgentTimelineEventContext")}),es.Type.Object({$case:es.Type.Literal("hostingDebugSummaryEventContext"),value:es.Type.Ref("HostingDebugSummaryEventContext")}),es.Type.Object({$case:es.Type.Literal("replCreationEventContext"),value:es.Type.Ref("ReplCreationEventContext")}),es.Type.Object({$case:es.Type.Literal("userSecretsResponseEventContext"),value:es.Type.Ref("UserSecretsResponseEventContext")}),es.Type.Object({$case:es.Type.Literal("revertEventContext"),value:es.Type.Ref("RevertEventContext")}),es.Type.Object({$case:es.Type.Literal("iterativeAgentEventContext"),value:es.Type.Ref("IterativeAgentEventContext")}),es.Type.Object({$case:es.Type.Literal("integrationTestEventContext"),value:es.Type.Ref("IntegrationTestEventContext")}),es.Type.Undefined()]))}),StartRapidBuildEventContents:es.Type.Object({mvpObjective:es.Type.String(),stack:es.Type.String(),followupSteps:es.Type.Array(es.Type.String()),uploadedFiles:es.Type.Array(es.Type.Ref("UploadedRapidBuildFile")),extraDetails:es.Type.String(),techStack:es.Type.String(),mvpSuccessCriteria:es.Type.String()}),RapidBuildStartedData:es.Type.Object({}),SessionCreationEventContents:es.Type.Object({}),DatabaseNudgeEventContents:es.Type.Object({}),CloudBudgetExceededEventContents:es.Type.Object({serviceName:es.Type.String()}),CodeChangeStats:es.Type.Object({linesAdded:es.Type.Number(),linesRemoved:es.Type.Number(),commitId:es.Type.String()}),AgentPlanStep:es.Type.Recursive(function(e){return es.Type.Object({id:es.Type.String(),name:es.Type.String(),status:es.Type.Ref("AgentPlanStepStatus"),message:es.Type.String(),metadata:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("codeChangeStats"),value:es.Type.Ref("CodeChangeStats")}),es.Type.Undefined()])),timelineEventId:es.Type.String(),subSteps:es.Type.Array(e),blueprints:es.Type.Array(es.Type.String()),blueprintData:es.Type.Array(es.Type.Ref("BlueprintData")),mode:es.Type.String(),commitId:es.Type.String()})}),BlueprintsSetup:es.Type.Object({blueprintData:es.Type.Array(es.Type.Ref("BlueprintData"))}),RequestFeatureAdd:es.Type.Object({type:es.Type.Ref("RequestFeatureAddType")}),AgentPlanObjective:es.Type.Object({description:es.Type.String()}),AgentPlanEventContents:es.Type.Object({planId:es.Type.String(),objective:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanObjective"),es.Type.Undefined()])),step:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanStep"),es.Type.Undefined()])),requiresApproval:es.Type.Boolean(),initialCommitId:es.Type.String(),approver:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),stackBlueprint:es.Type.Ref("StackBlueprint"),designReferenceFilePaths:es.Type.Array(es.Type.String()),approvedDesignReferenceFilePath:es.Type.String(),customStackReplId:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),userSecretsRequest:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsRequest"),es.Type.Undefined()])),agentStackTriggerType:es.Type.Ref("AgentStackTriggerType")}),AgentPlanEventContext:es.Type.Object({}),RevertEventContext:es.Type.Object({}),BlueprintData:es.Type.Object({category:es.Type.Ref("BlueprintCategory"),displayName:es.Type.String(),name:es.Type.String(),secrets:es.Type.Array(es.Type.Ref("Secret"))}),ShellExecutionData:es.Type.Object({command:es.Type.String(),shellId:es.Type.String(),stdout:es.Type.String(),stderr:es.Type.String(),exitCode:es.Type.Number(),processId:es.Type.String(),isExecuting:es.Type.Boolean(),output:es.Type.String()}),FileEditData:es.Type.Object({filePath:es.Type.String(),diff:es.Type.String(),removedLines:es.Type.Number(),addedLines:es.Type.Number()}),CreateFileData:es.Type.Object({filePath:es.Type.String(),content:es.Type.String()}),ReadFileData:es.Type.Object({filePath:es.Type.String(),content:es.Type.String(),startLine:es.Type.Number(),endLine:es.Type.Number()}),ReadDirData:es.Type.Object({path:es.Type.String(),paths:es.Type.Array(es.Type.String())}),PackagerInstallData:es.Type.Object({inputLanguage:es.Type.String(),inputPackages:es.Type.Array(es.Type.String()),output:es.Type.String(),processId:es.Type.String(),isExecuting:es.Type.Boolean()}),PackagerUninstallData:es.Type.Object({inputLanguage:es.Type.String(),inputPackages:es.Type.Array(es.Type.String())}),SearchFilesystemData:es.Type.Object({queryDescription:es.Type.String(),filePaths:es.Type.Array(es.Type.String()),classNames:es.Type.Array(es.Type.String()),functionNames:es.Type.Array(es.Type.String()),resultFileNames:es.Type.Array(es.Type.String()),resultFileSummaries:es.Type.Array(es.Type.String())}),WebSearchResultPage:es.Type.Object({title:es.Type.String(),url:es.Type.String()}),GoogleSuggestedSearch:es.Type.Object({webSearchQueries:es.Type.Array(es.Type.String())}),WebSearchData:es.Type.Object({query:es.Type.String(),response:es.Type.String(),pageResults:es.Type.Array(es.Type.Ref("WebSearchResultPage")),googleSuggestedSearch:es.Type.Optional(es.Type.Union([es.Type.Ref("GoogleSuggestedSearch"),es.Type.Undefined()])),searchType:es.Type.Ref("WebSearchType")}),WebPageVisitData:es.Type.Object({url:es.Type.String(),title:es.Type.String(),snippet:es.Type.String(),favicon:es.Type.String()}),ScreenshotData:es.Type.Object({port:es.Type.Number(),path:es.Type.String(),imageUrl:es.Type.String()}),ToolchainInstallData:es.Type.Object({modules:es.Type.Array(es.Type.String())}),WorkflowsGetOutputToolData:es.Type.Object({name:es.Type.String(),output:es.Type.String()}),WorkflowsRemoveRunConfigToolData:es.Type.Object({name:es.Type.String()}),WorkflowsRestartToolData:es.Type.Object({name:es.Type.String()}),WorkflowsSetRunConfigToolData:es.Type.Object({name:es.Type.String(),command:es.Type.String()}),WorkflowsStartToolData:es.Type.Object({name:es.Type.String()}),WorkflowsStopToolData:es.Type.Object({name:es.Type.String()}),SuggestRollbackData:es.Type.Object({suggestRollbackReason:es.Type.String(),checkpointCommitSha:es.Type.String()}),PresentResultsToolData:es.Type.Object({resultType:es.Type.String(),shellCommand:es.Type.String(),websitePort:es.Type.Number(),shellCommandWorkflowName:es.Type.String(),websiteRoute:es.Type.String()}),SearchFileData:es.Type.Object({filePath:es.Type.String(),query:es.Type.String()}),SuggestGeneralBuildModeData:es.Type.Object({message:es.Type.String(),suggestedAutonomyLevel:es.Type.Ref("AutonomyLevel")}),AgentTimelineEventContents:es.Type.Object({toolName:es.Type.String(),planStepId:es.Type.String(),message:es.Type.String(),toolData:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("shellExecutionData"),value:es.Type.Ref("ShellExecutionData")}),es.Type.Object({$case:es.Type.Literal("fileEditData"),value:es.Type.Ref("FileEditData")}),es.Type.Object({$case:es.Type.Literal("createFileData"),value:es.Type.Ref("CreateFileData")}),es.Type.Object({$case:es.Type.Literal("readFileData"),value:es.Type.Ref("ReadFileData")}),es.Type.Object({$case:es.Type.Literal("packagerInstallData"),value:es.Type.Ref("PackagerInstallData")}),es.Type.Object({$case:es.Type.Literal("searchFilesystemData"),value:es.Type.Ref("SearchFilesystemData")}),es.Type.Object({$case:es.Type.Literal("messageData"),value:es.Type.Ref("MessageEventContents")}),es.Type.Object({$case:es.Type.Literal("packagerUninstallData"),value:es.Type.Ref("PackagerUninstallData")}),es.Type.Object({$case:es.Type.Literal("screenshotData"),value:es.Type.Ref("ScreenshotData")}),es.Type.Object({$case:es.Type.Literal("toolchainInstallData"),value:es.Type.Ref("ToolchainInstallData")}),es.Type.Object({$case:es.Type.Literal("workflowsGetOutputToolData"),value:es.Type.Ref("WorkflowsGetOutputToolData")}),es.Type.Object({$case:es.Type.Literal("workflowsRemoveRunConfigToolData"),value:es.Type.Ref("WorkflowsRemoveRunConfigToolData")}),es.Type.Object({$case:es.Type.Literal("workflowsRestartToolData"),value:es.Type.Ref("WorkflowsRestartToolData")}),es.Type.Object({$case:es.Type.Literal("workflowsSetRunConfigToolData"),value:es.Type.Ref("WorkflowsSetRunConfigToolData")}),es.Type.Object({$case:es.Type.Literal("workflowsStartToolData"),value:es.Type.Ref("WorkflowsStartToolData")}),es.Type.Object({$case:es.Type.Literal("workflowsStopToolData"),value:es.Type.Ref("WorkflowsStopToolData")}),es.Type.Object({$case:es.Type.Literal("planProgressData"),value:es.Type.Ref("PlanProgressData")}),es.Type.Object({$case:es.Type.Literal("summarizeObjectiveData"),value:es.Type.Ref("SummarizeObjectiveData")}),es.Type.Object({$case:es.Type.Literal("presentResultsToolData"),value:es.Type.Ref("PresentResultsToolData")}),es.Type.Object({$case:es.Type.Literal("searchFileData"),value:es.Type.Ref("SearchFileData")}),es.Type.Object({$case:es.Type.Literal("systemDependencyInstallData"),value:es.Type.Ref("SystemDependencyInstallData")}),es.Type.Object({$case:es.Type.Literal("systemDependencyUninstallData"),value:es.Type.Ref("SystemDependencyUninstallData")}),es.Type.Object({$case:es.Type.Literal("deployData"),value:es.Type.Ref("DeployData")}),es.Type.Object({$case:es.Type.Literal("revertData"),value:es.Type.Ref("RevertData")}),es.Type.Object({$case:es.Type.Literal("deployConfigData"),value:es.Type.Ref("DeployConfigData")}),es.Type.Object({$case:es.Type.Literal("agentPlanStepBegin"),value:es.Type.Ref("AgentPlanStepBeginData")}),es.Type.Object({$case:es.Type.Literal("acknowledgeUserMessage"),value:es.Type.Ref("AcknowledgeUserMessage")}),es.Type.Object({$case:es.Type.Literal("createPostgresqlDatabaseData"),value:es.Type.Ref("CreatePostgreSQLDatabaseData")}),es.Type.Object({$case:es.Type.Literal("sqlExecutionData"),value:es.Type.Ref("SqlExecutionData")}),es.Type.Object({$case:es.Type.Literal("newSessionNudge"),value:es.Type.Ref("NewSessionNudge")}),es.Type.Object({$case:es.Type.Literal("commitData"),value:es.Type.Ref("CommitData")}),es.Type.Object({$case:es.Type.Literal("readDirData"),value:es.Type.Ref("ReadDirData")}),es.Type.Object({$case:es.Type.Literal("thoughts"),value:es.Type.Ref("AgentThoughtsData")}),es.Type.Object({$case:es.Type.Literal("blueprintsSetup"),value:es.Type.Ref("BlueprintsSetup")}),es.Type.Object({$case:es.Type.Literal("webPageVisitData"),value:es.Type.Ref("WebPageVisitData")}),es.Type.Object({$case:es.Type.Literal("webSearchData"),value:es.Type.Ref("WebSearchData")}),es.Type.Object({$case:es.Type.Literal("imageGenerationData"),value:es.Type.Ref("ImageGenerationData")}),es.Type.Object({$case:es.Type.Literal("projectImportCompleted"),value:es.Type.Ref("ProjectImportCompletedData")}),es.Type.Object({$case:es.Type.Literal("memoryCompressionData"),value:es.Type.Ref("MemoryCompressionData")}),es.Type.Object({$case:es.Type.Literal("suggestRollbackData"),value:es.Type.Ref("SuggestRollbackData")}),es.Type.Object({$case:es.Type.Literal("taskListData"),value:es.Type.Ref("TaskListData")}),es.Type.Object({$case:es.Type.Literal("samplingEvent"),value:es.Type.Ref("SamplingEvent")}),es.Type.Object({$case:es.Type.Literal("setupObjectStorageData"),value:es.Type.Ref("SetupObjectStorageData")}),es.Type.Object({$case:es.Type.Literal("endOfRunSummaryData"),value:es.Type.Ref("EndOfRunSummaryData")}),es.Type.Object({$case:es.Type.Literal("stockImageData"),value:es.Type.Ref("StockImageData")}),es.Type.Object({$case:es.Type.Literal("searchIntegrationsData"),value:es.Type.Ref("SearchIntegrationsData")}),es.Type.Object({$case:es.Type.Literal("viewIntegrationData"),value:es.Type.Ref("ViewIntegrationData")}),es.Type.Object({$case:es.Type.Literal("setupModelfarmData"),value:es.Type.Ref("SetupModelfarmData")}),es.Type.Object({$case:es.Type.Literal("viewLogsData"),value:es.Type.Ref("ViewLogsData")}),es.Type.Object({$case:es.Type.Literal("uiTestingSubagentTakeOverData"),value:es.Type.Ref("UITestingSubagentTakeOverData")}),es.Type.Object({$case:es.Type.Literal("viewSpecialFiles"),value:es.Type.Ref("ViewSpecialFilesData")}),es.Type.Object({$case:es.Type.Literal("designGuidelinesData"),value:es.Type.Ref("DesignGuidelinesData")}),es.Type.Object({$case:es.Type.Literal("mcpToolData"),value:es.Type.Ref("MCPToolData")}),es.Type.Object({$case:es.Type.Literal("alertData"),value:es.Type.Ref("AlertData")}),es.Type.Object({$case:es.Type.Literal("viewEnvVarData"),value:es.Type.Ref("ViewEnvVarData")}),es.Type.Object({$case:es.Type.Literal("setEnvVarData"),value:es.Type.Ref("SetEnvVarData")}),es.Type.Object({$case:es.Type.Literal("deleteEnvVarData"),value:es.Type.Ref("DeleteEnvVarData")}),es.Type.Object({$case:es.Type.Literal("videoGenerationData"),value:es.Type.Ref("VideoGenerationData")}),es.Type.Object({$case:es.Type.Literal("generateMediaData"),value:es.Type.Ref("GenerateMediaData")}),es.Type.Object({$case:es.Type.Literal("waitingForBackgroundJobsData"),value:es.Type.Ref("WaitingForBackgroundJobsData")}),es.Type.Object({$case:es.Type.Literal("suggestGeneralBuildModeData"),value:es.Type.Ref("SuggestGeneralBuildModeData")}),es.Type.Object({$case:es.Type.Literal("messagedBackgroundAgent"),value:es.Type.Ref("MessagedBackgroundAgentData")}),es.Type.Object({$case:es.Type.Literal("subagentReportResultData"),value:es.Type.Ref("SubagentReportResultData")}),es.Type.Object({$case:es.Type.Literal("reportAgentIssueData"),value:es.Type.Ref("ReportAgentIssueData")}),es.Type.Undefined()]))}),AgentPlanStepBeginData:es.Type.Object({planStep:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanStep"),es.Type.Undefined()])),starts:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),SummarizeObjectiveData:es.Type.Object({summarizedObjective:es.Type.String()}),AgentThoughtsData:es.Type.Object({thoughts:es.Type.String(),redactedThoughtsMarkers:es.Type.Array(es.Type.Ref("RedactedThoughtsMarker")),totalTimeTakenMs:es.Type.Number(),summary:es.Type.String()}),RedactedThoughtsMarker:es.Type.Object({index:es.Type.Number()}),RapidBuildConcludedData:es.Type.Object({willContinueWorking:es.Type.Boolean()}),VersionMigratedData:es.Type.Object({version:es.Type.Number()}),PlanProgressData:es.Type.Object({updatedPlanStep:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanStep"),es.Type.Undefined()]))}),BenchmarkConclusionEventContents:es.Type.Object({completionReason:es.Type.Ref("BenchmarkConclusionReason"),steps:es.Type.Number(),exception:es.Type.String(),datasetId:es.Type.String(),instanceId:es.Type.String(),runId:es.Type.String(),metrics:es.Type.Optional(es.Type.Union([es.Type.Ref("BenchmarkMetrics"),es.Type.Undefined()]))}),BenchmarkMetrics:es.Type.Object({increment:es.Type.Array(es.Type.Ref("Metric")),decrement:es.Type.Array(es.Type.Ref("Metric")),gauge:es.Type.Array(es.Type.Ref("Metric")),histogram:es.Type.Array(es.Type.Ref("Metric")),distribution:es.Type.Array(es.Type.Ref("Metric")),timing:es.Type.Array(es.Type.Ref("Metric"))}),Metric:es.Type.Object({name:es.Type.String(),metrics:es.Type.Array(es.Type.Ref("MetricByTag"))}),MetricByTag:es.Type.Object({tags:es.Type.Array(es.Type.String()),values:es.Type.Array(es.Type.Number())}),AgentTimelineEventContext:es.Type.Object({}),Range:es.Type.Object({indexFrom:es.Type.Number(),indexTo:es.Type.Number(),lineFrom:es.Type.Number(),lineTo:es.Type.Number()}),CodeReference:es.Type.Object({code:es.Type.String(),filePath:es.Type.String(),fileVersion:es.Type.Number(),fileContent:es.Type.String(),range:es.Type.Optional(es.Type.Union([es.Type.Ref("Range"),es.Type.Undefined()])),language:es.Type.String(),referenceType:es.Type.Ref("CodeReferenceType")}),MessageEventContents:es.Type.Object({content:es.Type.String(),intent:es.Type.Ref("MessageAction"),stopReason:es.Type.Ref("MessageStopReason"),debugFullPrompt:es.Type.String(),codeReference:es.Type.Optional(es.Type.Union([es.Type.Ref("CodeReference"),es.Type.Undefined()])),debugErrorSource:es.Type.Ref("DebugErrorSource"),media:es.Type.Array(es.Type.Ref("MediaReference")),usedModelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()])),sources:es.Type.Array(es.Type.Ref("Source")),extraActions:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("suggestedTemplates"),value:es.Type.Ref("SuggestedTemplates")}),es.Type.Object({$case:es.Type.Literal("proposedFileChanges"),value:es.Type.Ref("ProposedFileChanges")}),es.Type.Undefined()])),benchmarkMode:es.Type.Boolean(),benchmarkParameters:es.Type.Optional(es.Type.Union([es.Type.Ref("BenchmarkParameters"),es.Type.Undefined()])),agentAction:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentAction"),es.Type.Undefined()])),uploadedFiles:es.Type.Array(es.Type.Ref("UploadedFile")),attachedUrls:es.Type.Array(es.Type.Ref("AttachedUrl")),commitId:es.Type.String(),lastSeenWebviewLogTimestamp:es.Type.Number(),assistantProposedActions:es.Type.Optional(es.Type.Union([es.Type.Ref("AssistantProposedActions"),es.Type.Undefined()])),ragContext:es.Type.Optional(es.Type.Union([es.Type.Ref("SelectedRagContext"),es.Type.Undefined()])),attachedForm:es.Type.Optional(es.Type.Union([es.Type.Ref("AttachedForm"),es.Type.Undefined()])),enableDeepThinking:es.Type.Boolean(),targetedElement:es.Type.Optional(es.Type.Union([es.Type.Ref("TargetedElement"),es.Type.Undefined()])),requestedStackBlueprint:es.Type.Ref("StackBlueprint"),quickEdit:es.Type.Boolean(),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()])),customStackReplId:es.Type.String(),themeConfig:es.Type.String(),agentStackTriggerType:es.Type.Ref("AgentStackTriggerType")}),TargetedElement:es.Type.Object({filePath:es.Type.String(),lineNumber:es.Type.Number(),componentName:es.Type.String(),textContent:es.Type.String(),imageSourceUrl:es.Type.String(),hasChildElements:es.Type.Boolean(),siblingCount:es.Type.Number(),parent:es.Type.Optional(es.Type.Union([es.Type.Ref("RelatedElement"),es.Type.Undefined()])),nextSibling:es.Type.Optional(es.Type.Union([es.Type.Ref("RelatedElement"),es.Type.Undefined()])),grandparent:es.Type.Optional(es.Type.Union([es.Type.Ref("RelatedElement"),es.Type.Undefined()]))}),RelatedElement:es.Type.Object({tagName:es.Type.String(),className:es.Type.String(),textContent:es.Type.String(),id:es.Type.String()}),AttachedForm:es.Type.Object({formType:es.Type.Ref("AttachedFormType"),fields:es.Type.Array(es.Type.Ref("AttachedFormField"))}),AttachedFormField:es.Type.Object({path:es.Type.String(),formType:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("string"),value:es.Type.Ref("AttachedFormStringField")}),es.Type.Object({$case:es.Type.Literal("files"),value:es.Type.Ref("AttachedFormFilesField")}),es.Type.Undefined()]))}),AttachedFormStringField:es.Type.Object({value:es.Type.String()}),AttachedFormFilesField:es.Type.Object({files:es.Type.Array(es.Type.Ref("AttachedFormFiles"))}),AttachedFormFiles:es.Type.Object({name:es.Type.String(),url:es.Type.String(),mimeType:es.Type.String()}),UpdateAttachedFormStringFieldSet:es.Type.Object({path:es.Type.String(),value:es.Type.String()}),UpdateAttachedFormStringFieldAppend:es.Type.Object({path:es.Type.String(),value:es.Type.String()}),SelectedRagContext:es.Type.Object({replitDocumentationQuery:es.Type.String(),fileSearchQuery:es.Type.String(),selectedFiles:es.Type.String(),selectedClasses:es.Type.String()}),AssistantProposedActions:es.Type.Object({summary:es.Type.String(),commitId:es.Type.String(),shellCommands:es.Type.Array(es.Type.Ref("ProposedShellCommand")),fileChanges:es.Type.Array(es.Type.Ref("ProposedFileChange")),workspaceToolNudges:es.Type.Array(es.Type.Ref("ProposedWorkspaceToolNudge")),packageInstalls:es.Type.Array(es.Type.Ref("ProposedPackageInstall")),didCreateCheckpoint:es.Type.Boolean(),didCountEditRequest:es.Type.Boolean(),runConfigurations:es.Type.Array(es.Type.Ref("ProposedRunConfiguration")),deploymentConfigurations:es.Type.Array(es.Type.Ref("ProposedDeploymentConfiguration")),workflowConfigurations:es.Type.Array(es.Type.Ref("ProposedWorkflowConfiguration"))}),IntegrationTestEventContents:es.Type.Object({expectedResponseString:es.Type.String(),streamedResponse:es.Type.Boolean(),timeBetweenChunks:es.Type.Number()}),ContextComplexityEventContents:es.Type.Object({fullness:es.Type.Number()}),EventTooLargeEventContents:es.Type.Object({}),IntegrationTestEventContext:es.Type.Object({}),AttachedUrl:es.Type.Object({url:es.Type.String(),intent:es.Type.Ref("UrlIntent")}),UploadedFile:es.Type.Object({path:es.Type.String(),mimeType:es.Type.String()}),UploadedRapidBuildFile:es.Type.Object({fileName:es.Type.String(),downloadUrl:es.Type.String()}),BenchmarkParameters:es.Type.Object({datasetId:es.Type.String(),instanceId:es.Type.String(),runId:es.Type.String(),replDescription:es.Type.String(),disableSandbox:es.Type.Boolean(),commandPrefix:es.Type.Array(es.Type.String()),overrideShellExecuteTimeoutSeconds:es.Type.Number(),overrideMaxSteps:es.Type.Number()}),SuggestedTemplates:es.Type.Object({suggestedTemplates:es.Type.Array(es.Type.Ref("SuggestedTemplate"))}),SuggestedTemplate:es.Type.Object({name:es.Type.String(),replId:es.Type.String(),description:es.Type.String(),icon:es.Type.String(),language:es.Type.String(),id:es.Type.String(),ownerUsername:es.Type.String(),slug:es.Type.String()}),ProposedFileChanges:es.Type.Object({changes:es.Type.Array(es.Type.Ref("ProposedFileChange")),commitId:es.Type.String(),summary:es.Type.String()}),ProposedFileChange:es.Type.Object({filePath:es.Type.String(),content:es.Type.String(),changeSummary:es.Type.String(),state:es.Type.Ref("FileChangeGenerationState"),messageContentsOffset:es.Type.Number(),diff:es.Type.String()}),ProposedShellCommand:es.Type.Object({messageContentsOffset:es.Type.Number(),command:es.Type.String(),workingDirectory:es.Type.String(),isDangerous:es.Type.Boolean()}),ProposedPackageInstall:es.Type.Object({messageContentsOffset:es.Type.Number(),language:es.Type.String(),packageList:es.Type.Array(es.Type.String())}),ProposedWorkspaceToolNudge:es.Type.Object({messageContentsOffset:es.Type.Number(),toolName:es.Type.String(),reason:es.Type.String(),description:es.Type.String()}),ProposedRunConfiguration:es.Type.Object({messageContentsOffset:es.Type.Number(),workflowName:es.Type.String(),setRunButton:es.Type.Boolean(),oldCommand:es.Type.String(),newCommand:es.Type.String()}),ProposedWorkflowConfiguration:es.Type.Object({messageContentsOffset:es.Type.Number(),workflowName:es.Type.String(),commands:es.Type.Array(es.Type.String()),setRunButton:es.Type.Boolean(),mode:es.Type.String()}),ProposedDeploymentConfiguration:es.Type.Object({messageContentsOffset:es.Type.Number(),buildCommand:es.Type.String(),runCommand:es.Type.String()}),Source:es.Type.Object({url:es.Type.String(),contents:es.Type.String(),lineNumber:es.Type.Number(),id:es.Type.String()}),InlineActionEventContents:es.Type.Object({messageType:es.Type.Ref("InlineMessageType"),debugErrorSource:es.Type.Ref("DebugErrorSource"),content:es.Type.String(),codeReference:es.Type.Optional(es.Type.Union([es.Type.Ref("CodeReference"),es.Type.Undefined()])),usedModelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()])),media:es.Type.Array(es.Type.Ref("MediaReference")),sources:es.Type.Array(es.Type.Ref("Source"))}),ShellSuggestionEventContents:es.Type.Object({content:es.Type.String()}),SessionCreationEventContext:es.Type.Object({}),TranslateEventContents:es.Type.Object({inputTarget:es.Type.Ref("TranslationTarget"),outputTarget:es.Type.Ref("TranslationTarget"),content:es.Type.String()}),TranslateEventContext:es.Type.Object({modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),LocalShellExecutionEventContents:es.Type.Object({command:es.Type.String(),result:es.Type.String(),eventId:es.Type.String(),index:es.Type.Number(),exitCode:es.Type.Number(),channelName:es.Type.String(),executed:es.Type.Boolean()}),LocalShellExecutionEventContext:es.Type.Object({}),ShellSuggestionEventContext:es.Type.Object({modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),ModelSelector:es.Type.Object({type:es.Type.Ref("ModelType"),overrideModelName:es.Type.String()}),EventError:es.Type.Object({type:es.Type.Ref("EventErrorType"),message:es.Type.String(),shortMessage:es.Type.String()}),MediaReference:es.Type.Object({identifier:es.Type.String(),url:es.Type.String(),mimeType:es.Type.String()}),AgentConfig:es.Type.Object({maxSteps:es.Type.Number(),enablePlanMode:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),enableHumanInLoop:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),thinkingEnabled:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),modelProfile:es.Type.Ref("ModelProfile"),enableAutomatedTesting:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),samplingRate:es.Type.Number(),webSearchEnabled:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),agentMode:es.Type.Ref("AgentMode"),imageGenerationEnabled:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),initialBuildMode:es.Type.Ref("AgentInitialBuildMode"),maxAutonomyEnabled:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),autonomyLevel:es.Type.Ref("AutonomyLevel"),agentInitialBuildTier:es.Type.Ref("AgentInitialBuildTier"),headlessMode:es.Type.Boolean(),workspaceLessMode:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()]))}),MessageEventContext:es.Type.Object({mostRecentFile:es.Type.String(),fileContext:es.Type.Array(es.Type.Ref("CodeReference")),modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()])),intent:es.Type.Ref("MessageAction"),extraResources:es.Type.Array(es.Type.String()),useRag:es.Type.Boolean(),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()])),messageSource:es.Type.Ref("MessageSource")}),InlineActionEventContext:es.Type.Object({mostRecentFile:es.Type.String(),fileContext:es.Type.Array(es.Type.Ref("CodeReference")),modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()])),extraResources:es.Type.Array(es.Type.String()),useRag:es.Type.Boolean()}),UpdateEventOperation:es.Type.Object({id:es.Type.String(),operationType:es.Type.Ref("UpdateEventOperationType"),key:es.Type.String(),value:es.Type.String(),intValue:es.Type.Number(),boolValue:es.Type.Boolean(),protobufValue:es.Type.Optional(es.Type.Union([es.Type.Ref("Any"),es.Type.Undefined()])),structValue:es.Type.Optional(es.Type.Union([es.Type.Ref("Struct"),es.Type.Undefined()]))}),TypedUpdateEventOperation:es.Type.Object({id:es.Type.String(),operation:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("messageContentsUpdate"),value:es.Type.Ref("MessageContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("shellSuggestionContentsUpdate"),value:es.Type.Ref("ShellSuggestionContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("addSourcesUpdate"),value:es.Type.Ref("AddSourcesUpdate")}),es.Type.Object({$case:es.Type.Literal("addSuggestedTemplatesUpdate"),value:es.Type.Ref("AddSuggestedTemplatesUpdate")}),es.Type.Object({$case:es.Type.Literal("byoPromptResultUpdate"),value:es.Type.Ref("BYOPromptResultUpdate")}),es.Type.Object({$case:es.Type.Literal("messageContentsSet"),value:es.Type.Ref("MessageContentsSet")}),es.Type.Object({$case:es.Type.Literal("agentTimelineEventSet"),value:es.Type.Ref("AgentTimelineEventSet")}),es.Type.Object({$case:es.Type.Literal("hostingDebugSummaryEventSet"),value:es.Type.Ref("HostingDebugSummaryEventSet")}),es.Type.Object({$case:es.Type.Literal("replCreationEventSet"),value:es.Type.Ref("ReplCreationEventSet")}),es.Type.Object({$case:es.Type.Literal("localShellExecutionEventSet"),value:es.Type.Ref("LocalShellExecutionEventSet")}),es.Type.Object({$case:es.Type.Literal("agentTimelineEventCreateFileAddContent"),value:es.Type.Ref("AgentTimelineEventCreateFileAddContent")}),es.Type.Object({$case:es.Type.Literal("addProposedFileChange"),value:es.Type.Ref("AddProposedFileChange")}),es.Type.Object({$case:es.Type.Literal("updateProposedFileChange"),value:es.Type.Ref("UpdateProposedFileChange")}),es.Type.Object({$case:es.Type.Literal("addProposedFileChangesMetadata"),value:es.Type.Ref("AddProposedFileChangesMetadata")}),es.Type.Object({$case:es.Type.Literal("addProposedShellCommand"),value:es.Type.Ref("AddProposedShellCommand")}),es.Type.Object({$case:es.Type.Literal("addProposedActionsMetadata"),value:es.Type.Ref("AddProposedActionsMetadata")}),es.Type.Object({$case:es.Type.Literal("agentAskUserForActionRequestSet"),value:es.Type.Ref("AgentAskUserForActionRequestSet")}),es.Type.Object({$case:es.Type.Literal("addRagContext"),value:es.Type.Ref("AddRagContext")}),es.Type.Object({$case:es.Type.Literal("addProposedWorkspaceToolNudge"),value:es.Type.Ref("AddProposedWorkspaceToolNudge")}),es.Type.Object({$case:es.Type.Literal("integrationTestEventContents"),value:es.Type.Ref("IntegrationTestEventContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("addProposedPackageInstall"),value:es.Type.Ref("AddProposedPackageInstall")}),es.Type.Object({$case:es.Type.Literal("updateRevertStatus"),value:es.Type.Ref("UpdateRevertStatus")}),es.Type.Object({$case:es.Type.Literal("updateAttachedFormStringFieldSet"),value:es.Type.Ref("UpdateAttachedFormStringFieldSet")}),es.Type.Object({$case:es.Type.Literal("updateAttachedFormStringFieldAppend"),value:es.Type.Ref("UpdateAttachedFormStringFieldAppend")}),es.Type.Object({$case:es.Type.Literal("addProposedRunConfiguration"),value:es.Type.Ref("AddProposedRunConfiguration")}),es.Type.Object({$case:es.Type.Literal("addProposedDeploymentConfiguration"),value:es.Type.Ref("AddProposedDeploymentConfiguration")}),es.Type.Object({$case:es.Type.Literal("appendTimelineMessageContentsUpdate"),value:es.Type.Ref("AppendTimelineMessageContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("appendThoughtContentsUpdate"),value:es.Type.Ref("AppendThoughtContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("appendRedactedThoughtsMarker"),value:es.Type.Ref("AppendRedactedThoughtsMarkerUpdate")}),es.Type.Object({$case:es.Type.Literal("addProposedWorkflowConfiguration"),value:es.Type.Ref("AddProposedWorkflowConfiguration")}),es.Type.Object({$case:es.Type.Literal("updateFileEditLineCounts"),value:es.Type.Ref("UpdateFileEditLineCountsUpdate")}),es.Type.Object({$case:es.Type.Literal("addDesignReferenceFile"),value:es.Type.Ref("AddDesignReferenceFile")}),es.Type.Object({$case:es.Type.Literal("updatePlanContents"),value:es.Type.Ref("UpdatePlanContents")}),es.Type.Object({$case:es.Type.Literal("updatePlanApprovalStatus"),value:es.Type.Ref("UpdatePlanApprovalStatus")}),es.Type.Object({$case:es.Type.Literal("newThoughtSummaryUpdate"),value:es.Type.Ref("NewThoughtSummaryUpdate")}),es.Type.Object({$case:es.Type.Literal("samplingEventUpdate"),value:es.Type.Ref("SamplingEventUpdate")}),es.Type.Object({$case:es.Type.Literal("samplingEventStateUpdate"),value:es.Type.Ref("SamplingEventStateUpdate")}),es.Type.Object({$case:es.Type.Literal("uiTestingSubagentExecutionEventUpdate"),value:es.Type.Ref("UITestingSubagentExecutionEventContentsUpdate")}),es.Type.Object({$case:es.Type.Literal("subagentRunningDataUpdate"),value:es.Type.Ref("SubagentRunningDataUpdate")}),es.Type.Object({$case:es.Type.Literal("upsertGeneratedMediaData"),value:es.Type.Ref("UpsertGeneratedMediaData")}),es.Type.Object({$case:es.Type.Literal("subagentReportResultUpdate"),value:es.Type.Ref("SubagentReportResultUpdate")}),es.Type.Object({$case:es.Type.Literal("messagedBackgroundAgentDataUpdate"),value:es.Type.Ref("MessagedBackgroundAgentDataUpdate")}),es.Type.Object({$case:es.Type.Literal("stoppedSubagentRunningUpdate"),value:es.Type.Ref("StoppedSubagentRunningUpdate")}),es.Type.Undefined()]))}),AppendTimelineMessageContentsUpdate:es.Type.Object({content:es.Type.String()}),AppendThoughtContentsUpdate:es.Type.Object({content:es.Type.String(),totalTimeTakenMs:es.Type.Number()}),NewThoughtSummaryUpdate:es.Type.Object({summary:es.Type.String()}),AppendRedactedThoughtsMarkerUpdate:es.Type.Object({marker:es.Type.Optional(es.Type.Union([es.Type.Ref("RedactedThoughtsMarker"),es.Type.Undefined()]))}),AgentTimelineEventSet:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentTimelineEventContents"),es.Type.Undefined()]))}),HostingDebugSummaryEventSet:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Ref("HostingDebugSummaryEventContents"),es.Type.Undefined()]))}),ReplCreationEventSet:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Ref("ReplCreationEventContents"),es.Type.Undefined()]))}),MessageContentsUpdate:es.Type.Object({content:es.Type.String()}),IntegrationTestEventContentsUpdate:es.Type.Object({content:es.Type.String()}),AgentAskUserForActionRequestSet:es.Type.Object({request:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentAskUserForActionRequest"),es.Type.Undefined()]))}),MessageContentsSet:es.Type.Object({content:es.Type.String()}),ShellSuggestionContentsUpdate:es.Type.Object({content:es.Type.String()}),LocalShellExecutionEventSet:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Ref("LocalShellExecutionEventContents"),es.Type.Undefined()]))}),AgentTimelineEventCreateFileAddContent:es.Type.Object({content:es.Type.String()}),AddSourcesUpdate:es.Type.Object({sources:es.Type.Array(es.Type.Ref("Source"))}),AddSuggestedTemplatesUpdate:es.Type.Object({templates:es.Type.Array(es.Type.Ref("SuggestedTemplate"))}),AddProposedActionsMetadata:es.Type.Object({summary:es.Type.String(),commitId:es.Type.String(),didCreateCheckpoint:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),didCountEditRequest:es.Type.Boolean()}),AddRagContext:es.Type.Object({newContext:es.Type.Optional(es.Type.Union([es.Type.Ref("SelectedRagContext"),es.Type.Undefined()]))}),AddProposedFileChangesMetadata:es.Type.Object({summary:es.Type.String()}),AddProposedFileChange:es.Type.Object({change:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedFileChange"),es.Type.Undefined()])),commitId:es.Type.String()}),UpdateProposedFileChange:es.Type.Object({update:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedFileChange"),es.Type.Undefined()])),replacement:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedFileChange"),es.Type.Undefined()]))}),AddProposedShellCommand:es.Type.Object({command:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedShellCommand"),es.Type.Undefined()]))}),AddProposedPackageInstall:es.Type.Object({packageInstalls:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedPackageInstall"),es.Type.Undefined()]))}),UpdateRevertStatus:es.Type.Object({newStatus:es.Type.Ref("RevertStatus")}),AddProposedWorkspaceToolNudge:es.Type.Object({nudge:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedWorkspaceToolNudge"),es.Type.Undefined()]))}),AddProposedRunConfiguration:es.Type.Object({runConfiguration:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedRunConfiguration"),es.Type.Undefined()]))}),AddProposedWorkflowConfiguration:es.Type.Object({workflowConfiguration:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedWorkflowConfiguration"),es.Type.Undefined()]))}),UpdateFileEditLineCountsUpdate:es.Type.Object({removedLines:es.Type.Number(),addedLines:es.Type.Number()}),AddProposedDeploymentConfiguration:es.Type.Object({deploymentConfiguration:es.Type.Optional(es.Type.Union([es.Type.Ref("ProposedDeploymentConfiguration"),es.Type.Undefined()]))}),AddDesignReferenceFile:es.Type.Object({filePath:es.Type.String()}),UpdatePlanContents:es.Type.Object({planId:es.Type.String(),step:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanStep"),es.Type.Undefined()])),objective:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentPlanObjective"),es.Type.Undefined()])),initialCommitId:es.Type.String(),stackBlueprint:es.Type.Ref("StackBlueprint"),agentStackTriggerType:es.Type.Ref("AgentStackTriggerType")}),UpdatePlanApprovalStatus:es.Type.Object({requiresApproval:es.Type.Boolean()}),BYOPromptResultUpdate:es.Type.Object({jsonResult:es.Type.String()}),GovalToken:es.Type.Object({token:es.Type.String(),gurl:es.Type.String()}),AuthToken:es.Type.Object({user:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),replIds:es.Type.Array(es.Type.String()),issuer:es.Type.String(),overrideGovalToken:es.Type.Optional(es.Type.Union([es.Type.Ref("GovalToken"),es.Type.Undefined()])),forkReplId:es.Type.String()}),UserContext:es.Type.Object({type:es.Type.Ref("UserType"),id:es.Type.String(),username:es.Type.String(),membership:es.Type.Ref("MembershipType"),roles:es.Type.Array(es.Type.String()),isTeam:es.Type.Boolean(),orgId:es.Type.String(),timeCreated:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),flaggingContext:es.Type.String(),modelfarmDisabled:es.Type.Boolean(),openrouterDisabled:es.Type.Boolean(),openaiDisabled:es.Type.Boolean(),anthropicDisabled:es.Type.Boolean(),geminiDisabled:es.Type.Boolean(),isEnterprise:es.Type.Boolean()}),CreateEventRequest:es.Type.Object({parentEventId:es.Type.String(),sessionId:es.Type.String(),state:es.Type.Ref("EventState"),contents:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContents"),es.Type.Undefined()])),context:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContext"),es.Type.Undefined()])),eventId:es.Type.String(),error:es.Type.Optional(es.Type.Union([es.Type.Ref("EventError"),es.Type.Undefined()])),isActive:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),addToChild:es.Type.Boolean()}),CreateEventResponse:es.Type.Object({eventId:es.Type.String(),parentEventId:es.Type.String(),created:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),CreateEventRequestWithUser:es.Type.Object({request:es.Type.Optional(es.Type.Union([es.Type.Ref("CreateEventRequest"),es.Type.Undefined()])),user:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()]))}),BatchCreateEventsRequest:es.Type.Object({events:es.Type.Array(es.Type.Ref("CreateEventRequestWithUser"))}),BatchCreateEventsResponse:es.Type.Object({eventIds:es.Type.Array(es.Type.String())}),UpdateEventRequest:es.Type.Object({eventId:es.Type.String(),operations:es.Type.Array(es.Type.Ref("UpdateEventOperation")),typedOperations:es.Type.Array(es.Type.Ref("TypedUpdateEventOperation")),state:es.Type.Ref("EventState"),error:es.Type.Optional(es.Type.Union([es.Type.Ref("EventError"),es.Type.Undefined()])),requireCompletion:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()]))}),UpdateEventResponse:es.Type.Object({}),UpdateAgentStateRequest:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String(),runState:es.Type.Ref("AgentRunState"),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentStateTransitionReason"),es.Type.Undefined()]))}),GetAgentStateRequest:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String()}),GetAgentStateResponse:es.Type.Object({runState:es.Type.Ref("AgentRunState"),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentStateTransitionReason"),es.Type.Undefined()]))}),UpdateAgentStateResponse:es.Type.Object({runState:es.Type.Ref("AgentRunState"),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentStateTransitionReason"),es.Type.Undefined()]))}),UpdateAgentStateMessage:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String(),runState:es.Type.Ref("AgentRunState"),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentStateTransitionReason"),es.Type.Undefined()]))}),BroadcastAgentStateRequest:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String(),runState:es.Type.Ref("AgentRunState"),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentStateTransitionReason"),es.Type.Undefined()]))}),BroadcastAgentStateResponse:es.Type.Object({}),AgentStateTransitionReason:es.Type.Object({reasons:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("userPaused"),value:es.Type.Ref("AgentStateTransitionReasonUserPaused")}),es.Type.Object({$case:es.Type.Literal("stepLimitExceeded"),value:es.Type.Ref("AgentStateTransitionReasonStepLimitExceeded")}),es.Type.Object({$case:es.Type.Literal("rateLimited"),value:es.Type.Ref("AgentStateTransitionReasonRateLimited")}),es.Type.Object({$case:es.Type.Literal("waitingOnUserResponse"),value:es.Type.Ref("AgentStateTransitionReasonWaitingOnUserResponse")}),es.Type.Object({$case:es.Type.Literal("waitingOnPlanApproval"),value:es.Type.Ref("AgentStateTransitionReasonWaitingOnPlanApproval")}),es.Type.Object({$case:es.Type.Literal("requestedSecrets"),value:es.Type.Ref("AgentStateTransitionReasonRequestedSecrets")}),es.Type.Object({$case:es.Type.Literal("testConcluded"),value:es.Type.Ref("AgentStateTransitionReasonTestConcluded")}),es.Type.Object({$case:es.Type.Literal("error"),value:es.Type.Ref("AgentStateTransitionReasonError")}),es.Type.Object({$case:es.Type.Literal("planConcluded"),value:es.Type.Ref("AgentStateTransitionReasonPlanConcluded")}),es.Type.Object({$case:es.Type.Literal("reverted"),value:es.Type.Ref("AgentStateTransitionReasonReverted")}),es.Type.Object({$case:es.Type.Literal("authorizationFailed"),value:es.Type.Ref("AgentStateTransitionReasonAuthorizationFailed")}),es.Type.Object({$case:es.Type.Literal("stepTooComplex"),value:es.Type.Ref("AgentStateTransitionReasonStepTooComplex")}),es.Type.Object({$case:es.Type.Literal("triggerCheckpoint"),value:es.Type.Ref("AgentStateTransitionReasonTriggerCheckpoint")}),es.Type.Undefined()]))}),AgentStateTransitionReasonUserPaused:es.Type.Object({}),AgentStateTransitionReasonStepLimitExceeded:es.Type.Object({maxSteps:es.Type.Number()}),AgentStateTransitionReasonRateLimited:es.Type.Object({timeWhenReset:es.Type.String()}),AgentStateTransitionReasonAuthorizationFailed:es.Type.Object({code:es.Type.Ref("AgentAuthorizationFailedCode"),message:es.Type.String()}),AgentStateTransitionReasonWaitingOnUserResponse:es.Type.Object({}),AgentStateTransitionReasonRequestedSecrets:es.Type.Object({}),AgentStateTransitionReasonWaitingOnPlanApproval:es.Type.Object({}),AgentStateTransitionReasonTestConcluded:es.Type.Object({}),AgentStateTransitionReasonPlanConcluded:es.Type.Object({}),AgentStateTransitionReasonError:es.Type.Object({}),AgentStateTransitionReasonReverted:es.Type.Object({}),AgentStateTransitionReasonStepTooComplex:es.Type.Object({}),AgentStateTransitionReasonTriggerCheckpoint:es.Type.Object({}),ReprocessEventRequest:es.Type.Object({eventId:es.Type.String(),context:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContext"),es.Type.Undefined()]))}),ReprocessEventResponse:es.Type.Object({}),GetResourceUploadUrlRequest:es.Type.Object({mimeType:es.Type.String()}),GetResourceUploadUrlResponse:es.Type.Object({uploadUrl:es.Type.String(),downloadUrl:es.Type.String(),identifier:es.Type.String()}),GetUrlScreenshotRequest:es.Type.Object({url:es.Type.String()}),GetUrlScreenshotResponse:es.Type.Object({imageDownloadUrl:es.Type.String()}),GetUrlScrapedContentRequest:es.Type.Object({url:es.Type.String()}),GetUrlScrapedContentResponse:es.Type.Object({content:es.Type.String()}),GetUrlBrandingRequest:es.Type.Object({url:es.Type.String()}),GetUrlBrandingResponse:es.Type.Object({branding:es.Type.String()}),AbortEventRequest:es.Type.Object({eventId:es.Type.String()}),AbortEventResponse:es.Type.Object({eventId:es.Type.String()}),GetReplSessionsRequest:es.Type.Object({beforeTimestamp:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()])),limit:es.Type.Number(),includeFirstSessionEvents:es.Type.Boolean(),firstSessionEventsLimit:es.Type.Number(),replId:es.Type.String(),sessionTypes:es.Type.Array(es.Type.Ref("SessionType")),archived:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()]))}),GetReplSessionsResponse:es.Type.Object({hasMore:es.Type.Boolean(),sessions:es.Type.Array(es.Type.Ref("Session")),replAgentState:es.Type.Optional(es.Type.Union([es.Type.Ref("ReplAgentState"),es.Type.Undefined()]))}),EnhanceAgentPromptRequest:es.Type.Object({userPrompt:es.Type.String(),uploadedFiles:es.Type.Array(es.Type.Ref("UploadedFile")),attachedUrls:es.Type.Array(es.Type.Ref("AttachedUrl")),selectedTheme:es.Type.String()}),EnhanceAgentPromptResponse:es.Type.Object({enhancedPrompt:es.Type.String()}),GetSessionEventsRequest:es.Type.Object({sessionId:es.Type.String(),limit:es.Type.Number(),excludeContents:es.Type.Boolean(),afterTimestamp:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),GetSessionEventsResponse:es.Type.Object({events:es.Type.Array(es.Type.Ref("Event")),session:es.Type.Optional(es.Type.Union([es.Type.Ref("Session"),es.Type.Undefined()]))}),BatchGetEventsRequest:es.Type.Object({sessionId:es.Type.String(),eventIds:es.Type.Array(es.Type.String())}),BatchGetEventsResponse:es.Type.Object({events:es.Type.Array(es.Type.Ref("Event"))}),CreateSessionRequest:es.Type.Object({replId:es.Type.String(),sessionType:es.Type.Ref("SessionType"),title:es.Type.String(),seededAiFirstEventContents:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContents"),es.Type.Undefined()])),taskId:es.Type.String(),revertedToSessionId:es.Type.String(),revertedToEventId:es.Type.String()}),CreateSessionResponse:es.Type.Object({sessionId:es.Type.String(),sessionCreationEventId:es.Type.String(),seededAiFirstEventId:es.Type.String()}),GetEventListRequest:es.Type.Object({sessionId:es.Type.String(),limit:es.Type.Number(),ancestorsOf:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),afterTimestamp:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),GetEventListResponse:es.Type.Object({shapes:es.Type.Array(es.Type.Ref("EventShape")),hasMore:es.Type.Boolean()}),SubscribeToReplEventsRequest:es.Type.Object({replId:es.Type.String()}),ReplEventsSubscriptionMessage:es.Type.Object({sender:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),seqno:es.Type.Number(),message:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("subscriptionStatusMessage"),value:es.Type.Ref("SubscriptionStatusMessage")}),es.Type.Object({$case:es.Type.Literal("createEventMessage"),value:es.Type.Ref("CreateEventMessage")}),es.Type.Object({$case:es.Type.Literal("createSessionMessage"),value:es.Type.Ref("CreateSessionMessage")}),es.Type.Object({$case:es.Type.Literal("updateEventMessage"),value:es.Type.Ref("UpdateEventMessage")}),es.Type.Object({$case:es.Type.Literal("updateSessionMessage"),value:es.Type.Ref("UpdateSessionMessage")}),es.Type.Object({$case:es.Type.Literal("abortEventMessage"),value:es.Type.Ref("AbortEventMessage")}),es.Type.Object({$case:es.Type.Literal("updateAgentStateMessage"),value:es.Type.Ref("UpdateAgentStateMessage")}),es.Type.Undefined()]))}),SubscriptionStatusMessage:es.Type.Object({}),CreateEventMessage:es.Type.Object({eventId:es.Type.String(),parentEventId:es.Type.String(),sessionId:es.Type.String(),state:es.Type.Ref("EventState"),contents:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContents"),es.Type.Undefined()])),sender:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),error:es.Type.Optional(es.Type.Union([es.Type.Ref("EventError"),es.Type.Undefined()])),isActive:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),created:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),CreateSessionMessage:es.Type.Object({sessionId:es.Type.String(),title:es.Type.String(),replId:es.Type.String(),sessionCreationEventId:es.Type.String(),sessionType:es.Type.Ref("SessionType"),archived:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),taskId:es.Type.String(),revertedToSessionId:es.Type.String(),revertedToEventId:es.Type.String()}),UpdateEventMessage:es.Type.Object({sessionId:es.Type.String(),eventId:es.Type.String(),operations:es.Type.Array(es.Type.Ref("UpdateEventOperation")),typedOperations:es.Type.Array(es.Type.Ref("TypedUpdateEventOperation")),state:es.Type.Ref("EventState"),error:es.Type.Optional(es.Type.Union([es.Type.Ref("EventError"),es.Type.Undefined()]))}),UpdateSessionMessage:es.Type.Object({sessionId:es.Type.String(),title:es.Type.String(),sessionType:es.Type.Ref("SessionType"),archived:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),replId:es.Type.String(),activeEventId:es.Type.String(),isActiveAgentSession:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),readOnly:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),taskId:es.Type.String()}),AbortEventMessage:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String(),eventId:es.Type.String()}),Limit:es.Type.Object({limit:es.Type.Number(),usage:es.Type.Number(),resetTime:es.Type.Optional(es.Type.Union([es.Type.Date(),es.Type.Undefined()]))}),GetAvailableModelRequest:es.Type.Object({overrideModel:es.Type.String()}),ModelName:es.Type.Object({readable:es.Type.String(),qualified:es.Type.String()}),GetAvailableModelsResponse:es.Type.Object({basicModel:es.Type.Array(es.Type.Ref("ModelName")),advancedModel:es.Type.Array(es.Type.Ref("ModelName")),overrideModel:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelName"),es.Type.Undefined()]))}),UpdateSessionRequest:es.Type.Object({id:es.Type.String(),title:es.Type.String(),sessionType:es.Type.Ref("SessionType"),archived:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),replId:es.Type.String(),activeEventId:es.Type.String(),isActiveAgentSession:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),readOnly:es.Type.Optional(es.Type.Union([es.Type.Boolean(),es.Type.Undefined()])),taskId:es.Type.String()}),UpdateSessionResponse:es.Type.Object({}),ProcessEventRequest:es.Type.Object({replId:es.Type.String(),contents:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContents"),es.Type.Undefined()])),context:es.Type.Optional(es.Type.Union([es.Type.Ref("EventContext"),es.Type.Undefined()])),sessionId:es.Type.String()}),ProcessEventResponseMessage:es.Type.Object({message:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("startMessage"),value:es.Type.Ref("ProcessEventStartMessage")}),es.Type.Object({$case:es.Type.Literal("createEventMessage"),value:es.Type.Ref("CreateEventMessage")}),es.Type.Object({$case:es.Type.Literal("updateEventMessage"),value:es.Type.Ref("UpdateEventMessage")}),es.Type.Undefined()]))}),ProcessEventStartMessage:es.Type.Object({rootId:es.Type.String()}),GenerateReplNameRequest:es.Type.Object({replId:es.Type.String(),prompt:es.Type.String()}),GenerateReplNameResponse:es.Type.Object({replName:es.Type.String()}),GenerateIconRequest:es.Type.Object({replId:es.Type.String(),prompt:es.Type.String()}),GenerateIconResponse:es.Type.Object({imageUrl:es.Type.String()}),Any:es.Type.Object({typeUrl:es.Type.String(),value:es.Type.Uint8Array()}),Struct:es.Type.Object({fields:es.Type.Array(es.Type.Ref("StructField")),type:es.Type.String()}),StructField:es.Type.Object({key:es.Type.String(),value:es.Type.Optional(es.Type.Union([es.Type.Ref("Value"),es.Type.Undefined()]))}),Value:es.Type.Object({kind:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("nullValue"),value:es.Type.Ref("NullValue")}),es.Type.Object({$case:es.Type.Literal("numberValue"),value:es.Type.Number()}),es.Type.Object({$case:es.Type.Literal("stringValue"),value:es.Type.String()}),es.Type.Object({$case:es.Type.Literal("boolValue"),value:es.Type.Boolean()}),es.Type.Object({$case:es.Type.Literal("structValue"),value:es.Type.Ref("Struct")}),es.Type.Object({$case:es.Type.Literal("listValue"),value:es.Type.Ref("ListValue")}),es.Type.Undefined()]))}),ListValue:es.Type.Object({values:es.Type.Array(es.Type.Ref("Value"))}),BYOPromptMessage:es.Type.Object({role:es.Type.String(),content:es.Type.String()}),BYOPromptResponseParameter:es.Type.Object({name:es.Type.String(),required:es.Type.Boolean(),parameterType:es.Type.Ref("BYOPromptResponseParameterType"),description:es.Type.String(),enums:es.Type.Array(es.Type.String())}),BYOPromptEventContents:es.Type.Object({historicalPrompt:es.Type.String(),messages:es.Type.Array(es.Type.Ref("BYOPromptMessage")),parameters:es.Type.Array(es.Type.Ref("BYOPromptResponseParameter")),result:es.Type.Optional(es.Type.Union([es.Type.Ref("Struct"),es.Type.Undefined()])),jsonResult:es.Type.String(),forceJson:es.Type.Boolean(),promptName:es.Type.String()}),BYOPromptEventContext:es.Type.Object({modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),RevertEventContents:es.Type.Object({commitId:es.Type.String(),message:es.Type.String(),eventIdBeforeRevert:es.Type.String(),originalSessionId:es.Type.String(),databaseRollbackTimestamp:es.Type.String(),deploymentBuildId:es.Type.String(),rollbackDatabase:es.Type.Boolean(),revertedToSessionId:es.Type.String(),revertedToEventId:es.Type.String()}),TriggerCheckpointEventContents:es.Type.Object({description:es.Type.String(),onlyIfDiff:es.Type.Boolean(),author:es.Type.Ref("CommitAuthor"),deploymentBuildId:es.Type.String()}),StepTooComplexAcknowledgementEventContents:es.Type.Object({cancelCurrentStep:es.Type.Boolean()}),AgentCapabilityUsage:es.Type.Object({standardModelProfileLlmCalls:es.Type.Number(),advancedModelProfileLlmCalls:es.Type.Number(),thinkingEnabledLlmCalls:es.Type.Number(),webSearchCalls:es.Type.Number(),rapidBuild:es.Type.Boolean(),testingSubagentRuns:es.Type.Number(),architectSubagentRuns:es.Type.Number(),generalSubagentRuns:es.Type.Number()}),TaskEffort:es.Type.Object({taskId:es.Type.String(),description:es.Type.String()}),GeneralEffort:es.Type.Object({}),AgentInitializationEffort:es.Type.Object({}),FreeQuickEditEffort:es.Type.Object({}),DiscountedEffort:es.Type.Object({effortType:es.Type.Ref("DiscountedEffortType")}),RelatedEffortBreakdown:es.Type.Object({effortType:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("task"),value:es.Type.Ref("TaskEffort")}),es.Type.Object({$case:es.Type.Literal("general"),value:es.Type.Ref("GeneralEffort")}),es.Type.Object({$case:es.Type.Literal("initialization"),value:es.Type.Ref("AgentInitializationEffort")}),es.Type.Object({$case:es.Type.Literal("freeQuickEdit"),value:es.Type.Ref("FreeQuickEditEffort")}),es.Type.Object({$case:es.Type.Literal("discountedEffort"),value:es.Type.Ref("DiscountedEffort")}),es.Type.Undefined()])),commitId:es.Type.String(),usageCents:es.Type.Number(),workDurationSeconds:es.Type.Number(),numLocRead:es.Type.Number(),numFilesRead:es.Type.Number(),addedLinesOfCode:es.Type.Number(),removedLinesOfCode:es.Type.Number()}),CommitData:es.Type.Object({commitId:es.Type.String(),screenshotUrl:es.Type.String(),description:es.Type.String(),billingRate:es.Type.Ref("CommitBillingRate"),author:es.Type.Ref("CommitAuthor"),progressSummary:es.Type.String(),usageCents:es.Type.Number(),workDurationSeconds:es.Type.Number(),addedLinesOfCode:es.Type.Number(),removedLinesOfCode:es.Type.Number(),toolCalls:es.Type.Number(),triggerReason:es.Type.Ref("CheckpointTriggerReason"),capabilityUsage:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentCapabilityUsage"),es.Type.Undefined()])),ubbV2:es.Type.Boolean(),numLocRead:es.Type.Number(),numFilesRead:es.Type.Number(),refunded:es.Type.Boolean(),relatedEffortBreakdowns:es.Type.Array(es.Type.Ref("RelatedEffortBreakdown")),heliumCheckpointCreated:es.Type.Boolean()}),ApprovePlanEventContents:es.Type.Object({planEventId:es.Type.String(),approver:es.Type.Optional(es.Type.Union([es.Type.Ref("UserContext"),es.Type.Undefined()])),initialBuildMode:es.Type.Ref("AgentInitialBuildMode"),userSecretsResponse:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentUserSecretsResponse"),es.Type.Undefined()])),agentConfig:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentConfig"),es.Type.Undefined()]))}),ApprovePlanEventContext:es.Type.Object({}),UserSecretsResponseEventContents:es.Type.Object({response:es.Type.Array(es.Type.Ref("UserSecretResponse"))}),HostingDebugSummaryErrorPorts:es.Type.Object({exposeLocalhost:es.Type.Boolean(),localPort:es.Type.String(),externalPort:es.Type.String()}),HostingDebugSummaryError:es.Type.Object({provider:es.Type.String(),buildCommand:es.Type.String(),runCommand:es.Type.String(),publicDir:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),appType:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),logs:es.Type.Array(es.Type.String()),envKeys:es.Type.Array(es.Type.String()),ports:es.Type.Array(es.Type.Ref("HostingDebugSummaryErrorPorts")),entrypointFilePath:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),HostingDebugSummarySuggestion:es.Type.Object({name:es.Type.String(),type:es.Type.String(),description:es.Type.String(),before:es.Type.String(),after:es.Type.String(),file:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),HostingDebugSummaryResult:es.Type.Object({errors:es.Type.Array(es.Type.String()),suggestions:es.Type.Array(es.Type.Ref("HostingDebugSummarySuggestion"))}),HostingDebugSummaryEventContents:es.Type.Object({error:es.Type.Optional(es.Type.Union([es.Type.Ref("HostingDebugSummaryError"),es.Type.Undefined()])),result:es.Type.Optional(es.Type.Union([es.Type.Ref("HostingDebugSummaryResult"),es.Type.Undefined()])),usedModelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),HostingDebugSummaryEventContext:es.Type.Object({modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),ReplCreationEventContents:es.Type.Object({errors:es.Type.Array(es.Type.String()),generatedReplName:es.Type.String(),isAgentRecommended:es.Type.Boolean(),bestTemplate:es.Type.Optional(es.Type.Union([es.Type.Ref("SuggestedTemplate"),es.Type.Undefined()])),matchedPlanNames:es.Type.Array(es.Type.String()),scaffoldTemplateName:es.Type.String()}),ReplCreationEventContext:es.Type.Object({modelSelector:es.Type.Optional(es.Type.Union([es.Type.Ref("ModelSelector"),es.Type.Undefined()]))}),UserSecretsResponseEventContext:es.Type.Object({}),IterativeAgentEventContents:es.Type.Object({contents:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("appliedFileChanges"),value:es.Type.Ref("IterativeAgentAppliedFileChanges")}),es.Type.Object({$case:es.Type.Literal("revertedFileChanges"),value:es.Type.Ref("IterativeAgentRevertedFileChanges")}),es.Type.Object({$case:es.Type.Literal("installingPackages"),value:es.Type.Ref("IterativeAgentInstallingPackages")}),es.Type.Object({$case:es.Type.Literal("installedPackages"),value:es.Type.Ref("IterativeAgentInstalledPackages")}),es.Type.Object({$case:es.Type.Literal("startedShellExecution"),value:es.Type.Ref("IterativeAgentStartedShellExecution")}),es.Type.Object({$case:es.Type.Literal("finishedShellExecution"),value:es.Type.Ref("IterativeAgentFinishedShellExecution")}),es.Type.Object({$case:es.Type.Literal("appliedRunConfiguration"),value:es.Type.Ref("IterativeAgentAppliedRunConfiguration")}),es.Type.Object({$case:es.Type.Literal("appliedDeploymentConfiguration"),value:es.Type.Ref("IterativeAgentAppliedDeploymentConfiguration")}),es.Type.Object({$case:es.Type.Literal("appliedWorkflowConfiguration"),value:es.Type.Ref("IterativeAgentAppliedWorkflowConfiguration")}),es.Type.Undefined()]))}),IterativeAgentAppliedFileChanges:es.Type.Object({eventWhichProposedChanges:es.Type.String(),appliedChanges:es.Type.Array(es.Type.Ref("AppliedFileChange")),commitHash:es.Type.String()}),IterativeAgentRevertedFileChanges:es.Type.Object({eventWhichProposedChanges:es.Type.String(),eventWhichAppliedChanges:es.Type.String(),revertedChanges:es.Type.Array(es.Type.Ref("RevertedFileChange"))}),IterativeAgentInstallingPackages:es.Type.Object({eventWhichProposedPackageInstall:es.Type.String(),messageContentsOffset:es.Type.Number(),processId:es.Type.String()}),IterativeAgentInstalledPackages:es.Type.Object({eventWhichProposedPackageInstall:es.Type.String(),messageContentsOffset:es.Type.Number(),installationOutput:es.Type.String(),processId:es.Type.String(),exitCode:es.Type.Number()}),AppliedFileChange:es.Type.Object({filePath:es.Type.String(),linesAdded:es.Type.Number(),linesRemoved:es.Type.Number(),changeSummary:es.Type.String()}),RevertedFileChange:es.Type.Object({filePath:es.Type.String(),changeSummary:es.Type.String()}),IterativeAgentStartedShellExecution:es.Type.Object({eventWhichProposedShellExecution:es.Type.String(),messageContentsOffset:es.Type.Number(),processId:es.Type.String()}),IterativeAgentFinishedShellExecution:es.Type.Object({eventWhichProposedShellExecution:es.Type.String(),messageContentsOffset:es.Type.Number(),processId:es.Type.String(),commandOutput:es.Type.String(),exitCode:es.Type.Number()}),IterativeAgentAppliedRunConfiguration:es.Type.Object({eventWhichProposedRunConfiguration:es.Type.String(),messageContentsOffset:es.Type.Number()}),IterativeAgentAppliedWorkflowConfiguration:es.Type.Object({eventWhichProposedWorkflowConfiguration:es.Type.String(),messageContentsOffset:es.Type.Number()}),IterativeAgentAppliedDeploymentConfiguration:es.Type.Object({eventWhichProposedDeploymentConfiguration:es.Type.String(),messageContentsOffset:es.Type.Number()}),IterativeAgentEventContext:es.Type.Object({}),SystemDependencyInstallData:es.Type.Object({deps:es.Type.Array(es.Type.String())}),SystemDependencyUninstallData:es.Type.Object({deps:es.Type.Array(es.Type.String())}),DeployConfigData:es.Type.Object({deploymentTarget:es.Type.String(),run:es.Type.Array(es.Type.String()),build:es.Type.Array(es.Type.String()),publicDir:es.Type.String(),ignorePorts:es.Type.Boolean()}),DeployData:es.Type.Object({}),RevertData:es.Type.Object({eventIdBeforeRevert:es.Type.String(),checkpointCommit:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),status:es.Type.Ref("RevertStatus"),originalSessionId:es.Type.String(),checkpointTitle:es.Type.String()}),AcknowledgeUserMessage:es.Type.Object({eventIds:es.Type.Array(es.Type.String())}),CreatePostgreSQLDatabaseData:es.Type.Object({}),SqlExecutionData:es.Type.Object({command:es.Type.String(),output:es.Type.String(),status:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("isExecuting"),value:es.Type.Boolean()}),es.Type.Object({$case:es.Type.Literal("exitCode"),value:es.Type.Number()}),es.Type.Undefined()]))}),ImageGenerationData:es.Type.Object({imagePath:es.Type.String(),imageDescription:es.Type.String()}),VideoGenerationData:es.Type.Object({videoPath:es.Type.String(),videoDescription:es.Type.String()}),GeneratedMedia:es.Type.Object({id:es.Type.String(),path:es.Type.String(),description:es.Type.String(),mediaType:es.Type.Ref("GeneratedMediaType"),error:es.Type.String()}),GenerateMediaData:es.Type.Object({media:es.Type.Array(es.Type.Ref("GeneratedMedia")),asynchronous:es.Type.Boolean()}),UpsertGeneratedMediaData:es.Type.Object({media:es.Type.Optional(es.Type.Union([es.Type.Ref("GeneratedMedia"),es.Type.Undefined()]))}),WaitingForBackgroundJobsData:es.Type.Object({waitingType:es.Type.Ref("WaitingForBackgroundJobType"),maxWaitTimeSeconds:es.Type.Number(),actualWaitTimeSeconds:es.Type.Number()}),NewSessionNudge:es.Type.Object({}),StepTooComplexEventContents:es.Type.Object({stepId:es.Type.String(),state:es.Type.Ref("StepTooComplexEventContentsState")}),UserTipRecommendationData:es.Type.Object({tipId:es.Type.String(),title:es.Type.String(),recommendedReason:es.Type.String()}),EndOfRunSummaryData:es.Type.Object({runId:es.Type.String(),usageCents:es.Type.Number(),preDiscountsUsageCents:es.Type.Number(),workDurationSeconds:es.Type.Number(),addedLinesOfCode:es.Type.Number(),removedLinesOfCode:es.Type.Number(),toolCalls:es.Type.Number(),capabilityUsage:es.Type.Optional(es.Type.Union([es.Type.Ref("AgentCapabilityUsage"),es.Type.Undefined()])),numLocRead:es.Type.Number(),numFilesRead:es.Type.Number(),refunded:es.Type.Boolean(),relatedEffortBreakdowns:es.Type.Array(es.Type.Ref("RelatedEffortBreakdown")),rollbackCheckpointSha:es.Type.String()}),UITestingSubagentEventContents:es.Type.Object({testingPlan:es.Type.String(),finalSummary:es.Type.String(),title:es.Type.String(),resultType:es.Type.Ref("UITestingSubagentResultType")}),GeneralSubagentEventContents:es.Type.Object({task:es.Type.String(),taskSummary:es.Type.String(),result:es.Type.String(),resultSummary:es.Type.String(),taskTitle:es.Type.String(),eventFilter:es.Type.Ref("GeneralSubagentEventFilter")}),SubagentStateTransitionReasonCompletedSuccessfully:es.Type.Object({}),SubagentStateTransitionReasonPaused:es.Type.Object({}),SubagentStateTransitionReason:es.Type.Object({reasons:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("completedSuccessfully"),value:es.Type.Ref("SubagentStateTransitionReasonCompletedSuccessfully")}),es.Type.Object({$case:es.Type.Literal("paused"),value:es.Type.Ref("SubagentStateTransitionReasonPaused")}),es.Type.Undefined()]))}),SubagentRunningData:es.Type.Object({subagentId:es.Type.String(),childSessionId:es.Type.String(),totalExecutionTimeSeconds:es.Type.Number(),subagentName:es.Type.String(),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("SubagentStateTransitionReason"),es.Type.Undefined()])),contents:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("uiTestingSubagentEventContents"),value:es.Type.Ref("UITestingSubagentEventContents")}),es.Type.Object({$case:es.Type.Literal("generalSubagentEventContents"),value:es.Type.Ref("GeneralSubagentEventContents")}),es.Type.Undefined()]))}),UITestingSubagentExecutionEventContents:es.Type.Object({gcsDownloadUrl:es.Type.String(),mimeType:es.Type.String(),narration:es.Type.String(),miniNarration:es.Type.String()}),UITestingSubagentTakeOverResultSuccess:es.Type.Object({userNotes:es.Type.String()}),UITestingSubagentTakeOverResultDeclined:es.Type.Object({}),UITestingSubagentTakeOverResultTimedOut:es.Type.Object({}),UITestingSubagentTakeOverData:es.Type.Object({userInstructions:es.Type.String(),result:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("success"),value:es.Type.Ref("UITestingSubagentTakeOverResultSuccess")}),es.Type.Object({$case:es.Type.Literal("declined"),value:es.Type.Ref("UITestingSubagentTakeOverResultDeclined")}),es.Type.Object({$case:es.Type.Literal("timedOut"),value:es.Type.Ref("UITestingSubagentTakeOverResultTimedOut")}),es.Type.Undefined()]))}),AgentConfigUpdateEventContents:es.Type.Object({operation:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("automatedTesting"),value:es.Type.Ref("AgentConfigUpdateAutomatedTesting")}),es.Type.Undefined()]))}),AgentConfigUpdateAutomatedTesting:es.Type.Object({enabled:es.Type.Boolean(),reason:es.Type.String()}),SamplingTrajectory:es.Type.Object({id:es.Type.String(),contents:es.Type.String(),state:es.Type.Ref("TrajectoryState")}),SamplingEvent:es.Type.Object({state:es.Type.Ref("SamplingEventState"),trajectories:es.Type.Array(es.Type.Ref("SamplingTrajectory"))}),SamplingEventUpdate:es.Type.Object({trajectoryId:es.Type.String(),contents:es.Type.String(),state:es.Type.Ref("TrajectoryState")}),SamplingEventStateUpdate:es.Type.Object({state:es.Type.Ref("SamplingEventState")}),UITestingSubagentExecutionEventContentsUpdate:es.Type.Object({state:es.Type.Optional(es.Type.Union([es.Type.Ref("UITestingSubagentExecutionEventContents"),es.Type.Undefined()]))}),SubagentRunningDataUpdate:es.Type.Object({state:es.Type.Optional(es.Type.Union([es.Type.Ref("SubagentRunningData"),es.Type.Undefined()])),totalExecutionTimeSeconds:es.Type.Number()}),StoppedSubagentRunningUpdate:es.Type.Object({totalExecutionTimeSeconds:es.Type.Number(),transitionReason:es.Type.Optional(es.Type.Union([es.Type.Ref("SubagentStateTransitionReason"),es.Type.Undefined()]))}),SetupObjectStorageData:es.Type.Object({bucketName:es.Type.String(),bucketId:es.Type.String()}),MoveEventsBetweenSessionsRequest:es.Type.Object({sourceSessionId:es.Type.String(),destinationSessionId:es.Type.String()}),MoveEventsBetweenSessionsResponse:es.Type.Object({}),AbortSubagentRequest:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String(),subagentId:es.Type.String()}),AbortSubagentResponse:es.Type.Object({}),WarmAgentRequest:es.Type.Object({replId:es.Type.String(),sessionId:es.Type.String()}),WarmAgentResponse:es.Type.Object({}),StockImageData:es.Type.Object({imageDescription:es.Type.String(),numberOfImages:es.Type.Number(),imageUrls:es.Type.Array(es.Type.String())}),AddingIntegrationsRequest:es.Type.Object({connectorIds:es.Type.Array(es.Type.String()),connectionIds:es.Type.Array(es.Type.String())}),AddingIntegrationsResponse:es.Type.Object({connectionIds:es.Type.Array(es.Type.String()),rejectedConnectionIds:es.Type.Array(es.Type.String()),rejectedConnectorIds:es.Type.Array(es.Type.String())}),InitialBuildStateUpdateEventContents:es.Type.Object({phase:es.Type.Ref("InitialBuildPhase")}),SearchIntegrationsData:es.Type.Object({query:es.Type.String(),numResults:es.Type.Number()}),ViewIntegrationData:es.Type.Object({name:es.Type.String()}),ViewLogsData:es.Type.Object({webviewConsole:es.Type.Boolean(),workflows:es.Type.Boolean(),deployment:es.Type.Boolean(),lsp:es.Type.Boolean()}),SetupModelfarmData:es.Type.Object({}),ViewSpecialFilesData:es.Type.Object({fileType:es.Type.Ref("SpecialFileType")}),DesignGuidelinesData:es.Type.Object({}),MCPToolData:es.Type.Object({toolName:es.Type.String(),serverName:es.Type.String(),parameters:es.Type.Optional(es.Type.Union([es.Type.Ref("Struct"),es.Type.Undefined()])),result:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPToolResult"),es.Type.Undefined()])),progress:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPToolProgress"),es.Type.Undefined()])),insecureError:es.Type.String()}),MCPToolParameter:es.Type.Object({key:es.Type.String(),value:es.Type.Optional(es.Type.Union([es.Type.Ref("Any"),es.Type.Undefined()]))}),MCPToolResult:es.Type.Object({content:es.Type.String(),contentBlocks:es.Type.Array(es.Type.Ref("MCPContentBlock")),structuredContent:es.Type.Optional(es.Type.Union([es.Type.Ref("Struct"),es.Type.Undefined()])),isError:es.Type.Boolean()}),MCPToolProgress:es.Type.Object({progress:es.Type.Number(),total:es.Type.Optional(es.Type.Union([es.Type.Number(),es.Type.Undefined()])),message:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),MCPContentBlock:es.Type.Object({block:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("textContent"),value:es.Type.Ref("MCPContentBlockTextContent")}),es.Type.Object({$case:es.Type.Literal("imageContent"),value:es.Type.Ref("MCPContentBlockImageContent")}),es.Type.Object({$case:es.Type.Literal("audioContent"),value:es.Type.Ref("MCPContentBlockAudioContent")}),es.Type.Object({$case:es.Type.Literal("resourceLink"),value:es.Type.Ref("MCPContentBlockResourceLink")}),es.Type.Object({$case:es.Type.Literal("embeddedResource"),value:es.Type.Ref("MCPContentBlockEmbeddedResource")}),es.Type.Undefined()]))}),MCPAnnotations:es.Type.Object({audience:es.Type.Array(es.Type.String()),priority:es.Type.Optional(es.Type.Union([es.Type.Number(),es.Type.Undefined()]))}),MCPContentBlockTextContent:es.Type.Object({text:es.Type.String(),annotations:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPAnnotations"),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),MCPContentBlockImageContent:es.Type.Object({data:es.Type.String(),mimeType:es.Type.String(),annotations:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPAnnotations"),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),MCPContentBlockAudioContent:es.Type.Object({data:es.Type.String(),mimeType:es.Type.String(),annotations:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPAnnotations"),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),MCPContentBlockResourceLink:es.Type.Object({name:es.Type.String(),title:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),uri:es.Type.String(),description:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),mimeType:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),size:es.Type.Optional(es.Type.Union([es.Type.Number(),es.Type.Undefined()])),annotations:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPAnnotations"),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),MCPResourceContents:es.Type.Object({uri:es.Type.String(),mimeType:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()])),contents:es.Type.Optional(es.Type.Union([es.Type.Object({$case:es.Type.Literal("text"),value:es.Type.String()}),es.Type.Object({$case:es.Type.Literal("blob"),value:es.Type.String()}),es.Type.Undefined()]))}),MCPContentBlockEmbeddedResource:es.Type.Object({resource:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPResourceContents"),es.Type.Undefined()])),annotations:es.Type.Optional(es.Type.Union([es.Type.Ref("MCPAnnotations"),es.Type.Undefined()])),meta:es.Type.Optional(es.Type.Union([es.Type.String(),es.Type.Undefined()]))}),AlertData:es.Type.Object({alertLevel:es.Type.Ref("AlertLevel"),message:es.Type.String(),nextAction:es.Type.Ref("AlertNextAction")}),EnvVar:es.Type.Object({key:es.Type.String(),environment:es.Type.Ref("EnvironmentType")}),EnvironmentConfigRequest:es.Type.Object({envVars:es.Type.Array(es.Type.Ref("EnvVar")),message:es.Type.String()}),ProvidedEnvVar:es.Type.Object({key:es.Type.String(),value:es.Type.String(),environment:es.Type.Ref("EnvironmentType")}),EnvironmentConfigResponse:es.Type.Object({providedEnvVars:es.Type.Array(es.Type.Ref("ProvidedEnvVar"))}),ViewEnvVarData:es.Type.Object({type:es.Type.Ref("EnvironmentVariableType"),environment:es.Type.Ref("EnvironmentType"),keys:es.Type.Array(es.Type.String())}),SetEnvVarData:es.Type.Object({type:es.Type.Ref("EnvironmentVariableType"),environment:es.Type.Ref("EnvironmentType"),keys:es.Type.Array(es.Type.String())}),DeleteEnvVarData:es.Type.Object({type:es.Type.Ref("EnvironmentVariableType"),environment:es.Type.Ref("EnvironmentType"),keys:es.Type.Array(es.Type.String())}),ClassifyInitialUserPromptRequest:es.Type.Object({userPrompt:es.Type.String(),uploadedFiles:es.Type.Array(es.Type.Ref("UploadedFile"))}),ClassifyInitialUserPromptResponse:es.Type.Object({stackType:es.Type.Ref("StackBlueprint"),agentInitialBuildTier:es.Type.Ref("AgentInitialBuildTier")}),MessagedBackgroundAgentData:es.Type.Object({message:es.Type.String(),summary:es.Type.String()}),MessagedBackgroundAgentDataUpdate:es.Type.Object({delta:es.Type.String()}),SubagentReportResultData:es.Type.Object({result:es.Type.String()}),SubagentReportResultUpdate:es.Type.Object({delta:es.Type.String()}),ReportAgentIssueData:es.Type.Object({})});tn.Import("AgentRunState"),tn.Import("AgentUserFeedbackType"),tn.Import("UserSecretResponseStatus"),tn.Import("ProjectImportSource"),tn.Import("TaskStatus"),tn.Import("AgentPlanStepStatus"),tn.Import("RequestFeatureAddType"),tn.Import("StackBlueprint"),tn.Import("AgentStackTriggerType"),tn.Import("BlueprintCategory"),tn.Import("WebSearchType"),tn.Import("BenchmarkConclusionReason"),tn.Import("AttachedFormType"),tn.Import("UrlIntent"),tn.Import("FileChangeGenerationState"),tn.Import("TranslationTarget"),tn.Import("ModelType"),tn.Import("CodeReferenceType"),tn.Import("DebugErrorSource"),tn.Import("EventState"),tn.Import("InlineMessageType"),tn.Import("UserType");var tr=tn.Import("SessionType");tn.Import("MessageStopReason"),tn.Import("MessageAction"),tn.Import("MembershipType"),tn.Import("EventErrorType"),tn.Import("AgentMode"),tn.Import("AgentInitialBuildMode"),tn.Import("AutonomyLevel"),tn.Import("AgentInitialBuildTier"),tn.Import("MessageSource"),tn.Import("ModelProfile"),tn.Import("UpdateEventOperationType"),tn.Import("AgentAuthorizationFailedCode"),tn.Import("NullValue"),tn.Import("BYOPromptResponseParameterType"),tn.Import("CommitAuthor"),tn.Import("CommitBillingRate"),tn.Import("CheckpointTriggerReason"),tn.Import("DiscountedEffortType"),tn.Import("RevertStatus"),tn.Import("GeneratedMediaType"),tn.Import("WaitingForBackgroundJobType"),tn.Import("StepTooComplexEventContentsState"),tn.Import("UITestingSubagentResultType"),tn.Import("GeneralSubagentEventFilter"),tn.Import("SamplingEventState"),tn.Import("TrajectoryState"),tn.Import("InitialBuildPhase"),tn.Import("SpecialFileType"),tn.Import("AlertLevel"),tn.Import("AlertNextAction"),tn.Import("EnvironmentType"),tn.Import("EnvironmentVariableType"),tn.Import("RevertToCommitRequest"),tn.Import("RevertToCommitResponse"),tn.Import("CloneSessionRequest"),tn.Import("CloneSessionResponse"),tn.Import("Ping"),tn.Import("Pong"),tn.Import("Event"),tn.Import("EventShape"),tn.Import("AgentUserFeedback"),tn.Import("SubmitAgentUserFeedbackRequest"),tn.Import("SubmitAgentUserFeedbackResponse"),tn.Import("ReplAgentState"),tn.Import("Session"),tn.Import("Secret"),tn.Import("SecretRequestAction"),tn.Import("UserSecretResponse"),tn.Import("DeployRequest"),tn.Import("DeployResponse"),tn.Import("MessageButton"),tn.Import("DeployRequestAction"),tn.Import("MessageButtonAction"),tn.Import("AgentUserSecretsRequest"),tn.Import("AgentUserSecretsResponse"),tn.Import("AgentDebugRequest"),tn.Import("AgentDebugResponse"),tn.Import("AgentContinueRequest"),tn.Import("AgentContinueResponse"),tn.Import("AgentNewFeatureRequest"),tn.Import("UserMessageContents"),tn.Import("AgentNewFeatureResponse"),tn.Import("AgentDeployRequest"),tn.Import("AgentDeployResponse"),tn.Import("AgentAction"),tn.Import("AgentNextStepRequest"),tn.Import("AgentNextStepResponse"),tn.Import("AgentQueryBoolean"),tn.Import("AgentQueryChoice"),tn.Import("AgentQueryText"),tn.Import("AgentQuery"),tn.Import("AgentQueryBooleanResponse"),tn.Import("AgentQueryChoiceResponse"),tn.Import("AgentQueryTextResponse"),tn.Import("AgentQueryNoResponse"),tn.Import("AgentQueryResponse"),tn.Import("QueryResponseContent"),tn.Import("QueryRequestContent"),tn.Import("MarkTaskCompleteRequest"),tn.Import("UserMarkedTaskComplete"),tn.Import("ApproveTaskListRequest"),tn.Import("ApproveTaskListResponse"),tn.Import("ApproveInitialBuildMVPRequest"),tn.Import("ApproveInitialBuildMVPResponse"),tn.Import("ApproveInitialBuildVisualPhaseRequest"),tn.Import("ApproveInitialBuildVisualPhaseResponse"),tn.Import("ApproveSqlQueryRequest"),tn.Import("ApproveSqlQueryResponse"),tn.Import("ApproveBlueprintRequest"),tn.Import("ApproveBlueprintResponse"),tn.Import("ConvertMockupToAppRequest"),tn.Import("ConvertMockupToAppResponse"),tn.Import("AgentAskUserForActionRequest"),tn.Import("AgentAskUserForActionResponse"),tn.Import("SetupImportedProjectEventContents"),tn.Import("ProjectImportCompletedData"),tn.Import("MemoryCompressionData"),tn.Import("TaskListData"),tn.Import("Task"),tn.Import("EventContents"),tn.Import("EventContext"),tn.Import("StartRapidBuildEventContents"),tn.Import("RapidBuildStartedData"),tn.Import("SessionCreationEventContents"),tn.Import("DatabaseNudgeEventContents"),tn.Import("CloudBudgetExceededEventContents"),tn.Import("CodeChangeStats"),tn.Import("AgentPlanStep"),tn.Import("BlueprintsSetup"),tn.Import("RequestFeatureAdd"),tn.Import("AgentPlanObjective"),tn.Import("AgentPlanEventContents"),tn.Import("AgentPlanEventContext"),tn.Import("RevertEventContext"),tn.Import("BlueprintData"),tn.Import("ShellExecutionData"),tn.Import("FileEditData"),tn.Import("CreateFileData"),tn.Import("ReadFileData"),tn.Import("ReadDirData"),tn.Import("PackagerInstallData"),tn.Import("PackagerUninstallData"),tn.Import("SearchFilesystemData"),tn.Import("WebSearchResultPage"),tn.Import("GoogleSuggestedSearch"),tn.Import("WebSearchData"),tn.Import("WebPageVisitData"),tn.Import("ScreenshotData"),tn.Import("ToolchainInstallData"),tn.Import("WorkflowsGetOutputToolData"),tn.Import("WorkflowsRemoveRunConfigToolData"),tn.Import("WorkflowsRestartToolData"),tn.Import("WorkflowsSetRunConfigToolData"),tn.Import("WorkflowsStartToolData"),tn.Import("WorkflowsStopToolData"),tn.Import("SuggestRollbackData"),tn.Import("PresentResultsToolData"),tn.Import("SearchFileData"),tn.Import("SuggestGeneralBuildModeData"),tn.Import("AgentTimelineEventContents"),tn.Import("AgentPlanStepBeginData"),tn.Import("SummarizeObjectiveData"),tn.Import("AgentThoughtsData"),tn.Import("RedactedThoughtsMarker"),tn.Import("RapidBuildConcludedData"),tn.Import("VersionMigratedData"),tn.Import("PlanProgressData"),tn.Import("BenchmarkConclusionEventContents"),tn.Import("BenchmarkMetrics"),tn.Import("Metric"),tn.Import("MetricByTag"),tn.Import("AgentTimelineEventContext"),tn.Import("Range"),tn.Import("CodeReference");var ti=tn.Import("MessageEventContents");tn.Import("TargetedElement"),tn.Import("RelatedElement"),tn.Import("AttachedForm"),tn.Import("AttachedFormField"),tn.Import("AttachedFormStringField"),tn.Import("AttachedFormFilesField"),tn.Import("AttachedFormFiles"),tn.Import("UpdateAttachedFormStringFieldSet"),tn.Import("UpdateAttachedFormStringFieldAppend"),tn.Import("SelectedRagContext"),tn.Import("AssistantProposedActions"),tn.Import("IntegrationTestEventContents"),tn.Import("ContextComplexityEventContents"),tn.Import("EventTooLargeEventContents"),tn.Import("IntegrationTestEventContext"),tn.Import("AttachedUrl"),tn.Import("UploadedFile"),tn.Import("UploadedRapidBuildFile"),tn.Import("BenchmarkParameters"),tn.Import("SuggestedTemplates"),tn.Import("SuggestedTemplate"),tn.Import("ProposedFileChanges"),tn.Import("ProposedFileChange"),tn.Import("ProposedShellCommand"),tn.Import("ProposedPackageInstall"),tn.Import("ProposedWorkspaceToolNudge"),tn.Import("ProposedRunConfiguration"),tn.Import("ProposedWorkflowConfiguration"),tn.Import("ProposedDeploymentConfiguration"),tn.Import("Source"),tn.Import("InlineActionEventContents"),tn.Import("ShellSuggestionEventContents"),tn.Import("SessionCreationEventContext"),tn.Import("TranslateEventContents"),tn.Import("TranslateEventContext"),tn.Import("LocalShellExecutionEventContents"),tn.Import("LocalShellExecutionEventContext"),tn.Import("ShellSuggestionEventContext"),tn.Import("ModelSelector"),tn.Import("EventError"),tn.Import("MediaReference");var to=tn.Import("AgentConfig");tn.Import("MessageEventContext"),tn.Import("InlineActionEventContext"),tn.Import("UpdateEventOperation"),tn.Import("TypedUpdateEventOperation"),tn.Import("AppendTimelineMessageContentsUpdate"),tn.Import("AppendThoughtContentsUpdate"),tn.Import("NewThoughtSummaryUpdate"),tn.Import("AppendRedactedThoughtsMarkerUpdate"),tn.Import("AgentTimelineEventSet"),tn.Import("HostingDebugSummaryEventSet"),tn.Import("ReplCreationEventSet"),tn.Import("MessageContentsUpdate"),tn.Import("IntegrationTestEventContentsUpdate"),tn.Import("AgentAskUserForActionRequestSet"),tn.Import("MessageContentsSet"),tn.Import("ShellSuggestionContentsUpdate"),tn.Import("LocalShellExecutionEventSet"),tn.Import("AgentTimelineEventCreateFileAddContent"),tn.Import("AddSourcesUpdate"),tn.Import("AddSuggestedTemplatesUpdate"),tn.Import("AddProposedActionsMetadata"),tn.Import("AddRagContext"),tn.Import("AddProposedFileChangesMetadata"),tn.Import("AddProposedFileChange"),tn.Import("UpdateProposedFileChange"),tn.Import("AddProposedShellCommand"),tn.Import("AddProposedPackageInstall"),tn.Import("UpdateRevertStatus"),tn.Import("AddProposedWorkspaceToolNudge"),tn.Import("AddProposedRunConfiguration"),tn.Import("AddProposedWorkflowConfiguration"),tn.Import("UpdateFileEditLineCountsUpdate"),tn.Import("AddProposedDeploymentConfiguration"),tn.Import("AddDesignReferenceFile"),tn.Import("UpdatePlanContents"),tn.Import("UpdatePlanApprovalStatus"),tn.Import("BYOPromptResultUpdate"),tn.Import("GovalToken"),tn.Import("AuthToken"),tn.Import("UserContext"),tn.Import("CreateEventRequest"),tn.Import("CreateEventResponse"),tn.Import("CreateEventRequestWithUser"),tn.Import("BatchCreateEventsRequest"),tn.Import("BatchCreateEventsResponse"),tn.Import("UpdateEventRequest"),tn.Import("UpdateEventResponse"),tn.Import("UpdateAgentStateRequest"),tn.Import("GetAgentStateRequest"),tn.Import("GetAgentStateResponse"),tn.Import("UpdateAgentStateResponse"),tn.Import("UpdateAgentStateMessage"),tn.Import("BroadcastAgentStateRequest"),tn.Import("BroadcastAgentStateResponse"),tn.Import("AgentStateTransitionReason"),tn.Import("AgentStateTransitionReasonUserPaused"),tn.Import("AgentStateTransitionReasonStepLimitExceeded"),tn.Import("AgentStateTransitionReasonRateLimited"),tn.Import("AgentStateTransitionReasonAuthorizationFailed"),tn.Import("AgentStateTransitionReasonWaitingOnUserResponse"),tn.Import("AgentStateTransitionReasonRequestedSecrets"),tn.Import("AgentStateTransitionReasonWaitingOnPlanApproval"),tn.Import("AgentStateTransitionReasonTestConcluded"),tn.Import("AgentStateTransitionReasonPlanConcluded"),tn.Import("AgentStateTransitionReasonError"),tn.Import("AgentStateTransitionReasonReverted"),tn.Import("AgentStateTransitionReasonStepTooComplex"),tn.Import("AgentStateTransitionReasonTriggerCheckpoint"),tn.Import("ReprocessEventRequest"),tn.Import("ReprocessEventResponse"),tn.Import("GetResourceUploadUrlRequest"),tn.Import("GetResourceUploadUrlResponse"),tn.Import("GetUrlScreenshotRequest"),tn.Import("GetUrlScreenshotResponse"),tn.Import("GetUrlScrapedContentRequest"),tn.Import("GetUrlScrapedContentResponse"),tn.Import("GetUrlBrandingRequest"),tn.Import("GetUrlBrandingResponse"),tn.Import("AbortEventRequest"),tn.Import("AbortEventResponse"),tn.Import("GetReplSessionsRequest"),tn.Import("GetReplSessionsResponse"),tn.Import("EnhanceAgentPromptRequest"),tn.Import("EnhanceAgentPromptResponse"),tn.Import("GetSessionEventsRequest"),tn.Import("GetSessionEventsResponse"),tn.Import("BatchGetEventsRequest"),tn.Import("BatchGetEventsResponse"),tn.Import("CreateSessionRequest"),tn.Import("CreateSessionResponse"),tn.Import("GetEventListRequest"),tn.Import("GetEventListResponse"),tn.Import("SubscribeToReplEventsRequest"),tn.Import("ReplEventsSubscriptionMessage"),tn.Import("SubscriptionStatusMessage"),tn.Import("CreateEventMessage"),tn.Import("CreateSessionMessage"),tn.Import("UpdateEventMessage"),tn.Import("UpdateSessionMessage"),tn.Import("AbortEventMessage"),tn.Import("Limit"),tn.Import("GetAvailableModelRequest"),tn.Import("ModelName"),tn.Import("GetAvailableModelsResponse"),tn.Import("UpdateSessionRequest"),tn.Import("UpdateSessionResponse"),tn.Import("ProcessEventRequest"),tn.Import("ProcessEventResponseMessage"),tn.Import("ProcessEventStartMessage"),tn.Import("GenerateReplNameRequest"),tn.Import("GenerateReplNameResponse"),tn.Import("GenerateIconRequest"),tn.Import("GenerateIconResponse"),tn.Import("Any"),tn.Import("Struct"),tn.Import("StructField"),tn.Import("Value"),tn.Import("ListValue"),tn.Import("BYOPromptMessage"),tn.Import("BYOPromptResponseParameter"),tn.Import("BYOPromptEventContents"),tn.Import("BYOPromptEventContext"),tn.Import("RevertEventContents"),tn.Import("TriggerCheckpointEventContents"),tn.Import("StepTooComplexAcknowledgementEventContents"),tn.Import("AgentCapabilityUsage"),tn.Import("TaskEffort"),tn.Import("GeneralEffort"),tn.Import("AgentInitializationEffort"),tn.Import("FreeQuickEditEffort"),tn.Import("DiscountedEffort"),tn.Import("RelatedEffortBreakdown"),tn.Import("CommitData"),tn.Import("ApprovePlanEventContents"),tn.Import("ApprovePlanEventContext"),tn.Import("UserSecretsResponseEventContents"),tn.Import("HostingDebugSummaryErrorPorts"),tn.Import("HostingDebugSummaryError"),tn.Import("HostingDebugSummarySuggestion"),tn.Import("HostingDebugSummaryResult"),tn.Import("HostingDebugSummaryEventContents"),tn.Import("HostingDebugSummaryEventContext"),tn.Import("ReplCreationEventContents"),tn.Import("ReplCreationEventContext"),tn.Import("UserSecretsResponseEventContext"),tn.Import("IterativeAgentEventContents"),tn.Import("IterativeAgentAppliedFileChanges"),tn.Import("IterativeAgentRevertedFileChanges"),tn.Import("IterativeAgentInstallingPackages"),tn.Import("IterativeAgentInstalledPackages"),tn.Import("AppliedFileChange"),tn.Import("RevertedFileChange"),tn.Import("IterativeAgentStartedShellExecution"),tn.Import("IterativeAgentFinishedShellExecution"),tn.Import("IterativeAgentAppliedRunConfiguration"),tn.Import("IterativeAgentAppliedWorkflowConfiguration"),tn.Import("IterativeAgentAppliedDeploymentConfiguration"),tn.Import("IterativeAgentEventContext"),tn.Import("SystemDependencyInstallData"),tn.Import("SystemDependencyUninstallData"),tn.Import("DeployConfigData"),tn.Import("DeployData"),tn.Import("RevertData"),tn.Import("AcknowledgeUserMessage"),tn.Import("CreatePostgreSQLDatabaseData"),tn.Import("SqlExecutionData"),tn.Import("ImageGenerationData"),tn.Import("VideoGenerationData"),tn.Import("GeneratedMedia"),tn.Import("GenerateMediaData"),tn.Import("UpsertGeneratedMediaData"),tn.Import("WaitingForBackgroundJobsData"),tn.Import("NewSessionNudge"),tn.Import("StepTooComplexEventContents"),tn.Import("UserTipRecommendationData"),tn.Import("EndOfRunSummaryData"),tn.Import("UITestingSubagentEventContents"),tn.Import("GeneralSubagentEventContents"),tn.Import("SubagentStateTransitionReasonCompletedSuccessfully"),tn.Import("SubagentStateTransitionReasonPaused"),tn.Import("SubagentStateTransitionReason"),tn.Import("SubagentRunningData"),tn.Import("UITestingSubagentExecutionEventContents"),tn.Import("UITestingSubagentTakeOverResultSuccess"),tn.Import("UITestingSubagentTakeOverResultDeclined"),tn.Import("UITestingSubagentTakeOverResultTimedOut"),tn.Import("UITestingSubagentTakeOverData"),tn.Import("AgentConfigUpdateEventContents"),tn.Import("AgentConfigUpdateAutomatedTesting"),tn.Import("SamplingTrajectory"),tn.Import("SamplingEvent"),tn.Import("SamplingEventUpdate"),tn.Import("SamplingEventStateUpdate"),tn.Import("UITestingSubagentExecutionEventContentsUpdate"),tn.Import("SubagentRunningDataUpdate"),tn.Import("StoppedSubagentRunningUpdate"),tn.Import("SetupObjectStorageData"),tn.Import("MoveEventsBetweenSessionsRequest"),tn.Import("MoveEventsBetweenSessionsResponse"),tn.Import("AbortSubagentRequest"),tn.Import("AbortSubagentResponse"),tn.Import("WarmAgentRequest"),tn.Import("WarmAgentResponse"),tn.Import("StockImageData"),tn.Import("AddingIntegrationsRequest"),tn.Import("AddingIntegrationsResponse"),tn.Import("InitialBuildStateUpdateEventContents"),tn.Import("SearchIntegrationsData"),tn.Import("ViewIntegrationData"),tn.Import("ViewLogsData"),tn.Import("SetupModelfarmData"),tn.Import("ViewSpecialFilesData"),tn.Import("DesignGuidelinesData"),tn.Import("MCPToolData"),tn.Import("MCPToolParameter"),tn.Import("MCPToolResult"),tn.Import("MCPToolProgress"),tn.Import("MCPContentBlock"),tn.Import("MCPAnnotations"),tn.Import("MCPContentBlockTextContent"),tn.Import("MCPContentBlockImageContent"),tn.Import("MCPContentBlockAudioContent"),tn.Import("MCPContentBlockResourceLink"),tn.Import("MCPResourceContents"),tn.Import("MCPContentBlockEmbeddedResource"),tn.Import("AlertData"),tn.Import("EnvVar"),tn.Import("EnvironmentConfigRequest"),tn.Import("ProvidedEnvVar"),tn.Import("EnvironmentConfigResponse"),tn.Import("ViewEnvVarData"),tn.Import("SetEnvVarData"),tn.Import("DeleteEnvVarData"),tn.Import("ClassifyInitialUserPromptRequest"),tn.Import("ClassifyInitialUserPromptResponse"),tn.Import("MessagedBackgroundAgentData"),tn.Import("MessagedBackgroundAgentDataUpdate"),tn.Import("SubagentReportResultData"),tn.Import("SubagentReportResultUpdate"),tn.Import("ReportAgentIssueData"),e.s(["AgentConfigSchema",()=>to,"MessageEventContentsSchema",()=>ti,"SessionTypeSchema",()=>tr],230153);var ta=e.i(297083),ts=e.i(817556),tp=e.i(862927),tl=e.i(904851),tu=e.i(90659),tc=e.i(167626),td=e.i(530658);Error("timeout while waiting for mutex to become available"),Error("mutex already locked");var ty=Error("request for lock canceled"),tf=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ty;(0,tl._)(this,e),this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}return(0,tu._)(e,[{key:"acquire",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r,i){var o={resolve:r,reject:i,weight:t,priority:n},a=tT(e._queue,function(e){return n<=e.priority});-1===a&&t<=e._value?e._dispatchItem(o):e._queue.splice(a+1,0,o)})}},{key:"runExclusive",value:function(e){var t,n,r,i;return t=this,n=arguments,r=void 0,i=function(e){var t,n,r,i,o,a=arguments;return(0,ts._)(this,function(s){switch(s.label){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:1,n=a.length>2&&void 0!==a[2]?a[2]:0,[4,this.acquire(t,n)];case 1:i=(r=td._.apply(void 0,[s.sent(),2]))[0],o=r[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,e(i)];case 3:return[2,s.sent()];case 4:return o(),[7];case 5:return[2]}})},new(r||(r=Promise))(function(e,o){function a(e){try{p(i.next(e))}catch(e){o(e)}}function s(e){try{p(i.throw(e))}catch(e){o(e)}}function p(t){var n;t.done?e(t.value):(n=t.value,(0,tc._)(n,r)?n:new r(function(e){e(n)})).then(a,s)}p((i=i.apply(t,n||[])).next())})}},{key:"waitForUnlock",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(function(r){var i,o,a;e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),i=e._weightedWaiters[t-1],o={resolve:r,priority:n},a=tT(i,function(e){return o.priority<=e.priority}),i.splice(a+1,0,o)})}},{key:"isLocked",value:function(){return this._value<=0}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e,this._dispatchQueue()}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<=0)throw Error("invalid weight ".concat(e,": must be positive"));this._value+=e,this._dispatchQueue()}},{key:"cancel",value:function(){var e=this;this._queue.forEach(function(t){return t.reject(e._cancelError)}),this._queue=[]}},{key:"_dispatchQueue",value:function(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}},{key:"_dispatchItem",value:function(e){var t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}},{key:"_newReleaser",value:function(e){var t=this,n=!1;return function(){n||(n=!0,t.release(e))}}},{key:"_drainUnlockWaiters",value:function(){if(0===this._queue.length)for(var e=this._value;e>0;e--){var t=this._weightedWaiters[e-1];t&&(t.forEach(function(e){return e.resolve()}),this._weightedWaiters[e-1]=[])}else for(var n=this._queue[0].priority,r=this._value;r>0;r--){var i=this._weightedWaiters[r-1];if(i){var o=i.findIndex(function(e){return e.priority<=n});(-1===o?i:i.splice(0,o)).forEach(function(e){return e.resolve()})}}}},{key:"_couldLockImmediately",value:function(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}]),e}();function tT(e,t){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}var th=function(){function e(t){(0,tl._)(this,e),this._semaphore=new tf(1,t)}return(0,tu._)(e,[{key:"acquire",value:function(){var e,t,n,r;return e=this,t=arguments,n=void 0,r=function(){var e,t=arguments;return(0,ts._)(this,function(n){switch(n.label){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:0,[4,this._semaphore.acquire(1,e)];case 1:return[2,td._.apply(void 0,[n.sent(),2])[1]]}})},new(n||(n=Promise))(function(i,o){function a(e){try{p(r.next(e))}catch(e){o(e)}}function s(e){try{p(r.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?i(e.value):(t=e.value,(0,tc._)(t,n)?t:new n(function(e){e(t)})).then(a,s)}p((r=r.apply(e,t||[])).next())})}},{key:"runExclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._semaphore.runExclusive(function(){return e()},1,t)}},{key:"isLocked",value:function(){return this._semaphore.isLocked()}},{key:"waitForUnlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._semaphore.waitForUnlock(1,e)}},{key:"release",value:function(){this._semaphore.isLocked()&&this._semaphore.release()}},{key:"cancel",value:function(){return this._semaphore.cancel()}}]),e}(),tg=new Map,tv=new th;function tm(e,t){return(0,ta._)(function(e,t){var n,r,i,o,a,s=arguments;return(0,ts._)(this,function(p){switch(p.label){case 0:return i=void 0===(r=(n=s.length>2&&void 0!==s[2]?s[2]:{}).path)?"/ai/chort/auth":r,a=void 0===(o=n.cache)||o,[4,tv.runExclusive(function(){return(0,ta._)(function(){var n,r,o,s,p,l;return(0,ts._)(this,function(u){switch(u.label){case 0:if(n="".concat(e,"-").concat(null!=t?t:"none","-").concat(i),a&&(r=tg.get(n))&&r.expiration>Date.now())return[2,r.token];return[4,fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t?{repl:{id:t}}:{})})];case 1:if(!(o=u.sent()).ok)throw Error("Failed to fetch Chort auth token: ".concat(o.status));return[4,o.json()];case 2:return s=u.sent(),p=tp.Value.Decode(eu,s),a&&(l=Date.now()+18e5,tg.set(n,{token:p,expiration:l})),[2,p]}})})()})];case 1:return[2,p.sent()]}})}).apply(this,arguments)}e.s(["fetchChortAuthToken",()=>tm],351677);var tS=e.i(721281);let tE="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);for(var tb=new Uint8Array(16),tR=[],tI=0;tI<256;++tI)tR.push((tI+256).toString(16).slice(1));let tC=function(e,t,n){if(tE&&!t&&!e)return tE();var r,i,o,a=null!=(o=null!=(i=(e=e||{}).random)?i:null==(r=e.rng)?void 0:r.call(e))?o:function(){if(!en){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");en=crypto.getRandomValues.bind(crypto)}return en(tb)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError("UUID byte range ".concat(n,":").concat(n+15," is out of buffer bounds"));for(var s=0;s<16;++s)t[n+s]=a[s];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(tR[e[t+0]]+tR[e[t+1]]+tR[e[t+2]]+tR[e[t+3]]+"-"+tR[e[t+4]]+tR[e[t+5]]+"-"+tR[e[t+6]]+tR[e[t+7]]+"-"+tR[e[t+8]]+tR[e[t+9]]+"-"+tR[e[t+10]]+tR[e[t+11]]+tR[e[t+12]]+tR[e[t+13]]+tR[e[t+14]]+tR[e[t+15]]).toLowerCase()}(a)};e.i(242933);var tO=e.i(790164),tA=e.i(792129),t_=e.i(562563),tk=function(){function e(t){var n=this,r=t.userId,i=t.connectImmediately,o=t.logger,a=t.getEndpoint,s=t.getToken,p=t.overrideWebsocket,l=t.onProtocolError,u=t.onRetriesExceeded;(0,tl._)(this,e),(0,tS._)(this,"clientId",void 0),(0,tS._)(this,"serverId",void 0),(0,tS._)(this,"log",void 0),(0,tS._)(this,"status",void 0),(0,tS._)(this,"transport",void 0),(0,tS._)(this,"client",void 0),(0,tS._)(this,"dispose",null),this.clientId="".concat(r,"-").concat(tC()),this.serverId="SERVER",this.log=null!=o?o:null,this.status=new tO.ObservableState("disconnected"),this.transport=new t_.WebSocketClientTransport(p?function(){return(0,ta._)(function(){return(0,ts._)(this,function(e){switch(e.label){case 0:return[4,a()];case 1:return[2,p.apply(void 0,[e.sent().toString()])]}})})()}:function(){return(0,ta._)(function(){var e;return(0,ts._)(this,function(t){switch(t.label){case 0:return e=WebSocket.bind,[4,a()];case 1:return[2,new(e.apply(WebSocket,[void 0,t.sent().toString()]))]}})})()},this.clientId,el),o&&this.transport.bindLogger(o,"info"),this.client=(0,tA.createClient)(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:(0,tA.createClientHandshakeOptions)(eu,function(){return(0,ta._)(function(){return(0,ts._)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[2,e.sent()]}})})()})}),this.transport.addEventListener("sessionTransition",function(e){n.is("closed","error")||("Connected"===e.state?n.status.set("connected"):n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("sessionStatus",function(e){n.is("closed","error")||"closed"===e.status&&(n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("protocolError",function(e){var t,r;if(e.type===ei.ProtocolError.HandshakeFailed){null==(t=n.log)||t.call(n,"river handshake failed",{clientId:n.clientId},"error");return}if(e.type===ei.ProtocolError.RetriesExceeded){null==(r=n.log)||r.call(n,"river retry limit exceeded",{clientId:n.clientId},"error"),n.close(),null==u||u(e);return}n.error(),null==l||l(e)});var c=function(){return!n.is("closed","error")&&"visible"===document.visibilityState&&window.navigator.onLine},d=function(){var e=n.transport.reconnectOnConnectionDrop,t=c();n.transport.reconnectOnConnectionDrop=t,e&&!t&&n.is("connecting")&&n.status.set("disconnected"),t&&n.is("disconnected")&&n.connect()};this.transport.reconnectOnConnectionDrop=c(),document.addEventListener("visibilitychange",d),window.addEventListener("online",d),window.addEventListener("offline",d),this.dispose=function(){document.removeEventListener("visibilitychange",d),window.removeEventListener("online",d),window.removeEventListener("offline",d)},c()&&!1!==i&&this.connect(),!0===i&&this.connect()}return(0,tu._)(e,[{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this.status.current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat(this.status.current," ChortRiverConnection"));this.is("connected","connecting")||(this.status.set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;this.status.set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,ta._)(function(){var t,n,r,i,o,a,s;return(0,ts._)(this,function(p){switch(p.label){case 0:t=setTimeout(function(){t=null},e),p.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,r=!0,i=!1,o=void 0;try{for(a=this.transport.sessions.values()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(s.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return p.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;this.status.set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();e.s(["ChortRiverConnection",()=>tk],187822);var tU=e.i(439725).default.env.CHORT_HOST_OVERRIDE||null,tw="chort-development-endpoint-override",tN="chort-use-ai-chat-proxy",tD={production:"wss://production-chort.replit.com/api/river",staging:"wss://staging-chort.replit.com/api/river",development:"ws://127.0.0.1:8100/api/river"};function tP(e){try{e?window.localStorage.setItem(tw,e):window.localStorage.removeItem(tw)}catch(e){}}function tM(){try{return window.localStorage.getItem(tw)||null}catch(e){return null}}function tx(){try{var e=window.localStorage.getItem(tN);if(null===e)return null;return"true"===e}catch(e){return null}}function tj(e){try{null===e?window.localStorage.removeItem(tN):window.localStorage.setItem(tN,e?"true":"false")}catch(e){}}function tL(e){if(tU)return console.warn("chort: using environment endpoint override",tU),"ws://".concat(tU,":8100/api/river");var t=tM();return t?(console.warn("chort: using development endpoint override",t),t):tD[e]}function tB(e){return tL(e).replace("/api/river","/api/river-chat")}e.s(["CHORT_ENDPOINTS",()=>tD,"CHORT_ENVIRONMENT_HOST_OVERRIDE",()=>tU,"getChatProxyEndpoint",()=>tB,"getChortEndpoint",()=>tL,"getChortLocalEndpointOverride",()=>tM,"getUseChatProxyOverride",()=>tx,"setChortLocalEndpointOverride",()=>tP,"setUseChatProxyOverride",()=>tj],170039);var tF=e.i(693482),tG=e.i(452723),tq=es.Type.Object({path:es.Type.Union([es.Type.String(),es.Type.Array(es.Type.Union([es.Type.Number(),es.Type.String()]))]),op:es.Type.Union([es.Type.Literal("replace"),es.Type.Literal("add"),es.Type.Literal("remove")]),value:es.Type.Optional(es.Type.Any())});function tV(e){return(0,ta._)(function(){var t,n;return(0,ts._)(this,function(r){switch(r.label){case 0:return[4,(t=e.resReadable[Symbol.asyncIterator]()).next()];case 1:if((n=r.sent()).done)throw Error("Unexpected: initial result is done");if(n.value.ok&&"delta"in n.value.payload)throw Error("Unexpected: initial result is not a snapshot");return[2,{snapshot:n.value.ok?(0,tA.Ok)(n.value.payload.snapshot):(0,tA.Err)(n.value.payload),deltas:(0,tS._)({},Symbol.asyncIterator,function(){return(0,tG._)(function(){var e;return(0,ts._)(this,function(n){switch(n.label){case 0:return[4,(0,tF._)(t.next())];case 1:if((e=n.sent()).done)return[3,5];if(e.value.ok)return[3,3];return[4,(0,tA.Err)(e.value.payload)];case 2:case 4:return n.sent(),[3,0];case 3:return[4,(0,tA.Ok)(e.value.payload.delta)];case 5:return[2]}})})()})}]}})})()}es.Type.Array(tq),e.s(["getSyncResult",()=>tV],813702);var t$=e.i(346715),tW=e.i(119468),tz="remove",tH="replace",tK=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),tY=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),tQ=Symbol.iterator,tX={mutable:"mutable",immutable:"immutable"},tJ={};function tZ(e,t){return(0,tc._)(e,Map)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function t0(e,t){if(t in e)for(var n=Reflect.getPrototypeOf(e);n;){var r=Reflect.getOwnPropertyDescriptor(n,t);if(r)return r;n=Reflect.getPrototypeOf(n)}}function t1(e){return Object.getPrototypeOf(e)===Set.prototype}function t2(e){return Object.getPrototypeOf(e)===Map.prototype}function t3(e){var t;return null!=(t=e.copy)?t:e.original}function t4(e){return!!t6(e)}function t6(e){return(void 0===e?"undefined":(0,tW._)(e))!=="object"?null:null==e?void 0:e[tK]}function t8(e){var t,n=t6(e);return n?null!=(t=n.copy)?t:n.original:e}function t5(e,t){var n;return!!e&&(void 0===e?"undefined":(0,tW._)(e))==="object"&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||(0,tc._)(e,Map)||(0,tc._)(e,Set)||!!(null==t?void 0:t.mark)&&((n=t.mark(e,tX))===tX.immutable||"function"==typeof n))}function t9(e){return Array.isArray(e)?1:(0,tc._)(e,Map)?2:3*!!(0,tc._)(e,Set)}function t7(e,t){return 2===t9(e)?e.get(t):e[t]}function ne(e,t,n){2===t9(e)?e.set(t,n):e[t]=n}function nt(e,t){var n=t6(e);return(n?t3(n):e)[t]}function nn(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function nr(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function ni(e,t){return t?e:[""].concat(e).map(function(e){var t="".concat(e);return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}var no=Object.prototype.propertyIsEnumerable;function na(e,t){if(Array.isArray(e))return Array.prototype.concat.call(e);if((0,tc._)(e,Set))return t1(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if((0,tc._)(e,Map))return t2(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,tX))&&n!==tX.mutable){if(n===tX.immutable)return r=Object.create(Object.getPrototypeOf(e)),Reflect.ownKeys(e).forEach(function(t){var n=Reflect.getOwnPropertyDescriptor(e,t);if(n.enumerable&&n.configurable&&n.writable){r[t]=e[t];return}n.writable||(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(n={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[t]}),Reflect.defineProperty(r,t,n)}),r;if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error("Unsupported mark result: ".concat(n))}if((void 0===e?"undefined":(0,tW._)(e))==="object"&&Object.getPrototypeOf(e)===Object.prototype){var n,r,i={};return Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.getOwnPropertySymbols(e).forEach(function(t){no.call(e,t)&&(i[t]=e[t])}),i}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function ns(e){e.copy||(e.copy=na(e.original,e.options))}function np(e){if(!t5(e))return t8(e);if(Array.isArray(e))return e.map(np);if((0,tc._)(e,Map)){var t=Array.from(e.entries()).map(function(e){var t=(0,td._)(e,2);return[t[0],np(t[1])]});return t2(e)?new Map(t):new(Object.getPrototypeOf(e)).constructor(t)}if((0,tc._)(e,Set)){var n=Array.from(e).map(np);return t1(e)?new Set(n):new(Object.getPrototypeOf(e)).constructor(n)}var r=Object.create(Object.getPrototypeOf(e));for(var i in e)r[i]=np(e[i]);return r}function nl(e){return t4(e)?np(e):e}function nu(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&nu(e.parent))}function nc(){throw Error("Cannot modify frozen object")}function nd(e,t){var n=t9(e);if(0===n)Reflect.ownKeys(e).forEach(function(n){t(n,e[n],e)});else if(1===n){var r=0,i=!0,o=!1,a=void 0;try{for(var s,p=e[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var l=s.value;t(r,l,e),r+=1}}catch(e){o=!0,a=e}finally{try{i||null==p.return||p.return()}finally{if(o)throw a}}}else e.forEach(function(n,r){return t(r,n,e)})}function ny(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(function(t){e.copy.add(t8(t))}))}function nf(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){var i=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Object.hasOwnProperty.call(t,"key")){var r=t.parent.copy,i=t6(t7(r,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;var o=3===t.parent.type,a=o?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(o&&r.size>a||tZ(r,a)))return null;n.push(a)}if(t.parent)return e(t.parent,n);n.reverse();try{for(var s=t.copy,p=n,l=0;l<p.length-1;l+=1){var u=p[l];if((void 0===(s=t7(3===t9(s)?Array.from(s):s,u))?"undefined":(0,tW._)(s))!=="object")throw Error("Cannot resolve patch at '".concat(p.join("/"),"'."))}}catch(e){return null}return n}(e);i&&t(e,i,n,r)}e.finalized=!0}}function nT(e,t,n,r){var i=t6(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push(function(o,a){var s,p=3===e.type?e.setMap:e.copy;if(nn(t7(p,t),n)){var l=i.original;i.copy&&(l=i.copy),ny(e),nf(e,r,o,a),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(s=e.options.updatedValues)?s:new WeakMap,e.options.updatedValues.set(l,i.original)),ne(p,t,l)}}),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),t5(n,e.options)&&e.finalities.draft.push(function(){var r;nn(t7(3===e.type?e.setMap:e.copy,t),n)&&(r=3===e.type?e.setMap:e.copy,e.finalities.revoke.length>1&&e.assignedMap.get(t)&&r&&function e(t,n,r){if(!(t4(t)||!t5(t,r)||n.has(t)||Object.isFrozen(t))){var i=(0,tc._)(t,Set),o=i?new Map:void 0;if(n.add(t),nd(t,function(a,s){var p;if(t4(s)){var l=t6(s);ns(l),ne(i?o:t,a,(null==(p=l.assignedMap)?void 0:p.size)||l.operated?l.copy:l.original)}else e(s,n,r)}),o){var a=Array.from(t);t.clear(),a.forEach(function(e){t.add(o.has(e)?o.get(e):e)})}}}(t7(r,t),e.finalities.handledSet,e.options))})}function nh(e,t,n,r){var i,o,a,s,p,l=e.options.enablePatches.pathAsArray,u=void 0===l||l;switch(e.type){case 0:case 2:return i=e.original,o=e.copy,void e.assignedMap.forEach(function(e,a){var s=t7(i,a),p=nl(t7(o,a)),l=e?tZ(i,a)?tH:"add":tz;if(!nn(s,p)||l!==tH){var c=ni(t.concat(a),u);n.push(l===tz?{op:l,path:c}:{op:l,path:c,value:p}),r.push("add"===l?{op:tz,path:c}:l===tz?{op:"add",path:c,value:s}:{op:tH,path:c,value:s})}});case 1:return function(e,t,n,r,i){var o,a,s=e.original,p=e.assignedMap,l=e.options,u=e.copy;u.length<s.length&&(s=(o=[u,s])[0],u=o[1],n=(a=[r,n])[0],r=a[1]);for(var c=0;c<s.length;c+=1)if(p.get(c.toString())&&u[c]!==s[c]){var d=ni(t.concat([c]),i);n.push({op:tH,path:d,value:nl(u[c])}),r.push({op:tH,path:d,value:nl(s[c])})}for(var y=s.length;y<u.length;y+=1){var f=ni(t.concat([y]),i);n.push({op:"add",path:f,value:nl(u[y])})}if(s.length<u.length){var T=l.enablePatches.arrayLengthAssignment;if(void 0===T||T){var h=ni(t.concat(["length"]),i);r.push({op:tH,path:h,value:s.length})}else for(var g=u.length;s.length<g;g-=1){var v=ni(t.concat([g-1]),i);r.push({op:tz,path:v})}}}(e,t,n,r,u);case 3:return a=e.original,s=e.copy,p=0,void(a.forEach(function(e){if(!s.has(e)){var i=ni(t.concat([p]),u);n.push({op:tz,path:i,value:e}),r.unshift({op:"add",path:i,value:e})}p+=1}),p=0,s.forEach(function(e){if(!a.has(e)){var i=ni(t.concat([p]),u);n.push({op:"add",path:i,value:e}),r.unshift({op:tz,path:i,value:e})}p+=1}))}}var ng=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((void 0===e?"undefined":(0,tW._)(e))==="object"&&null!==e&&(!t5(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},nv=(0,tS._)({get size(){return t3(t6(this)).size},has:function(e){return t3(t6(this)).has(e)},set:function(e,t){var n=t6(this),r=t3(n);return r.has(e)&&nn(r.get(e),t)||(ns(n),nu(n),n.assignedMap.set(e,!0),n.copy.set(e,t),nT(n,e,t,nh)),this},delete:function(e){if(!this.has(e))return!1;var t=t6(this);return ns(t),nu(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear:function(){var e=t6(this);if(this.size){ns(e),nu(e),e.assignedMap=new Map;var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,td._)(i.value,1)[0];e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.copy.clear()}},forEach:function(e,t){var n=this;t3(t6(this)).forEach(function(r,i){e.call(t,n.get(i),i,n)})},get:function(e){var t,n,r=t6(this),i=t3(r).get(e),o=(null==(n=(t=r.options).mark)?void 0:n.call(t,i,tX))===tX.mutable;if(r.options.strict&&ng(i,r.options,o),o||r.finalized||!t5(i,r.options)||i!==r.original.get(e))return i;var a=tJ.createDraft({original:i,parentDraft:r,key:e,finalities:r.finalities,options:r.options});return ns(r),r.copy.set(e,a),a},keys:function(){return t3(t6(this)).keys()},values:function(){var e,t=this,n=this.keys();return e={},(0,tS._)(e,tQ,function(){return t.values()}),(0,tS._)(e,"next",function(){var e=n.next();return e.done?e:{done:!1,value:t.get(e.value)}}),e},entries:function(){var e,t=this,n=this.keys();return e={},(0,tS._)(e,tQ,function(){return t.entries()}),(0,tS._)(e,"next",function(){var e=n.next();if(e.done)return e;var r=t.get(e.value);return{done:!1,value:[e.value,r]}}),e}},tQ,function(){return this.entries()}),nm=Reflect.ownKeys(nv),nS=function(e,t,n){var r=n.isValuesIterator;return function(){var n,i,o=t.next();if(o.done)return o;var a=o.value,s=e.setMap.get(a),p=t6(s),l=(null==(i=(n=e.options).mark)?void 0:i.call(n,s,tX))===tX.mutable;if(e.options.strict&&ng(a,e.options,l),!l&&!p&&t5(a,e.options)&&!e.finalized&&e.original.has(a)){var u=tJ.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options});e.setMap.set(a,u),s=u}else p&&(s=p.proxy);return{done:!1,value:r?s:[s,s]}}},nE=(er={get size(){return t6(this).setMap.size},has:function(e){var t=t6(this);if(t.setMap.has(e))return!0;ns(t);var n=t6(e);return!!(n&&t.setMap.has(n.original))},add:function(e){var t=t6(this);return this.has(e)||(ns(t),nu(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),nT(t,e,e,nh)),this},delete:function(e){if(!this.has(e))return!1;var t=t6(this);ns(t),nu(t);var n=t6(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear:function(){if(this.size){var e=t6(this);ns(e),nu(e);var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.setMap.clear()}},values:function(){var e,t=this,n=t6(this);ns(n);var r=n.setMap.keys();return e={},(0,tS._)(e,Symbol.iterator,function(){return t.values()}),(0,tS._)(e,"next",nS(n,r,{isValuesIterator:!0})),e},entries:function(){var e,t=this,n=t6(this);ns(n);var r=n.setMap.keys();return e={},(0,tS._)(e,Symbol.iterator,function(){return t.entries()}),(0,tS._)(e,"next",nS(n,r,{isValuesIterator:!1})),e},keys:function(){return this.values()}},(0,tS._)(er,tQ,function(){return this.values()}),(0,tS._)(er,"forEach",function(e,t){for(var n=this.values(),r=n.next();!r.done;)e.call(t,r.value,r.value,this),r=n.next()}),er);Set.prototype.difference&&Object.assign(nE,{intersection:function(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union:function(e){return Set.prototype.union.call(new Set(this.values()),e)},difference:function(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference:function(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf:function(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf:function(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom:function(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});var nb=Reflect.ownKeys(nE),nR=new WeakSet,nI={get:function(e,t,n){var r,i,o,a=null==(r=e.copy)?void 0:r[t];if(a&&nR.has(a))return a;if(t===tK)return e;if(e.options.mark){var s="size"===t&&((0,tc._)(e.original,Map)||(0,tc._)(e.original,Set))?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((o=e.options.mark(s,tX))===tX.mutable)return e.options.strict&&ng(s,e.options,!0),s}var p=t3(e);if((0,tc._)(p,Map)&&nm.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(nv,"size").get.call(e.proxy);var l=nv[t];if(l)return l.bind(e.proxy)}if((0,tc._)(p,Set)&&nb.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(nE,"size").get.call(e.proxy);var u=nE[t];if(u)return u.bind(e.proxy)}if(!tZ(p,t)){var c=t0(p,t);return c?"value"in c?c.value:null==(i=c.get)?void 0:i.call(e.proxy):void 0}var d=p[t];if(e.options.strict&&ng(d,e.options),e.finalized||!t5(d,e.options))return d;if(d===nt(e.original,t)){if(ns(e),e.copy[t]=nC({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof o){var y=t6(e.copy[t]);return ns(y),nu(y),y.copy}return e.copy[t]}return d},set:function(e,t,n){if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(i=Number(t))&&i>=0&&(0===t||0===i||String(i)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");var r,i,o=t0(t3(e),t);if(null==o?void 0:o.set)return o.set.call(e.proxy,n),!0;var a=nt(t3(e),t),s=t6(a);return s&&nn(s.original,n)?(e.copy[t]=n,e.assignedMap=null!=(r=e.assignedMap)?r:new Map,e.assignedMap.set(t,!1),!0):!!(nn(n,a)&&(void 0!==n||tZ(e.original,t)))||(ns(e),nu(e),tZ(e.original,t)&&nn(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,nT(e,t,n,nh),!0)},has:function(e,t){return t in t3(e)},ownKeys:function(e){return Reflect.ownKeys(t3(e))},getOwnPropertyDescriptor:function(e,t){var n=t3(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},getPrototypeOf:function(e){return Reflect.getPrototypeOf(e.original)},setPrototypeOf:function(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty:function(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty:function(e,t){var n;return 1===e.type?nI.set.call(this,e,t,void 0,e.proxy):(void 0!==nt(e.original,t)||t in e.original?(ns(e),nu(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function nC(e){var t=e.original,n=e.parentDraft,r=e.key,i=e.finalities,o=e.options,a=t9(t),s={type:a,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:o,setMap:3===a?new Map(t.entries()):void 0};(r||"key"in e)&&(s.key=r);var p=Proxy.revocable(1===a?Object.assign([],s):s,nI),l=p.proxy,u=p.revoke;if(i.revoke.push(u),nR.add(l),s.proxy=l,n)n.finalities.draft.push(function(e,t){var i,o,a=t6(l),s=3===n.type?n.setMap:n.copy,p=t7(s,r),u=t6(p);if(u){var c=u.original;u.operated&&(c=t8(p)),ny(u),nf(u,nh,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(i=n.options.updatedValues)?i:new WeakMap,n.options.updatedValues.set(c,u.original)),ne(s,r,c)}null==(o=a.callbacks)||o.forEach(function(n){n(e,t)})});else{var c=t6(l);c.finalities.draft.push(function(e,t){ny(c),nf(c,nh,e,t)})}return l}function nO(e){var t=e.rootDraft,n=e.value,r=e.useRawReturn,i=e.isRoot;nd(n,function(n,r,i){var o=t6(r);if(o&&t&&o.finalities===t.finalities){e.isContainDraft=!0;var a=o.original;if((0,tc._)(i,Set)){var s=Array.from(i);i.clear(),s.forEach(function(e){return i.add(n===e?a:e)})}else ne(i,n,a)}else(void 0===r?"undefined":(0,tW._)(r))==="object"&&null!==r&&(e.value=r,e.isRoot=!1,nO(e))}),(void 0===i||i)&&(e.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),void 0!==r&&r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function nA(e){if(!t4(e))throw Error("current() is only used for Draft, parameter: ".concat(e));return function e(t){var n,r,i=t6(t);if(!t5(t,null==i?void 0:i.options))return t;var o=t9(t);if(i&&!i.operated)return i.original;function a(){r=2===o?t2(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===o?Array.from(i.setMap.values()):na(t,null==i?void 0:i.options)}if(i){i.finalized=!0;try{a()}finally{i.finalized=!1}}else r=t;if(nd(r,function(n,o){if(!(i&&nn(t7(i.original,n),o))){var s=e(o);s!==o&&(r===t&&a(),ne(r,n,s))}}),3===o){var s=null!=(n=null==i?void 0:i.original)?n:r;return t1(s)?new Set(r):new(Object.getPrototypeOf(s)).constructor(r)}return r}(e)}tJ.createDraft=nC;var n_=function(e){if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error("Invalid options: ".concat(String(e),", 'options' should be an object."));return function t(n,r,i){if("function"==typeof n&&"function"!=typeof r)return function(e){for(var i,o=this,a=arguments.length,s=Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];return t(e,function(e){return(i=n).call.apply(i,[o,e].concat((0,t$._)(s)))},r)};var o,a,s,p,l,u,c,d,y,f=i;if("function"!=typeof r&&(f=r),void 0!==f&&"[object Object]"!==Object.prototype.toString.call(f))throw Error("Invalid options: ".concat(f,", 'options' should be an object."));f=Object.assign(Object.assign({},e),f);var T=t4(n)?nA(n):n,h=Array.isArray(f.mark)?function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=f.mark[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("function"!=typeof s)throw Error("Invalid mark: ".concat(s,", 'mark' should be a function."));var p=s(e,t);if(p)return p}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}:f.mark,g=null!=(o=f.enablePatches)&&o,v=null!=(a=f.strict)&&a,m={enableAutoFreeze:null!=(s=f.enableAutoFreeze)&&s,mark:h,strict:v,enablePatches:g};if(!t5(T,m)&&(void 0===T?"undefined":(0,tW._)(T))==="object"&&null!==T)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");var S=(0,td._)((d={draft:[],revoke:[],handledSet:new WeakSet},m.enablePatches&&(u=[],c=[]),[y=(null==(l=m.mark)?void 0:l.call(m,T,tX))!==tX.mutable&&t5(T,m)?nC({original:T,parentDraft:null,finalities:d,options:m}):T,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,td._)(function(e,t,n,r,i){var o,a=t6(e),s=null!=(o=null==a?void 0:a.original)?o:e,p=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,r);var l=p?t[0]:a?a.operated?a.copy:a.original:e;return a&&nr(a),i&&function e(t,n,r,i,o){r=null!=r?r:new WeakMap,i=null!=i?i:[],o=null!=o?o:[];var a=r.has(t)?r.get(t):t;if(i.length>0){var s=i.indexOf(a);if(a&&(void 0===a?"undefined":(0,tW._)(a))==="object"&&-1!==s){if(i[0]===a)throw Error("Forbids circular reference");throw Error("Forbids circular reference: ~/".concat(o.slice(0,s).map(function(e,t){if((void 0===e?"undefined":(0,tW._)(e))==="symbol")return"[".concat(e.toString(),"]");var n=i[t];return(void 0===e?"undefined":(0,tW._)(e))==="object"&&((0,tc._)(n,Map)||(0,tc._)(n,Set))?Array.from(n.keys()).indexOf(e):e}).join("/")))}i.push(a),o.push(n)}else i.push(a);if(Object.isFrozen(t)||t4(t)){i.pop(),o.pop();return}switch(t9(t)){case 2:var p=!0,l=!1,u=void 0;try{for(var c,d=t[Symbol.iterator]();!(p=(c=d.next()).done);p=!0){var y=(0,td._)(c.value,2),f=y[0],T=y[1];e(f,f,r,i,o),e(T,f,r,i,o)}}catch(e){l=!0,u=e}finally{try{p||null==d.return||d.return()}finally{if(l)throw u}}t.set=t.clear=t.delete=nc;break;case 3:var h=!0,g=!1,v=void 0;try{for(var m,S=t[Symbol.iterator]();!(h=(m=S.next()).done);h=!0){var E=m.value;e(E,E,r,i,o)}}catch(e){g=!0,v=e}finally{try{h||null==S.return||S.return()}finally{if(g)throw v}}t.add=t.clear=t.delete=nc;break;case 1:Object.freeze(t);var b=0,R=!0,I=!1,C=void 0;try{for(var O,A=t[Symbol.iterator]();!(R=(O=A.next()).done);R=!0){var _=O.value;e(_,b,r,i,o),b+=1}}catch(e){I=!0,C=e}finally{try{R||null==A.return||A.return()}finally{if(I)throw C}}break;default:Object.freeze(t),Object.keys(t).forEach(function(n){e(t[n],n,r,i,o)})}i.pop(),o.pop()}(l,l,null==a?void 0:a.options.updatedValues),[l,n&&p?[{op:tH,path:[],value:t[0]}]:n,r&&p?[{op:tH,path:[],value:s}]:r]}(y,e,u,c,m.enableAutoFreeze),3),n=t[0],r=t[1],i=t[2];return m.enablePatches?[n,r,i]:n}]),2),E=S[0],b=S[1];if("function"!=typeof r){if(!t5(T,m))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,b]}try{p=r(E)}catch(e){throw nr(t6(E)),e}var R=function(e){var t=t6(E);if(!t4(e)){if(void 0!==e&&!nn(e,E)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");var n=null==e?void 0:e[tY];if(n){var r=n[0];return m.strict&&(void 0===e?"undefined":(0,tW._)(e))==="object"&&null!==e&&nO({rootDraft:t,value:e,useRawReturn:!0}),b([r])}if(void 0!==e)return(void 0===e?"undefined":(0,tW._)(e))==="object"&&null!==e&&nO({rootDraft:t,value:e}),b([e])}if(e===E||void 0===e)return b([]);var i=t6(e);if(m===i.options){if(i.operated)throw Error("Cannot return a modified child draft.");return b([nA(e)])}return b([e])};return(0,tc._)(p,Promise)?p.then(R,function(e){throw nr(t6(E)),e}):R(p)}}();function nk(e,t,n){for(r=t.length-1;r>=0;r-=1){var r,i=t[r],o=i.value,a=i.op,s=i.path;if(!s.length&&a===tH||""===s&&"add"===a){e=o;break}}r>-1&&(t=t.slice(r+1));var p=function(e){t.forEach(function(t){for(var n=t.path,r=t.op,i=Array.isArray(n)?n:n.split("/").map(function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}).slice(1),o=e,a=0;a<i.length-1;a+=1){var s=t9(o),p=i[a];if("string"!=typeof p&&"number"!=typeof p&&(p=String(p)),(0===s||1===s)&&("__proto__"===p||"constructor"===p)||"function"==typeof o&&"prototype"===p)throw Error("Patching reserved attributes like __proto__ and constructor is not allowed.");if((void 0===(o=t7(3===s?Array.from(o):o,p))?"undefined":(0,tW._)(o))!=="object")throw Error("Cannot apply patch at '".concat(i.join("/"),"'."))}var l=t9(o),u=np(t.value),c=i[i.length-1];switch(r){case tH:switch(l){case 2:return o.set(c,u);case 3:throw Error("Cannot apply replace patch to set.");default:return o[c]=u}case"add":switch(l){case 1:return"-"===c?o.push(u):o.splice(c,0,u);case 2:return o.set(c,u);case 3:return o.add(u);default:return o[c]=u}case tz:switch(l){case 1:return o.splice(c,1);case 2:return o.delete(c);case 3:return o.delete(t.value);default:return delete o[c]}default:throw Error("Unsupported patch operation: ".concat(r,"."))}})};if(t4(e)){if(void 0!==n)throw Error("Cannot apply patches with options to a draft.");return p(e),e}return n_(e,p,Object.assign(Object.assign({},n),{enablePatches:!1}))}Object.prototype.constructor.toString(),e.s(["apply",()=>nk,"create",()=>n_,"isDraftable",()=>t5],281128);var nU=es.Type.Object({id:es.Type.String(),title:es.Type.String(),sessionType:tr,sessionCreationEventId:es.Type.String(),archived:es.Type.Boolean(),readOnly:es.Type.Boolean(),taskId:es.Type.String(),created:es.Type.Date(),updated:es.Type.Date()});e.s(["SessionDataSchema",()=>nU],957410),ei.ProtocolError,e.s([],660670)},952098,e=>{"use strict";e.i(439725);var t=e.i(297083),n=e.i(530658),r=e.i(817556),i=e.i(389959),o=e.i(906368),a=e.i(17886);e.i(660670);var s=e.i(792129),s=s,p=e.i(187822),l=e.i(351677),u=e.i(170039),c=e.i(98816),d=e.i(664152),y=window.location.search.includes("aiChatDebug=1"),f=function(e,t,n){var r;y&&console[null!=n?n:"info"]("[chort] "+e,t),d.logger[null!=n?n:"info"](e,{river:t,riverTarget:"chort",riverVersion:s.version}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&o.withScope(function(n){n.setTag("chort",!0),n.setExtras(t),o.captureException(Error(e))})};function T(){var e="production";return(0,a.isEnvProduction)()||(e="staging"),(0,u.getChortEndpoint)(e)}function h(){var e="production";return(0,a.isEnvProduction)()||(e="staging"),(0,u.getChatProxyEndpoint)(e)}function g(e){var o=e.replId,a=e.userId,s=e.onRetriesExceeded,u=e.onProtocolError,d=(0,n._)((0,i.useState)(null),2),y=d[0],h=d[1],g=(0,c.default)(s),v=(0,c.default)(u);return(0,i.useEffect)(function(){var e=new p.ChortRiverConnection({userId:a,logger:f,getEndpoint:function(){return(0,t._)(function(){return(0,r._)(this,function(e){return[2,T()]})})()},getToken:function(){return(0,t._)(function(){return(0,r._)(this,function(e){return[2,(0,l.fetchChortAuthToken)(a,o)]})})()},onProtocolError:function(e){var t;null==(t=v.current)||t.call(v,e)},onRetriesExceeded:function(e){var t;null==(t=g.current)||t.call(g,e)}});return h(e),function(){h(null),e.drained().then(function(){return e.close()})}},[o,a,g,v]),y}e.s(["getCurrentChatProxyEndpoint",()=>h,"getCurrentChortEndpoint",()=>T,"useCreateChortRiverConnection",()=>g],952098)},435106,e=>{"use strict";var t,n,r=e.i(297083),i=e.i(904851),o=e.i(711300),a=e.i(634203),s=e.i(35877),p=e.i(90659),l=e.i(721281),u=e.i(878420),c=e.i(64386),d=e.i(817556),y=e.i(908410);e.i(242933);var f=e.i(790164),T=e.i(845466),h=e.i(119468),g=e.i(167626),v=new TextEncoder,m=new TextDecoder;function S(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var E=function(e,t){this.type=e,this.data=t},b=(t=function(e,n){return(t=Object.setPrototypeOf||(0,g._)({__proto__:[]},Array)&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),R=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,Object.create(t.prototype)),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:t.name}),r}return b(t,e),t}(Error);function I(e,t,n){var r=Math.floor(n/0x100000000);e.setUint32(t,r),e.setUint32(t+4,n)}function C(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}var O={type:-1,encode:function(e){var t,n,r,i;return(0,g._)(e,Date)?function(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=0x3ffffffff)if(0===n&&t<=0xffffffff){var r=new Uint8Array(4),i=new DataView(r.buffer);return i.setUint32(0,t),r}else{var o=t/0x100000000,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,n<<2|3&o),i.setUint32(4,0|t),r}var r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,n),I(i,4,t),r}((n=Math.floor((t=e.getTime())/1e3),i=Math.floor((r=(t-1e3*n)*1e6)/1e9),{sec:n+i,nsec:r-1e9*i})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var n=t.getUint32(0),r=0;return{sec:n,nsec:0};case 8:var i=t.getUint32(0),n=(3&i)*0x100000000+t.getUint32(4),r=i>>>2;return{sec:n,nsec:r};case 12:var n=C(t,4),r=t.getUint32(0);return{sec:n,nsec:r};default:throw new R("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},A=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(O)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var i=1+t;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){var r=this.builtInEncoders[n];if(null!=r){var i=r(e,t);if(null!=i){var o=-1-n;return new E(o,i)}}}for(var n=0;n<this.encoders.length;n++){var r=this.encoders[n];if(null!=r){var i=r(e,t);if(null!=i){var o=n;return new E(o,i)}}}return(0,g._)(e,E)?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new E(t,e)},e.defaultCodec=new e,e}(),_=new TextEncoder;function k(e,t,n){for(var r=t,i=r+n,o=[],a="";r<i;){var s=e[r++];if((128&s)==0)o.push(s);else if((224&s)==192){var p=63&e[r++];o.push((31&s)<<6|p)}else if((240&s)==224){var p=63&e[r++],l=63&e[r++];o.push((31&s)<<12|p<<6|l)}else if((248&s)==240){var p=63&e[r++],l=63&e[r++],u=(7&s)<<18|p<<12|l<<6|63&e[r++];u>65535&&(u-=65536,o.push(u>>>10&1023|55296),u=56320|1023&u),o.push(u)}else o.push(s);o.length>=4096&&(a+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(a+=String.fromCharCode.apply(String,o)),a}var U=new TextDecoder;function w(e){return(0,g._)(e,Uint8Array)?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(0,g._)(e,ArrayBuffer)?new Uint8Array(e):Uint8Array.from(e)}var N=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){var r=this.caches[n-1];e:for(var i=0;i<r.length;i++){for(var o=r[i],a=o.bytes,s=0;s<n;s++)if(a[s]!==e[t+s])continue e;return o.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.find(e,t,n);if(null!=r)return this.hit++,r;this.miss++;var i=k(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,i),i},e}(),D=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(p){var l=[s,p];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},P=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var o,a,s;o=r,a=i,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){o({value:e,done:s})},a)})}}},M=function(e){return(0,g._)(this,M)?(this.v=e,this):new M(e)},x=function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})})}function s(e,t){try{var n;n=i[e](t),(0,g._)(n.value,M)?Promise.resolve(n.value.v).then(p,l):u(o[0][2],n)}catch(e){u(o[0][3],e)}}function p(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},j="array",L="map_key",B=new DataView(new ArrayBuffer(0)),F=new Uint8Array(B.buffer);try{B.getInt8(0)}catch(e){if(!(0,g._)(e,RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var G=RangeError,q=new G("Insufficient data"),V=new N,$=function(){function e(e){var t,n,r,i,o,a,s;this.totalPos=0,this.pos=0,this.view=B,this.bytes=F,this.headByte=-1,this.stack=[],this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:A.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxStrLength=null!=(r=null==e?void 0:e.maxStrLength)?r:0xffffffff,this.maxBinLength=null!=(i=null==e?void 0:e.maxBinLength)?i:0xffffffff,this.maxArrayLength=null!=(o=null==e?void 0:e.maxArrayLength)?o:0xffffffff,this.maxMapLength=null!=(a=null==e?void 0:e.maxMapLength)?a:0xffffffff,this.maxExtLength=null!=(s=null==e?void 0:e.maxExtLength)?s:0xffffffff,this.keyDecoder=(null==e?void 0:e.keyDecoder)!==void 0?e.keyDecoder:V}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=w(e),this.view=function(e){if((0,g._)(e,ArrayBuffer))return new DataView(e);var t=w(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=w(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return D(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,n,r,i,o,a,s,p,l,u,c;return p=this,l=void 0,u=void 0,c=function(){var p,l,u,c,d,y,f;return D(this,function(T){switch(T.label){case 0:p=!1,T.label=1;case 1:T.trys.push([1,6,7,12]),t=!0,n=P(e),T.label=2;case 2:return[4,n.next()];case 3:if(i=(r=T.sent()).done)return[3,5];s=r.value,t=!1;try{if(u=s,p)throw this.createExtraByteError(this.totalPos);this.appendBuffer(u);try{l=this.doDecodeSync(),p=!0}catch(e){if(!(0,g._)(e,G))throw e}this.totalPos+=this.pos}finally{t=!0}T.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return o={error:T.sent()},[3,12];case 7:if(T.trys.push([7,,10,11]),!(!t&&!i&&(a=n.return)))return[3,9];return[4,a.call(n)];case 8:T.sent(),T.label=9;case 9:return[3,11];case 10:if(o)throw o.error;return[7];case 11:return[7];case 12:if(p){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,l]}throw c=this,d=c.headByte,y=c.pos,f=c.totalPos,RangeError("Insufficient data in parsing ".concat(S(d)," at ").concat(f," (").concat(y," in the current buffer)"))}})},new(u||(u=Promise))(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,(0,g._)(i,u)?i:new u(function(e){e(i)})).then(n,r)}i((c=c.apply(p,l||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return x(this,arguments,function(){var n,r,i,o,a,s,p,l,u,c,d;return D(this,function(y){switch(y.label){case 0:n=t,r=-1,y.label=1;case 1:y.trys.push([1,15,16,21]),i=!0,o=P(e),y.label=2;case 2:return[4,M(o.next())];case 3:if(l=(a=y.sent()).done)return[3,14];d=a.value,i=!1,y.label=4;case 4:if(y.trys.push([4,,12,13]),s=d,t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(r=this.readArraySize(),n=!1,this.complete()),y.label=5;case 5:y.trys.push([5,10,,11]),y.label=6;case 6:return[4,M(this.doDecodeSync())];case 7:return[4,y.sent()];case 8:if(y.sent(),0==--r)return[3,9];return[3,6];case 9:return[3,11];case 10:if(p=y.sent(),!(0,g._)(p,G))throw p;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return i=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return u={error:y.sent()},[3,21];case 16:if(y.trys.push([16,,19,20]),!(!i&&!l&&(c=o.return)))return[3,18];return[4,M(c.call(o))];case 17:y.sent(),y.label=18;case 18:return[3,20];case 19:if(u)throw u.error;return[7];case 20:return[7];case 21:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var n=e-128;if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(e<160){var n=e-144;if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else{var r=e-160;t=this.decodeUtf8String(r,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){var r=this.lookU8();t=this.decodeUtf8String(r,1)}else if(218===e){var r=this.lookU16();t=this.decodeUtf8String(r,2)}else if(219===e){var r=this.lookU32();t=this.decodeUtf8String(r,4)}else if(220===e){var n=this.readU16();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(221===e){var n=this.readU32();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(222===e){var n=this.readU16();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(223===e){var n=this.readU32();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(196===e){var n=this.lookU8();t=this.decodeBinary(n,1)}else if(197===e){var n=this.lookU16();t=this.decodeBinary(n,2)}else if(198===e){var n=this.lookU32();t=this.decodeBinary(n,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var n=this.lookU8();t=this.decodeExtension(n,1)}else if(200===e){var n=this.lookU16();t=this.decodeExtension(n,2)}else if(201===e){var n=this.lookU32();t=this.decodeExtension(n,4)}else throw new R("Unrecognized type byte: ".concat(S(e)));this.complete();for(var i=this.stack;i.length>0;){var o,a=i[i.length-1];if(a.type===j)if(a.array[a.position]=t,a.position++,a.position===a.size)i.pop(),t=a.array;else continue t;else if(a.type===L){if("string"!=typeof(o=t)&&"number"!=typeof o)throw new R("The type of key must be string or number but "+(void 0===t?"undefined":(0,h._)(t)));if("__proto__"===t)throw new R("The key __proto__ is not allowed");a.key=t,a.type="map_value";continue t}else if(a.map[a.key]=t,a.readCount++,a.readCount===a.size)i.pop(),t=a.map;else{a.key=null,a.type=L;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new R("Unrecognized array type byte: ".concat(S(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new R("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:L,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new R("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:j,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new R("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw q;var n,r,i=this.pos+t;return r=this.stateIsMapKey()&&(null==(n=this.keyDecoder)?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,i,e):function(e,t,n){var r;return n>200?(r=e.subarray(t,t+n),U.decode(r)):k(e,t,n)}(this.bytes,i,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===L},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new R("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw q;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new R("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=C(this.view,this.pos);return this.pos+=8,e},e.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},e.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),W=function(){function e(e){var t,n,r,i,o,a,s,p;this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:A.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxDepth=null!=(r=null==e?void 0:e.maxDepth)?r:100,this.initialBufferSize=null!=(i=null==e?void 0:e.initialBufferSize)?i:2048,this.sortKeys=null!=(o=null==e?void 0:e.sortKeys)&&o,this.forceFloat32=null!=(a=null==e?void 0:e.forceFloat32)&&a,this.ignoreUndefined=null!=(s=null==e?void 0:e.ignoreUndefined)&&s,this.forceIntegerToFloat=null!=(p=null==e?void 0:e.forceIntegerToFloat)&&p,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&(void 0===e?"undefined":(0,h._)(e))==="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),r=new DataView(t);n.set(this.bytes),this.view=r,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},e.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){var t=function(e){for(var t=e.length,n=0,r=0;r<t;){var i=e.charCodeAt(r++);if((0xffffff80&i)==0){n++;continue}if((0xfffff800&i)==0)n+=2;else{if(i>=55296&&i<=56319&&r<t){var o=e.charCodeAt(r);(64512&o)==56320&&(++r,i=((1023&i)<<10)+(1023&o)+65536)}(0xffff0000&i)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){if(e.length>50)_.encodeInto(e,t.subarray(n));else!function(e,t,n){for(var r=e.length,i=n,o=0;o<r;){var a=e.charCodeAt(o++);if((0xffffff80&a)==0){t[i++]=a;continue}if((0xfffff800&a)==0)t[i++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&o<r){var s=e.charCodeAt(o);(64512&s)==56320&&(++o,a=((1023&a)<<10)+(1023&s)+65536)}(0xffff0000&a)==0?t[i++]=a>>12&15|224:(t[i++]=a>>18&7|240,t[i++]=a>>12&63|128),t[i++]=a>>6&63|128}t[i++]=63&a|128}}(e,t,n)}(e,this.bytes,this.pos),this.pos+=t},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if((void 0===e?"undefined":(0,h._)(e))==="object")this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var n=w(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error("Too large array: ".concat(n));for(var r=0;r<e.length;r++){var i=e[r];this.doEncode(i,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,r=0;r<t.length;r++)void 0!==e[t[r]]&&n++;return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<0x100000000)this.writeU8(223),this.writeU32(r);else throw Error("Too large map object: ".concat(r));for(var i=0;i<n.length;i++){var o=n[i],a=e[o];this.ignoreUndefined&&void 0===a||(this.encodeString(o),this.doEncode(a,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),I(this.view,this.pos,e),this.pos+=8},e.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},e.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},e}(),z=e.i(346715),H=e.i(886513),K={debug:-1,info:0,warn:1,error:2},Y=function(e){return function(t,n){if(!(null==n?void 0:n.transportMessage))return void e(t,n);var r=n.transportMessage;r.payload,n.transportMessage=(0,H._)(r,["payload"]),e(t,n)}},Q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";(0,i._)(this,e),(0,l._)(this,"minLevel",void 0),(0,l._)(this,"output",void 0),this.minLevel=n,this.output=t}return(0,p._)(e,[{key:"debug",value:function(e,t){K[this.minLevel]<=K.debug&&this.output(e,null!=t?t:{},"debug")}},{key:"info",value:function(e,t){K[this.minLevel]<=K.info&&this.output(e,null!=t?t:{},"info")}},{key:"warn",value:function(e,t){K[this.minLevel]<=K.warn&&this.output(e,null!=t?t:{},"warn")}},{key:"error",value:function(e,t){K[this.minLevel]<=K.error&&this.output(e,null!=t?t:{},"error")}}]),e}(),X=function(e){return{debug:Y(e.debug.bind(e)),info:Y(e.info.bind(e)),warn:Y(e.warn.bind(e)),error:Y(e.error.bind(e))}},J=e.i(538391),Z=e.i(399119),ee=e.i(663355),et=e.i(862470),en=e.i(445789),er=e.i(892280),ei=e.i(862927),eo=e.i(884348),ea={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:function(e){return v.encode(JSON.stringify(e,function(e){var t,n=this[e];return(0,g._)(n,Uint8Array)?{$t:(t="",n.forEach(function(e){t+=String.fromCharCode(e)}),btoa(t))}:n}))},fromBuffer:function(e){try{var t=JSON.parse(m.decode(e),function(e,t){return(null==t?void 0:t.$t)?function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(t.$t):t});if((void 0===t?"undefined":(0,h._)(t))==="object")return t;return null}catch(e){return null}}}},es=(0,u._)({},ea,{baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200});(0,u._)({},ea);var ep=((n=ep||{}).NoConnection="NoConnection",n.BackingOff="BackingOff",n.Connecting="Connecting",n.Handshaking="Handshaking",n.Connected="Connected",n.WaitingForHandshake="WaitingForHandshake",n),el="session state has been consumed and is no longer valid",eu=function(e){function t(e){var n,r=e.from,o=e.options,a=e.log;return(0,i._)(this,t),n=(0,Z._)(this,t),(0,l._)(n,"from",void 0),(0,l._)(n,"options",void 0),(0,l._)(n,"log",void 0),n.from=r,n.options=o,n.log=a,n}return(0,en._)(t,e),(0,p._)(t,[{key:"parseMsg",value:function(e){var t,n=this.options.codec.fromBuffer(e);if(null===n){var r,i=new TextDecoder().decode(J.Buffer.from(e));return null==(r=this.log)||r.error("received malformed msg: ".concat(i),this.loggingMetadata),null}return ei.Value.Check(er.OpaqueTransportMessageSchema,n)?n:(null==(t=this.log)||t.error("received invalid msg: ".concat(JSON.stringify(n)),(0,c._)((0,u._)({},this.loggingMetadata),{validationErrors:(0,z._)(ei.Value.Errors(er.OpaqueTransportMessageSchema,n))})),null)}}]),t}(function(){function e(){return(0,i._)(this,e),(0,l._)(this,"_isConsumed",void 0),this._isConsumed=!1,new Proxy(this,{get:function(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return function(){e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return function(){e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error("".concat(el,": getting ").concat(t.toString()," on consumed state"));return Reflect.get(e,t)},set:function(e,t,n){if(e._isConsumed)throw Error("".concat(el,": setting ").concat(t.toString()," on consumed state"));return Reflect.set(e,t,n)}})}return(0,p._)(e,[{key:"close",value:function(){this._handleClose()}}]),e}()),ec=function(e){function t(e){(0,i._)(this,t);var n,r=e.id,o=e.to,a=e.seq,s=e.ack,p=e.sendBuffer,u=e.telemetry,c=e.log;return n=(0,Z._)(this,t,[e]),(0,l._)(n,"id",void 0),(0,l._)(n,"telemetry",void 0),(0,l._)(n,"to",void 0),(0,l._)(n,"seq",void 0),(0,l._)(n,"ack",void 0),(0,l._)(n,"sendBuffer",void 0),n.id=r,n.to=o,n.seq=a,n.ack=s,n.sendBuffer=p,n.telemetry=u,n.log=c,n}return(0,en._)(t,e),(0,p._)(t,[{key:"loggingMetadata",get:function(){var e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}},{key:"constructMsg",value:function(e){var t=(0,c._)((0,u._)({},e),{id:(0,er.generateId)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack});return this.seq++,t}},{key:"nextSeq",value:function(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}},{key:"_handleStateExit",value:function(){}},{key:"_handleClose",value:function(){this.sendBuffer.length=0,this.telemetry.span.end()}}]),t}(eu),ed=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,l._)(n,"graceExpiryTime",void 0),(0,l._)(n,"gracePeriodTimeout",void 0),(0,l._)(n,"listeners",void 0),n.listeners=e.listeners,n.graceExpiryTime=e.graceExpiryTime,n.gracePeriodTimeout=setTimeout(function(){n.listeners.onSessionGracePeriodElapsed()},n.graceExpiryTime-Date.now()),n}return(0,en._)(t,e),(0,p._)(t,[{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}}]),t}(ec),ey=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,l._)(n,"state","Connecting"),(0,l._)(n,"connPromise",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"connectionTimeout",void 0),n.connPromise=e.connPromise,n.listeners=e.listeners,n.connPromise.then(function(e){n._isConsumed||n.listeners.onConnectionEstablished(e)},function(e){n._isConsumed||n.listeners.onConnectionFailed(e)}),n.connectionTimeout=setTimeout(function(){n.listeners.onConnectionTimeout()},n.options.connectionTimeoutMs),n}return(0,en._)(t,e),(0,p._)(t,[{key:"bestEffortClose",value:function(){var e=this.log,t=this.loggingMetadata;this.connPromise.then(function(n){n.close(),null==e||e.info("connection eventually resolved but session has transitioned, closed connection",(0,u._)({},t,n.loggingMetadata))}).catch(function(){})}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}},{key:"_handleClose",value:function(){this.bestEffortClose(),(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}}]),t}(ed),ef=function(e){function t(){var e;return(0,i._)(this,t),e=(0,Z._)(this,t,arguments),(0,l._)(e,"state","NoConnection"),e}return(0,en._)(t,e),(0,p._)(t,[{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this)}}]),t}(ed),eT=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,l._)(n,"state","WaitingForHandshake"),(0,l._)(n,"conn",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"handshakeTimeout",void 0),(0,l._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,en._)(t,e),(0,p._)(t,[{key:"loggingMetadata",get:function(){return(0,u._)({clientId:this.from,connId:this.conn.id},this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}},{key:"_handleClose",value:function(){this.conn.close()}}]),t}(eu),eh=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,l._)(n,"state","Handshaking"),(0,l._)(n,"conn",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"handshakeTimeout",void 0),(0,l._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,en._)(t,e),(0,p._)(t,[{key:"loggingMetadata",get:function(){return(0,u._)({},(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(ed),eg=function(e){function t(e){if((0,i._)(this,t),a=(0,Z._)(this,t,[e]),(0,l._)(a,"state","Connected"),(0,l._)(a,"conn",void 0),(0,l._)(a,"listeners",void 0),(0,l._)(a,"heartbeatHandle",void 0),(0,l._)(a,"heartbeatMisses",0),(0,l._)(a,"isActivelyHeartbeating",void 0),(0,l._)(a,"onMessageData",function(e){var t=a.parseMsg(e);if(null===t)return void a.listeners.onInvalidMessage("could not parse message");if(t.seq!==a.ack){if(t.seq<a.ack)null==(i=a.log)||i.debug("received duplicate msg (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,"), discarding"),(0,c._)((0,u._)({},a.loggingMetadata),{transportMessage:t}));else{var n,r,i,o,s="received out-of-order msg, closing connection (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,")");null==(o=a.log)||o.warn(s,(0,c._)((0,u._)({},a.loggingMetadata),{transportMessage:t,tags:["invariant-violation"]})),a.telemetry.span.setStatus({code:eo.SpanStatusCode.ERROR,message:s}),a.closeConnection()}return}(null==(n=a.log)||n.debug("received msg",(0,c._)((0,u._)({},a.loggingMetadata),{transportMessage:t})),a.updateBookkeeping(t.ack,t.seq),(0,er.isAck)(t.controlFlags))?(null==(r=a.log)||r.debug("discarding msg (ack bit set)",(0,c._)((0,u._)({},a.loggingMetadata),{transportMessage:t})),a.isActivelyHeartbeating||a.sendHeartbeat()):a.listeners.onMessage(t)}),a.conn=e.conn,a.listeners=e.listeners,a.conn.addDataListener(a.onMessageData),a.conn.addCloseListener(a.listeners.onConnectionClosed),a.conn.addErrorListener(a.listeners.onConnectionErrored),a.sendBuffer.length>0){null==(s=a.log)||s.info("sending ".concat(a.sendBuffer.length," buffered messages, starting at seq ").concat(a.nextSeq()),a.loggingMetadata);var n=!0,r=!1,o=void 0;try{for(var a,s,p,d=a.sendBuffer[Symbol.iterator]();!(n=(p=d.next()).done);n=!0){var y=p.value;a.conn.send(a.options.codec.toBuffer(y))}}catch(e){r=!0,o=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw o}}}return a.isActivelyHeartbeating=!1,a.heartbeatHandle=setInterval(function(){var e,t=a.heartbeatMisses,n=t*a.options.heartbeatIntervalMs;if(t>=a.options.heartbeatsUntilDead){null==(e=a.log)||e.info("closing connection to ".concat(a.to," due to inactivity (missed ").concat(t," heartbeats which is ").concat(n,"ms)"),a.loggingMetadata),a.telemetry.span.addEvent("closing connection due to inactivity"),a.conn.close(),clearInterval(a.heartbeatHandle),a.heartbeatHandle=void 0;return}a.isActivelyHeartbeating&&a.sendHeartbeat(),a.heartbeatMisses++},a.options.heartbeatIntervalMs),a}return(0,en._)(t,e),(0,p._)(t,[{key:"updateBookkeeping",value:function(e,t){this.sendBuffer=this.sendBuffer.filter(function(t){return t.seq>=e}),this.ack=t+1,this.heartbeatMisses=0}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}},{key:"loggingMetadata",get:function(){return(0,u._)({},(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"startActiveHeartbeat",value:function(){this.isActivelyHeartbeating=!0}},{key:"sendHeartbeat",value:function(){var e;null==(e=this.log)||e.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}},{key:"closeConnection",value:function(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}},{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(ec),ev=function(e){function t(e){var n;return(0,i._)(this,t),n=(0,Z._)(this,t,[e]),(0,l._)(n,"state","BackingOff"),(0,l._)(n,"listeners",void 0),(0,l._)(n,"backoffTimeout",void 0),n.listeners=e.listeners,n.backoffTimeout=setTimeout(function(){n.listeners.onBackoffFinished()},e.backoffMs),n}return(0,en._)(t,e),(0,p._)(t,[{key:"_handleClose",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,ee._)((0,et._)(t.prototype),"_handleStateExit",this).call(this),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}}]),t}(ed);function em(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function eS(e){return(0,c._)((0,u._)({},em(e)),{graceExpiryTime:e.graceExpiryTime})}var eE=function(e,t,n,r,i){var o,a="session-".concat((0,er.generateId)()),s=(0,er.createSessionTelemetryInfo)(a,e,t),p=new ef({listeners:n,id:a,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+r.sessionDisconnectGraceMs,sendBuffer:[],telemetry:s,options:r,log:i});return null==(o=p.log)||o.info("session ".concat(p.id," created in NoConnection state"),(0,c._)((0,u._)({},p.loggingMetadata),{tags:["state-transition"]})),p},eb={NoConnectionToBackingOff:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new ev((0,u._)({backoffMs:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from NoConnection to BackingOff"),(0,c._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},BackingOffToConnecting:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new ey((0,u._)({connPromise:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from BackingOff to Connecting"),(0,c._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},ConnectingToHandshaking:function(e,t,n){var r,i=eS(e);e._handleStateExit();var o=new eh((0,u._)({conn:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from Connecting to Handshaking"),(0,c._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},HandshakingToConnected:function(e,t){var n,r=em(e),i=e.conn;e._handleStateExit();var o=new eg((0,u._)({conn:i,listeners:t},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Handshaking to Connected"),(0,c._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o},WaitingForHandshakeToConnected:function(e,t,n,r,i,o){var a,s=e.conn,p=e.from,l=e.options,d=t?em(t):{id:n,from:p,to:r,seq:0,ack:0,sendBuffer:[],telemetry:(0,er.createSessionTelemetryInfo)(n,r,p,i),options:l,log:e.log};e._handleStateExit(),null==t||t._handleStateExit();var y=new eg((0,u._)({conn:s,listeners:o},d));return null==(a=y.log)||a.info("session ".concat(y.id," transition from WaitingForHandshake to Connected"),(0,c._)((0,u._)({},y.loggingMetadata),{tags:["state-transition"]})),y},BackingOffToNoConnection:function(e,t){var n,r=eS(e);e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from BackingOff to NoConnection"),(0,c._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectingToNoConnection:function(e,t){var n,r=eS(e);e.bestEffortClose(),e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Connecting to NoConnection"),(0,c._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},HandshakingToNoConnection:function(e,t){var n,r=eS(e);e.conn.close(),e._handleStateExit();var i=new ef((0,u._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Handshaking to NoConnection"),(0,c._)((0,u._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectedToNoConnection:function(e,t){var n,r=em(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();var o=new ef((0,u._)({listeners:t,graceExpiryTime:i},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Connected to NoConnection"),(0,c._)((0,u._)({},o.loggingMetadata),{tags:["state-transition"]})),o}},eR={entrypoint:eE,transition:{NoConnectionToBackingOff:eb.NoConnectionToBackingOff,BackingOffToConnecting:eb.BackingOffToConnecting,ConnectingToHandshaking:eb.ConnectingToHandshaking,HandshakingToConnected:eb.HandshakingToConnected,BackingOffToNoConnection:eb.BackingOffToNoConnection,ConnectingToNoConnection:eb.ConnectingToNoConnection,HandshakingToNoConnection:eb.HandshakingToNoConnection,ConnectedToNoConnection:eb.ConnectedToNoConnection}};eb.WaitingForHandshakeToConnected,eb.ConnectedToNoConnection;var eI="conn_retry_exceeded",eC="handshake_failed",eO=function(){function e(){(0,i._)(this,e),(0,l._)(this,"eventListeners",{})}return(0,p._)(e,[{key:"removeAllListeners",value:function(){this.eventListeners={}}},{key:"numberOfListeners",value:function(e){var t,n;return null!=(n=null==(t=this.eventListeners[e])?void 0:t.size)?n:0}},{key:"addEventListener",value:function(e,t){var n;this.eventListeners[e]||(this.eventListeners[e]=new Set),null==(n=this.eventListeners[e])||n.add(t)}},{key:"removeEventListener",value:function(e,t){var n;this.eventListeners[e]&&(null==(n=this.eventListeners[e])||n.delete(t))}},{key:"dispatchEvent",value:function(e,t){var n=this.eventListeners[e];if(n){var r=(0,z._)(n),i=!0,o=!1,a=void 0;try{for(var s,p=r[Symbol.iterator]();!(i=(s=p.next()).done);i=!0)(0,s.value)(t)}catch(e){o=!0,a=e}finally{try{i||null==p.return||p.return()}finally{if(o)throw a}}}}}]),e}(),eA=function(){function e(t,n){(0,i._)(this,e),(0,l._)(this,"status",void 0),(0,l._)(this,"clientId",void 0),(0,l._)(this,"eventDispatcher",void 0),(0,l._)(this,"options",void 0),(0,l._)(this,"log",void 0),(0,l._)(this,"sessions",void 0),this.options=(0,u._)({},ea,n),this.eventDispatcher=new eO,this.clientId=t,this.status="open",this.sessions=new Map}return(0,p._)(e,[{key:"bindLogger",value:function(e,t){if("function"==typeof e){this.log=X(new Q(e,t));return}this.log=X(e)}},{key:"handleMsg",value:function(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}},{key:"addEventListener",value:function(e,t){this.eventDispatcher.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.eventDispatcher.removeEventListener(e,t)}},{key:"protocolError",value:function(e){this.eventDispatcher.dispatchEvent("protocolError",e)}},{key:"close",value:function(){this.status="closed";var e=!0,t=!1,n=void 0;try{for(var r,i,o=this.sessions.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.deleteSession(a)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),null==(r=this.log)||r.info("manually closed transport",{clientId:this.clientId})}},{key:"getStatus",value:function(){return this.status}},{key:"updateSession",value:function(e){var t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error("attempt to transition active session for ".concat(e.to," but active session (").concat(t.id,") is different from handle (").concat(e.id,")"));return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}},{key:"deleteSession",value:function(e,t){if(!e._isConsumed){var n,r=e.loggingMetadata;r.tags&&(null==t?void 0:t.unhealthy)&&r.tags.push("unhealthy-session"),null==(n=e.log)||n.info("closing session ".concat(e.id),r),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});var i=e.to;e.close(),this.sessions.delete(i)}}},{key:"onSessionGracePeriodElapsed",value:function(e){var t;null==(t=this.log)||t.warn("session to ".concat(e.to," grace period elapsed, closing"),e.loggingMetadata),this.deleteSession(e)}},{key:"onConnectingFailed",value:function(e){var t=this,n=eb.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}});return this.updateSession(n)}},{key:"onConnClosed",value:function(e){var t,n=this;return t="Handshaking"===e.state?eb.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}):eb.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}}]),e}(),e_=function(){function e(){(0,i._)(this,e),(0,l._)(this,"id",void 0),(0,l._)(this,"telemetry",void 0),(0,l._)(this,"_dataListeners",new Set),(0,l._)(this,"_closeListeners",new Set),(0,l._)(this,"_errorListeners",new Set),this.id="conn-".concat((0,er.generateId)())}return(0,p._)(e,[{key:"loggingMetadata",get:function(){var e,t,n={connId:this.id},r=null==(e=this.telemetry)?void 0:e.span.spanContext();return(null==(t=this.telemetry)?void 0:t.span.isRecording())&&r&&(n.telemetry={traceId:r.traceId,spanId:r.spanId}),n}},{key:"dataListeners",get:function(){return(0,z._)(this._dataListeners)}},{key:"closeListeners",get:function(){return(0,z._)(this._closeListeners)}},{key:"errorListeners",get:function(){return(0,z._)(this._errorListeners)}},{key:"addDataListener",value:function(e){this._dataListeners.add(e)}},{key:"removeDataListener",value:function(e){this._dataListeners.delete(e)}},{key:"addCloseListener",value:function(e){this._closeListeners.add(e)}},{key:"removeCloseListener",value:function(e){this._closeListeners.delete(e)}},{key:"addErrorListener",value:function(e){this._errorListeners.add(e)}},{key:"removeErrorListener",value:function(e){this._errorListeners.delete(e)}}]),e}(),ek=function(){function e(t){(0,i._)(this,e),(0,l._)(this,"budgetConsumed",void 0),(0,l._)(this,"intervalHandle",void 0),(0,l._)(this,"options",void 0),this.options=t,this.budgetConsumed=0}return(0,p._)(e,[{key:"getBackoffMs",value:function(){if(0===this.getBudgetConsumed())return 0;var e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*Math.pow(2,e),this.options.maxBackoffMs)+t}},{key:"totalBudgetRestoreTime",get:function(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}},{key:"consumeBudget",value:function(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}},{key:"getBudgetConsumed",value:function(){return this.budgetConsumed}},{key:"hasBudget",value:function(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}},{key:"startRestoringBudget",value:function(){var e=this;this.intervalHandle||(this.intervalHandle=setInterval(function(){var t=e.budgetConsumed;if(!t)return void e.stopLeak();var n=t-1;0!==n&&(e.budgetConsumed=n)},this.options.budgetRestoreIntervalMs))}},{key:"stopLeak",value:function(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}},{key:"close",value:function(){this.stopLeak()}}]),e}(),eU=function(e){function t(e,n){var r;return(0,i._)(this,t),r=(0,Z._)(this,t,[e,n]),(0,l._)(r,"options",void 0),(0,l._)(r,"retryBudget",void 0),(0,l._)(r,"reconnectOnConnectionDrop",!0),(0,l._)(r,"handshakeExtensions",void 0),(0,l._)(r,"sessions",void 0),r.sessions=new Map,r.options=(0,u._)({},es,n),r.retryBudget=new ek(r.options),r}return(0,en._)(t,e),(0,p._)(t,[{key:"extendHandshake",value:function(e){this.handshakeExtensions=e}},{key:"tryReconnecting",value:function(e){var t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}},{key:"send",value:function(e,t){if("closed"===this.getStatus()){var n,r="transport is closed, cant send";throw null==(n=this.log)||n.error(r,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(r)}var i=this.sessions.get(e);return i||(i=this.createUnconnectedSession(e)),i.send(t)}},{key:"createUnconnectedSession",value:function(e){var t=this,n=eR.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}},this.options,this.log);return this.updateSession(n),n}},{key:"onConnectingFailed",value:function(e){var n=(0,ee._)((0,et._)(t.prototype),"onConnectingFailed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnClosed",value:function(e){var n=(0,ee._)((0,et._)(t.prototype),"onConnClosed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnectionEstablished",value:function(e,t){var n=this,r=eR.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:function(e){var t,i=(0,er.coerceErrorString)(e);null==(t=n.log)||t.error("connection to ".concat(r.to," errored during handshake: ").concat(i),r.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=n.log)||e.warn("connection to ".concat(r.to," closed during handshake"),r.loggingMetadata),n.onConnClosed(r)},onHandshake:function(e){n.onHandshakeResponse(r,e)},onInvalidHandshake:function(t,i){var o;null==(o=n.log)||o.error("invalid handshake: ".concat(t),r.loggingMetadata),n.deleteSession(e,{unhealthy:!0}),n.protocolError({type:eC,code:i,message:t})},onHandshakeTimeout:function(){var e;null==(e=n.log)||e.error("connection to ".concat(r.to," timed out during handshake"),r.loggingMetadata),n.onConnClosed(r)},onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(r)}});return this.updateSession(r),this.sendHandshake(r),r}},{key:"rejectHandshakeResponse",value:function(e,t,n){var r,i;null==(r=e.conn.telemetry)||r.span.setStatus({code:eo.SpanStatusCode.ERROR,message:t}),null==(i=this.log)||i.warn(t,n),this.deleteSession(e,{unhealthy:!0})}},{key:"onHandshakeResponse",value:function(e,t){var n,r=this;if(!ei.Value.Check(er.ControlMessageHandshakeResponseSchema,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",(0,c._)((0,u._)({},e.loggingMetadata),{transportMessage:t,validationErrors:(0,z._)(ei.Value.Errors(er.ControlMessageHandshakeResponseSchema,t.payload))}));if(!t.payload.status.ok){var i=ei.Value.Check(er.HandshakeErrorRetriableResponseCodes,t.payload.status.code),o="handshake failed: ".concat(t.payload.status.reason),a=e.to;this.rejectHandshakeResponse(e,o,(0,c._)((0,u._)({},e.loggingMetadata),{transportMessage:t})),i?this.tryReconnecting(a):this.protocolError({type:eC,code:t.payload.status.code,message:o});return}if(t.payload.status.sessionId!==e.id){var s="session id mismatch: expected ".concat(e.id,", got ").concat(t.payload.status.sessionId);this.rejectHandshakeResponse(e,s,(0,c._)((0,u._)({},e.loggingMetadata),{transportMessage:t}));return}null==(n=this.log)||n.info("handshake from ".concat(t.from," ok"),(0,c._)((0,u._)({},e.loggingMetadata),{transportMessage:t}));var p=eR.transition.HandshakingToConnected(e,{onConnectionErrored:function(e){var t,n=(0,er.coerceErrorString)(e);null==(t=r.log)||t.warn("connection to ".concat(p.to," errored: ").concat(n),p.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=r.log)||e.info("connection to ".concat(p.to," closed"),p.loggingMetadata),r.onConnClosed(p)},onMessage:function(e){return r.handleMsg(e)},onInvalidMessage:function(e){r.deleteSession(p,{unhealthy:!0}),r.protocolError({type:"invalid_message",message:e})}});this.updateSession(p),this.retryBudget.startRestoringBudget()}},{key:"connect",value:function(e){var t=this;if("open"!==this.getStatus()){null==(i=this.log)||i.info("transport state is no longer open, cancelling attempt to connect to ".concat(e));return}var n=this.sessions.get(e);if(null!=n||(n=this.createUnconnectedSession(e)),"NoConnection"!==n.state){null==(o=this.log)||o.debug("session to ".concat(e," has state ").concat(n.state,", skipping connect attempt"),n.loggingMetadata);return}if(!this.retryBudget.hasBudget()){var r,i,o,a,s=this.retryBudget.getBudgetConsumed(),p="tried to connect to ".concat(e," but retry budget exceeded (more than ").concat(s," attempts in the last ").concat(this.retryBudget.totalBudgetRestoreTime,"ms)");null==(a=this.log)||a.error(p,n.loggingMetadata),this.protocolError({type:eI,message:p});return}var l=this.retryBudget.getBackoffMs();null==(r=this.log)||r.info("attempting connection to ".concat(e," (").concat(l,"ms backoff)"),n.loggingMetadata),this.retryBudget.consumeBudget();var u=eR.transition.NoConnectionToBackingOff(n,l,{onBackoffFinished:function(){t.onBackoffFinished(u)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(u)}});this.updateSession(u)}},{key:"onBackoffFinished",value:function(e){var t=this,n=er.tracing_default.startActiveSpan("connect",function(n){return(0,r._)(function(){var t,r;return(0,d._)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),[4,this.createNewOutgoingConnection(e.to)];case 1:return[2,i.sent()];case 2:throw t=i.sent(),r=(0,er.coerceErrorString)(t),n.recordException(r),n.setStatus({code:eo.SpanStatusCode.ERROR}),t;case 3:return n.end(),[7];case 4:return[2]}})}).call(t)}),i=eR.transition.BackingOffToConnecting(e,n,{onConnectionEstablished:function(e){var n;null==(n=t.log)||n.debug("connection to ".concat(i.to," established"),(0,u._)({},e.loggingMetadata,i.loggingMetadata)),t.onConnectionEstablished(i,e)},onConnectionFailed:function(e){var n,r=(0,er.coerceErrorString)(e);null==(n=t.log)||n.error("error connecting to ".concat(i.to,": ").concat(r),i.loggingMetadata),t.onConnectingFailed(i)},onConnectionTimeout:function(){var e;null==(e=t.log)||e.error("connection to ".concat(i.to," timed out"),i.loggingMetadata),t.onConnectingFailed(i)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(i)}});this.updateSession(i)}},{key:"sendHandshake",value:function(e){return(0,r._)(function(){var t,n,r;return(0,d._)(this,function(i){switch(i.label){case 0:if(n=void 0,!this.handshakeExtensions)return[3,2];return[4,this.handshakeExtensions.construct()];case 1:n=i.sent(),i.label=2;case 2:if(e._isConsumed)return[2];return r=(0,er.handshakeRequestMessage)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:n,tracing:(0,er.getPropagationContext)(e.telemetry.ctx)}),null==(t=this.log)||t.debug("sending handshake request to ".concat(e.to),(0,c._)((0,u._)({},e.loggingMetadata),{transportMessage:r})),e.sendHandshake(r),[2]}})}).call(this)}},{key:"close",value:function(){this.retryBudget.close(),(0,ee._)((0,et._)(t.prototype),"close",this).call(this)}}]),t}(eA),ew=function(e){function t(e,n){(0,i._)(this,t),r=(0,Z._)(this,t),(0,l._)(r,"ws",void 0),(0,l._)(r,"extras",void 0),r.ws=e,r.extras=n,r.ws.binaryType="arraybuffer";var r,o=!1;return r.ws.onerror=function(){o=!0},r.ws.onclose=function(e){var t=e.code,n=e.reason;if(o){var i=Error("websocket closed with code and reason: ".concat(t," - ").concat(n)),a=!0,s=!1,p=void 0;try{for(var l,u=r.errorListeners[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)(0,l.value)(i)}catch(e){s=!0,p=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw p}}}var c=!0,d=!1,y=void 0;try{for(var f,T=r.closeListeners[Symbol.iterator]();!(c=(f=T.next()).done);c=!0)(0,f.value)()}catch(e){d=!0,y=e}finally{try{c||null==T.return||T.return()}finally{if(d)throw y}}},r.ws.onmessage=function(e){var t=!0,n=!1,i=void 0;try{for(var o,a=r.dataListeners[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)(0,o.value)(e.data)}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}},r}return(0,en._)(t,e),(0,p._)(t,[{key:"loggingMetadata",get:function(){var e=(0,ee._)((0,et._)(t.prototype),"loggingMetadata",this);return this.extras&&(e.extras=this.extras),e}},{key:"send",value:function(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}},{key:"close",value:function(){this.ws.close(1e3)}}]),t}(e_),eN=function(e){function t(e,n,r){var o;return(0,i._)(this,t),o=(0,Z._)(this,t,[n,r]),(0,l._)(o,"wsGetter",void 0),o.wsGetter=e,o}return(0,en._)(t,e),(0,p._)(t,[{key:"createNewOutgoingConnection",value:function(e){return(0,r._)(function(){var t,n,r,i;return(0,d._)(this,function(o){switch(o.label){case 0:return null==(t=this.log)||t.info("establishing a new websocket to ".concat(e),{clientId:this.clientId,connectedTo:e}),[4,this.wsGetter(e)];case 1:return r=o.sent(),[4,new Promise(function(e,t){r.readyState===r.OPEN?e():r.readyState===r.CLOSING||r.readyState===r.CLOSED?t(Error("ws is closing or closed")):(r.onopen=function(){e()},r.onclose=function(e){t(Error(e.reason))},r.onerror=function(e){t(Error(e.message))})})];case 2:return o.sent(),i=new ew(r),null==(n=this.log)||n.info("raw websocket to ".concat(e," ok"),(0,u._)({clientId:this.clientId,connectedTo:e},i.loggingMetadata)),[2,i]}})}).call(this)}}]),t}(eU);function eD(e){throw Error("Unhandled discriminated union member: ".concat(JSON.stringify(e)))}var eP=(0,c._)((0,u._)({},{codec:{toBuffer:function(e){return new W({ignoreUndefined:!0}).encodeSharedRef(e)},fromBuffer:function(e){try{var t=new $(void 0).decode(e);if((void 0===t?"undefined":(0,h._)(t))!=="object")return null;return t}catch(e){return null}}},heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3}),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),eM=new WeakMap,ex=new WeakMap,ej=function(){function e(t){var n=this,p=t.clientId,y=t.serverId,h=t.connectImmediately,g=t.logger,v=t.getEndpoint,m=t.overrideWebsocket,S=t.onProtocolError,E=t.onRetriesExceeded;(0,i._)(this,e),(0,l._)(this,"clientId",void 0),(0,l._)(this,"serverId",void 0),(0,l._)(this,"log",void 0),(0,l._)(this,"transport",void 0),(0,a._)(this,eM,{writable:!0,value:void 0}),(0,a._)(this,ex,{writable:!0,value:void 0}),(0,l._)(this,"session",void 0),(0,l._)(this,"dispose",null),this.clientId=p,this.serverId=y,this.log=null!=g?g:null;var b={};this.transport=new eN(function(){return(0,r._)(function(){var e,t,n,r,i,o;return(0,d._)(this,function(a){switch(a.label){case 0:if(n=Date.now(),!m)return[3,2];return[4,v()];case 1:return i=m.apply(void 0,[a.sent().toString()]),[3,4];case 2:return o=WebSocket.bind,[4,v()];case 3:i=new(o.apply(WebSocket,[void 0,a.sent().toString()])),a.label=4;case 4:return r=i,null==(e=(t=this).log)||e.call(t,"ai-chat: ws open",{extras:{duration:Date.now()-n}}),[2,r]}})}).call(n)},this.clientId,eP),g&&this.transport.bindLogger(g,"info"),this.session=new f.ObservableState(null),(0,s._)(this,eM,new f.ObservableState("disconnected")),(0,s._)(this,ex,(0,T.createClient)(this.transport,y,{eagerlyConnect:!1,connectOnInvoke:!1})),this.transport.addEventListener("sessionTransition",function(e){var t,r,i,a,s;"BackingOff"===e.state||("Connecting"===e.state?(b.connectionStart=Date.now(),null==(t=n.log)||t.call(n,"ai-chat: connecting",{clientId:n.clientId})):"Handshaking"===e.state?(b.handshakeStart=Date.now(),null==(r=n.log)||r.call(n,"ai-chat: handshaking",{clientId:n.clientId})):"Connected"===e.state?(b.connectionStart&&b.handshakeStart&&(null==(i=n.log)||i.call(n,"ai-chat: connected",{clientId:n.clientId,extras:(0,c._)((0,u._)({},b),{connectionDuration:b.handshakeStart-b.connectionStart,handshakeDuration:Date.now()-b.handshakeStart,totalDuration:Date.now()-b.connectionStart})})),b.connectionStart=void 0,b.handshakeStart=void 0):"NoConnection"===e.state?(null==(a=n.log)||a.call(n,"ai-chat: no connection",{clientId:n.clientId}),b.connectionStart=void 0,b.handshakeStart=void 0):eD(e)),n.is("closed","error")||("Connected"===e.state?(n.session.set(null!=(s=n.transport.sessions.values().next().value)?s:null),(0,o._)(n,eM).set("connected")):(n.session.set(null),n.transport.reconnectOnConnectionDrop?(0,o._)(n,eM).set("connecting"):(0,o._)(n,eM).set("disconnected")))}),this.transport.addEventListener("sessionStatus",function(e){var t,r;"connect"===e.status?(b.sessionStart=Date.now(),null==(t=n.log)||t.call(n,"ai-chat: session started",{sessionId:e.session.id,clientId:n.clientId})):"disconnect"===e.status?b.sessionStart&&(null==(r=n.log)||r.call(n,"ai-chat: session ended",{sessionId:e.session.id,clientId:n.clientId,extras:{sessionDuration:Date.now()-b.sessionStart}})):eD(e.status),n.is("closed","error")||"disconnect"===e.status&&(n.session.set(null),n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("protocolError",function(e){var t,r;e.type===eC&&(null==(t=n.log)||t.call(n,"river handshake failed",{clientId:p},"error")),e.type===eI?(null==(r=n.log)||r.call(n,"ai-chat: retry budget exhausted",{clientId:p},"error"),n.close(),null==E||E(e)):(n.error(),null==S||S(e))});var R=function(){return!n.is("closed","error")&&"visible"===document.visibilityState&&window.navigator.onLine},I=function(){var e=n.transport.reconnectOnConnectionDrop,t=R();n.transport.reconnectOnConnectionDrop=t,e&&!t&&!n.session.current&&n.is("connecting")&&(0,o._)(n,eM).set("disconnected"),t&&n.is("disconnected")&&n.connect()};this.transport.reconnectOnConnectionDrop=R(),document.addEventListener("visibilitychange",I),window.addEventListener("online",I),window.addEventListener("offline",I),this.dispose=function(){document.removeEventListener("visibilitychange",I),window.removeEventListener("online",I),window.removeEventListener("offline",I)},R()&&!1!==h&&this.connect(),!0===h&&this.connect()}return(0,p._)(e,[{key:"status",get:function(){return(0,o._)(this,eM)}},{key:"service",get:function(){return(0,o._)(this,ex).chatService}},{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes((0,o._)(this,eM).current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat((0,o._)(this,eM).current," ChatConnection"));this.is("connected","connecting")||((0,o._)(this,eM).set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;(0,o._)(this,eM).set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,r._)(function(){var t,n,r,i,o,a,s;return(0,d._)(this,function(p){switch(p.label){case 0:t=setTimeout(function(){t=null},e),p.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,r=!0,i=!1,o=void 0;try{for(a=this.transport.sessions.values()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(s.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return p.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;(0,o._)(this,eM).set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();function eL(e){var t=e.currentUserId;return"chat-client-".concat(t,"-").concat((0,y.nanoid)())}e.s(["ChatConnection",()=>ej,"createClientId",()=>eL],435106)},600637,416143,63846,924908,885505,e=>{"use strict";var t=e.i(297083),n=e.i(530658),r=e.i(817556),i=e.i(389959),o=e.i(906368),a=e.i(435106),s=e.i(892280),s=s,p=e.i(267710),l=e.i(952098),u=e.i(439725),c=e.i(17886),d={production:"wss://production-ai-chat.replit.com/river",staging:"wss://staging-ai-chat.replit.com/river",development:"ws://127.0.0.1:8000/river"};e.s(["AiEndpoints",()=>d],416143);var y=e.i(282453),f="ghostwriter-chat-env",T=u.default.env.CHAT_SERVICE_OVERRIDE,h=y.default.get(f,"string"),g=function(){return T||h||((0,c.isEnvProduction)()?d.production:d.staging)};function v(e){y.default.set(f,e)}e.s(["endpointOverride",()=>T,"getAiEndpoint",()=>g,"setAiEndpoint",()=>v],63846),e.i(660670);var m=e.i(170039),S=e.i(993796),E=e.i(98816),b=e.i(664152),R="SERVER",I=window.location.search.includes("aiChatDebug=1");function C(e){var u=e.endpoint,c=e.replId,d=e.currentUserId,y=e.orgId,f=e.onRetriesExceeded,T=e.onProtocolError,h=(0,n._)((0,i.useState)(null),2),v=h[0],C=h[1],O=(0,E.default)(f),A=(0,E.default)(T),_=(0,S.useFlag)({controlName:"flag-use-chort-chat-proxy",type:"boolean",default:!1}),k=null!==(0,m.getUseChatProxyOverride)()?(0,m.getUseChatProxyOverride)():_;return(0,i.useEffect)(function(){k&&console.warn("[ai-chat] Creating connection with chat proxy enabled");var e=(0,a.createClientId)({currentUserId:d}),n=new a.ChatConnection({clientId:e,serverId:R,logger:function(e,t,n){var r;I&&console[null!=n?n:"info"]("[ai-chat]"+e,t),b.logger[null!=n?n:"info"](e,{river:t,riverTarget:"ai-chat",riverVersion:s.version,riverProxied:k}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&o.withScope(function(n){n.setTag("ai-chat",!0),n.setTag("ai-chat-proxy",k),n.setExtras(t),o.captureException(Error(e))})},getEndpoint:function(){return(0,t._)(function(){var t,n,i,o;return(0,r._)(this,function(r){switch(r.label){case 0:if(u)return[2,u];if(!k)return[3,2];return[4,(0,p.auth)(c,e,y)];case 1:return t=r.sent(),(n=new URL((0,l.getCurrentChatProxyEndpoint)())).searchParams.set("auth_token",t),[2,n];case 2:return[4,(0,p.auth)(c,e,y)];case 3:return i=r.sent(),(o=new URL(g())).searchParams.set("auth_token",i),[2,o]}})})()},onProtocolError:function(e){var t;null==(t=A.current)||t.call(A,e)},onRetriesExceeded:function(e){var t;null==(t=O.current)||t.call(O,e)}});return C(n),function(){C(null),n.drained().then(function(){return n.close()})}},[u,c,d,y,O,A,k]),v}e.s(["AI_CHAT_SERVER_ID",()=>R,"useCreateChatConnection",()=>C],600637);var O=e.i(276385),A=e.i(161322),_=e.i(719518);e.i(824359);var k=(0,i.createContext)(null);function U(e){var t=(0,i.useMemo)(function(){return{store:e.store,yapper:e.yapper}},[e.store,e.yapper]);return(0,O.jsx)(k.Provider,{value:t,children:e.children})}function w(){var e=(0,i.useContext)(k);if(!e)throw Error("Expected Yapper in context");return e.yapper}function N(){var e=(0,i.useContext)(k);if(!e)throw Error("Expected Yapper in context");return e.yapper.chatter()}function D(e,t){var n=w(),r=(0,i.useRef)(t);r.current=t,(0,i.useEffect)(function(){return n.hook(e,function(e){return r.current(e)})},[n,e])}function P(){var e=(0,i.useContext)(k);if(!e)throw Error("Expected store in context");return e.store}function M(e){return(0,A.useAtomValue)(e,{store:P()})}var x=function(e){return(0,A.useSetAtom)(e,{store:P()})};function j(e){return(0,_.useAtomCallback)((0,i.useCallback)(function(t){return t(e)},[e]),{store:P()})}e.s(["StoreProvider",()=>U,"useChatHook",()=>D,"useChatter",()=>N,"useGet",()=>j,"useSet",()=>x,"useValue",()=>M,"useYapper",()=>w],924908);var L=e.i(399119),B=e.i(904851),F=e.i(721281),G=e.i(445789),q=e.i(167626),V=e.i(346715),$=e.i(119468),W=e.i(463348),z=e.i(960933),H=e.i(862927);e.i(242933);var K=e.i(279606),Y=function e(t){(0,B._)(this,e),(0,F._)(this,"ok",!0),(0,F._)(this,"payload",void 0),this.payload=t},Q=z.Type.Object({code:z.Type.String(),message:z.Type.Optional(z.Type.String()),extras:z.Type.Optional(z.Type.Unknown())}),X=z.Type.Object({ok:z.Type.Literal(!1),payload:Q}),J=function(e){function t(e){(0,B._)(this,t);var n,r,i={code:"UNCAUGHT_ERROR",message:"An unexpected error occurred"};if((0,q._)(e,K.CompletionError))i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect",r=e.stack;else if((0,q._)(e,Error))i.message=e.message,r=e.stack;else if("UNEXPECTED_DISCONNECT"===e)i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect";else if("UNCAUGHT_ERROR"===e)i.code="UNCAUGHT_ERROR",i.message="An unexpected error occurred";else if("string"==typeof e)i.message=e;else if(e&&(void 0===e?"undefined":(0,$._)(e))==="object"){var o=null;H.Value.Check(Q,e)?o=e:H.Value.Check(X,e)&&(o=e.payload),o&&(i.code=o.code,i.message=o.message,i.extras=o.extras)}return n=(0,L._)(this,t,[i.message]),(0,F._)(n,"ok",!1),(0,F._)(n,"payload",void 0),(0,F._)(n,"input",void 0),(0,F._)(n,"reported",void 0),n.name="ChatError",n.payload=i,n.input=e,r&&(n.stack=r),n}return(0,G._)(t,e),t}((0,W._)(Error));function Z(e){return new Y(e)}function ee(e){return(0,q._)(e,J)?e:new J(e)}function et(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?!e.ok&&n.includes(e.payload.code):!e.ok}function en(e){if("function"==typeof e)try{var t,n=e();if((0,q._)(n,Promise))return n.then(function(e){return Z(e)}).catch(function(e){return ee(e)});return Z(n)}catch(e){return ee(e)}if((0,q._)(e,Promise))return e.then(function(e){return Z(e)}).catch(function(e){return ee(e)});if(Array.isArray(e)){if(0===e.length)throw Error("At least one observable is required");return(t=K.Observable).combine.apply(t,(0,V._)(e)).once().then(function(e){return Z(e)}).catch(function(e){return ee(e)})}return K.Observable.from(e).once().then(function(e){return Z(e)}).catch(function(e){return ee(e)})}e.s(["Err",()=>ee,"Ok",()=>Z,"get",()=>en,"isError",()=>et],885505)},986194,e=>{"use strict";var t=e.i(721281),n=e.i(878420),r=e.i(119468);function i(e){if(!e.$kind)throw Error("Object has an empty or undefined $kind property");if(!Object.prototype.hasOwnProperty.call(e,e.$kind))throw Error("Object has a $kind property that does not match the object");return e[e.$kind]}function o(e){var t=i(e);if((void 0===t?"undefined":(0,r._)(t))!=="object"||null===t)throw Error("Contents is not an object");if("$kind"in t)throw Error("Contents has an unexpected $kind property");return(0,n._)({$kind:e.$kind},t)}function a(e,n){return(0,t._)({$kind:e},e,n)}function s(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e&&n.includes(e.$kind)}e.s(["isKind",()=>s,"unkind",()=>i,"unwrapKind",()=>o,"withKind",()=>a])},353838,e=>{"use strict";var t=e.i(346715),n=e.i(131141),r=e.i(986194),i=e.i(188507),o={messageEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))},updateProposedFileChange:function(e,t){if((0,r.isKind)(e.extraActions,"proposedFileChanges")){var n=(0,r.unkind)(e.extraActions).changes,i=t.Update,o=t.Replacement;if(null!=i){var a=i.update,s=a.filePath,p=a.content,l=a.changeSummary,u=a.messageContentsOffset,c=a.state,d=n.find(function(e){return e.filePath===s});null!=d&&(d.content+=p,d.state=c,d.messageContentsOffset=u,l&&(d.changeSummary=l))}else if(null!=o){var y=o.replacement,f=y.filePath,T=y.content,h=y.changeSummary,g=y.state,v=y.messageContentsOffset,m=n.find(function(e){return e.filePath===f});null!=m&&(m.content=T,m.state=g,m.messageContentsOffset=v,h&&(m.changeSummary=h))}}},addProposedFileChange:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")||(e.extraActions=(0,r.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""})),e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.changes.push(t.change)},addProposedFileChangesMetadata:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.summary=t.summary)},addProposedShellCommand:function(e,t){e.assistantProposedActions.shellCommands.push(t.command)},addProposedPackageInstall:function(e,t){e.assistantProposedActions.packageInstalls.push(t.packageInstalls)},addProposedWorkspaceToolNudge:function(e,t){e.assistantProposedActions.workspaceToolNudges.push(t.nudge)},addProposedActionsMetadata:function(e,t){t.commitId&&(e.assistantProposedActions.commitId=t.commitId),t.summary&&(e.assistantProposedActions.summary=t.summary),void 0!==t.didCreateCheckpoint&&(e.assistantProposedActions.didCreateCheckpoint=t.didCreateCheckpoint),t.didCountEditRequest&&(e.assistantProposedActions.didCountEditRequest=!0),(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.summary=t.summary)},addProposedRunConfiguration:function(e,t){e.assistantProposedActions.runConfigurations.push(t.runConfiguration)},addProposedDeploymentConfiguration:function(e,t){e.assistantProposedActions.deploymentConfigurations.push(t.deploymentConfiguration)},addProposedWorkflowConfiguration:function(e,t){e.assistantProposedActions.workflowConfigurations.push(t.workflowConfiguration)},updateAttachedFormStringFieldAppend:function(e,t){a(e,t,!0)},updateAttachedFormStringFieldSet:function(e,t){a(e,t,!1)},addRagContext:function(e,t){e.ragContext=t.newContext}},inlineActionEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))}},localShellExecutionEventContents:{localShellExecutionEventSet:function(e,t){return t.contents}},shellSuggestionEventContents:{shellSuggestionContentsUpdate:function(e,t){e.content+=t.content}},byoPromptEventContents:{byoPromptResultUpdate:function(e,t){e.jsonResult=t.jsonResult}},agentTimelineEventContents:{agentTimelineEventSet:function(e,t){return t.contents},agentTimelineEventCreateFileAddContent:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="createFileData"&&(e.toolData.createFileData.content+=t.content)},updateRevertStatus:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="revertData"&&(e.toolData.revertData.status=t.newStatus)},appendTimelineMessageContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="messageData"&&(e.toolData.messageData.content+=t.content)},appendThoughtContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.thoughts+=t.content,e.toolData.thoughts.totalTimeTakenMs=t.totalTimeTakenMs)},newThoughtSummaryUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.summary=t.summary)},appendRedactedThoughtsMarker:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&e.toolData.thoughts.redactedThoughtsMarkers.push(t.marker)},upsertGeneratedMediaData:function(e,t){if((null==(n=e.toolData)?void 0:n.$kind)==="generateMediaData"){var n,r=e.toolData.generateMediaData.media,i=r.findIndex(function(e){return e.id===t.media.id});-1!==i?r[i]=t.media:r.push(t.media)}},subagentReportResultUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="subagentReportResultData"&&(e.toolData.subagentReportResultData.result+=t.delta)}},hostingDebugSummaryEventContents:{hostingDebugSummaryEventSet:function(e,t){return t.contents}},agentAskUserForActionRequest:{agentAskUserForActionRequestSet:function(e,t){return t.request}},integrationTestEventContents:{integrationTestEventContents:function(e,t){e.expectedResponseString+=t.content}},agentPlanEventContents:{addDesignReferenceFile:function(e,t){e.designReferenceFilePaths.push(t.filePath)},updatePlanContents:function(e,t){t.step&&(e.step=t.step),t.planId&&(e.planId=t.planId),t.objective&&t.objective.description&&(e.objective=t.objective),t.initialCommitId&&(e.initialCommitId=t.initialCommitId),void 0!==t.stackBlueprint&&t.stackBlueprint!==i.StackBlueprint.STACK_BLUEPRINT_NONE&&(e.stackBlueprint=t.stackBlueprint),void 0!==t.agentStackTriggerType&&t.agentStackTriggerType!==i.AgentStackTriggerType.UNKNOWN_TRIGGER_TYPE&&(e.agentStackTriggerType=t.agentStackTriggerType)}},subagentRunning:{subagentRunningDataUpdate:function(e,t){if(t.state){e.subagentId=t.state.subagentId,e.childSessionId=t.state.childSessionId,e.contents=t.state.contents;var n,r,i=Math.max(null!=(n=t.totalExecutionTimeSeconds)?n:0,null!=(r=t.state.totalExecutionTimeSeconds)?r:0);i>0&&(e.totalExecutionTimeSeconds=i)}}},uiTestingSubagentExecutionEventContents:{uiTestingSubagentExecutionEventUpdate:function(e,t){e.gcsDownloadUrl=t.state.gcsDownloadUrl,e.mimeType=t.state.mimeType,e.narration=t.state.narration,e.miniNarration=t.state.miniNarration}}};function a(e,t,n){if((null==(r=e.attachedForm)?void 0:r.formType)&&e.attachedForm.formType!==i.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN){var r,o,a=e.attachedForm.fields.find(function(e){return e.path===t.path});a||(a={path:t.path,formType:{$kind:"string",string:{value:""}}},e.attachedForm.fields.push(a)),(null==(o=a.formType)?void 0:o.$kind)==="string"&&(a.formType.string.value=n?a.formType.string.value+t.value:t.value)}}function s(e,t){var n=new Set,i=!0,a=!1,s=void 0;try{for(var p,l=t[Symbol.iterator]();!(i=(p=l.next()).done);i=!0){var u,c,d=p.value;if(!(!d.operation||n.has(d.id))){n.add(d.id);var y=null==(c=o[e.$kind])||null==(u=c[d.operation.$kind])?void 0:u.call(c,(0,r.unkind)(e),(0,r.unkind)(d.operation));y&&(e[e.$kind]=y)}}}catch(e){a=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}}function p(e){e.contents.contents&&e.typedUpdateEventOperations.length&&(s(e.contents.contents,e.typedUpdateEventOperations),e.typedUpdateEventOperations=[])}function l(e,t){var r=null;if(t.state!==e.state&&(null!=r||(r=Object.assign({},e)),r.state=t.state),(t.error.type!==e.error.type||t.error.message!==e.error.message)&&(null!=r||(r=Object.assign({},e)),r.error=t.error),!t.typedOperations.length||!e.contents.contents)return null!=r?r:e;var i=(0,n.createDraft)(e.contents.contents);s(i,t.typedOperations);var o=(0,n.finishDraft)(i);return o!==e.contents.contents&&(null!=r||(r=Object.assign({},e)),r.contents={benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o}),null!=r?r:e}e.s(["applyEventOperations",()=>p,"applyEventUpdateMessage",()=>l])},910951,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(188507),i=e.i(878420),o=e.i(986194),a=e.i(119468),s=e.i(15053);function p(e){return(void 0===e?"undefined":(0,a._)(e))==="object"?e:"string"==typeof e?{type:r.ModelType.OVERRIDE,overrideModelName:e}:{type:e,overrideModelName:""}}var l=(0,n.freeze)(t.Value.Create(r.EventSchema),!0);function u(e){var t=e.session,n=e.parent,i=e.sender,o=e.contents,a=e.context,p=e.benchmark,u=(0,s.v4)(),c=new Date,d="localShellExecutionEventContents"===o.$kind?r.EventState.IN_PROGRESS:r.EventState.COMPLETE,y={type:r.EventErrorType.EVENT_ERROR_TYPE_UNKNOWN,message:"",shortMessage:""},f=Object.assign({},l);return f.id=u,f.parentEventId=n,f.sessionId=t,f.created=c,f.updated=c,f.state=d,f.error=y,f.sender=i,f.contents={benchmarkParameters:null!=p?p:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o},f.context={metadata:a||void 0},f}var c={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionRequestSchema),!0)},d={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionResponseSchema),!0)},y={contents:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContextSchema),!0)},f={contents:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContextSchema),!0)},T={contents:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContextSchema),!0)},h={contents:(0,n.freeze)(t.Value.Create(r.InlineActionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.InlineActionEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0)},g=e.i(64386),v=e.i(886513),m={applied:(0,n.freeze)(t.Value.Create(r.IterativeAgentAppliedFileChangesSchema),!0),reverted:(0,n.freeze)(t.Value.Create(r.IterativeAgentRevertedFileChangesSchema),!0),contents:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContextSchema),!0)},S={contents:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContextSchema),!0)},E={contents:(0,n.freeze)(t.Value.Create(r.MessageEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.MessageEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0),proposedFileChanges:(0,n.freeze)((0,o.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""}),!0)},b={contents:(0,n.freeze)(t.Value.Create(r.RevertEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.RevertEventContextSchema),!0)},R={contents:(0,n.freeze)(t.Value.Create(r.SetupImportedProjectEventContentsSchema),!0)},I={contents:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContextSchema),!0)},C={contents:(0,n.freeze)(t.Value.Create(r.StepTooComplexEventContentsSchema),!0)},O={contents:(0,n.freeze)(t.Value.Create(r.TranslateEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.TranslateEventContextSchema),!0)},A={contents:(0,n.freeze)(t.Value.Create(r.TriggerCheckpointEventContentsSchema),!0)},_=(0,n.freeze)(t.Value.Create(r.CreateEventRequestSchema),!0);function k(e){var t=function(e){var t,n,a,s,l,_,k,U,w,N,D,P,M,x,j,L,B,F,G,q,V,$,W,z,H,K,Y,Q,X,J,Z,ee,et,en,er,ei,eo,ea,es,ep,el,eu,ec,ed,ey,ef,eT,eh,eg,ev,em,eS,eE,eb,eR,eI,eC,eO,eA,e_,ek,eU,ew,eN,eD,eP,eM,ex,ej,eL,eB,eF,eG,eq,eV,e$,eW,ez=e.session,eH=e.parent,eK=e.sender,eY=e.model,eQ=e.data,eX=e.benchmark;"type"in eK||(eK={id:eK.id.toString(),type:r.UserType.USER,isTeam:!1,roles:[],membership:eK.membership,orgId:"",username:"",timeCreated:eK.timeCreated,flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1});var eJ=(0,i._)({session:ez,parent:eH,sender:eK,model:eY,benchmark:eX},eQ);switch(eJ.kind){case"agentPlan":return(t=Object.assign({},y.contents)).planId=eJ.planId,t.objective=eJ.objective,t.step=eJ.step,t.stackBlueprint=eJ.stackBlueprint,t.requiresApproval=eJ.requiresApproval,t.Approver=eJ.approved?(0,o.withKind)("approver",eJ.sender):void 0,eJ.approvedDesignReferenceFilePath&&(t.approvedDesignReferenceFilePath=eJ.approvedDesignReferenceFilePath),eJ.agentStackTriggerType&&(t.agentStackTriggerType=eJ.agentStackTriggerType),u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentPlanEventContents",t),context:(0,o.withKind)("agentPlanEventContext",y.context)});case"approvePlan":return(a=Object.assign({},f.contents)).planEventId=eJ.planEventId,a.approver=eJ.approver,a.initialBuildMode=eJ.initialBuildMode,a.userSecretsResponse=null!=(n=eJ.userSecretsResponse)?n:{providedSecrets:[]},a.agentConfig=eJ.agentConfig,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("approvePlanEventContents",a),context:null});case"byoPrompt":return s=Object.assign({},T.contents),l=Object.assign({},T.context),_=p(eJ.model),s.messages=eJ.messages,s.parameters=eJ.parameters,s.forceJson=!1,l.modelSelector=_,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("byoPromptEventContents",s),context:(0,o.withKind)("byoPromptEventContext",l)});case"inlineAction":return D=Object.assign({},h.contents),P=Object.assign({},h.context),M=p(eJ.model),D.content=eJ.message,D.messageType=eJ.messageType,D.codeReference=null!=(k=eJ.codeReference)?k:h.reference,D.usedModelSelector=M,P.mostRecentFile=null!=(U=eJ.mostRecentFile)?U:"",P.fileContext=null!=(w=eJ.fileContext)?w:[],P.modelSelector=M,P.useRag=null!=(N=eJ.useRag)&&N,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("inlineActionEventContents",D),context:(0,o.withKind)("inlineActionEventContext",P)});case"iterativeAgent":return function(e){var t=Object.assign({},m.contents);if("appliedChanges"in e.action){var n=Object.assign({},m.applied);n.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,n.appliedChanges=e.action.appliedChanges,n.commitHash=e.action.commitHash,t.contents=(0,o.withKind)("appliedFileChanges",n)}else if("revertedChanges"in e.action){var r=Object.assign({},m.reverted);r.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,r.eventWhichAppliedChanges=e.action.eventIdWhichAppliedChanges,r.revertedChanges=e.action.revertedChanges,t.contents=(0,o.withKind)("revertedFileChanges",r)}else if("eventIdWhichProposedPackageInstall"in e.action)if("installationOutput"in e.action){var a=e.action,s=a.eventIdWhichProposedPackageInstall,p=(0,v._)(a,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installedPackages",(0,g._)((0,i._)({},p),{eventWhichProposedPackageInstall:s}))}else{var l=e.action,c=l.eventIdWhichProposedPackageInstall,d=(0,v._)(l,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installingPackages",(0,g._)((0,i._)({},d),{eventWhichProposedPackageInstall:c}))}else if("eventIdWhichProposedShellExecution"in e.action)if("commandOutput"in e.action){var y=e.action,f=y.eventIdWhichProposedShellExecution,T=(0,v._)(y,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("finishedShellExecution",(0,g._)((0,i._)({},T),{eventWhichProposedShellExecution:f}))}else{var h=e.action,S=h.eventIdWhichProposedShellExecution,E=(0,v._)(h,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("startedShellExecution",(0,g._)((0,i._)({},E),{eventWhichProposedShellExecution:S}))}else if("eventIdWhichProposedRunConfiguration"in e.action){var b=e.action,R=b.eventIdWhichProposedRunConfiguration,I=(0,v._)(b,["eventIdWhichProposedRunConfiguration"]);t.contents=(0,o.withKind)("appliedRunConfiguration",(0,g._)((0,i._)({},I),{eventWhichProposedRunConfiguration:R}))}else if("eventIdWhichProposedDeploymentConfiguration"in e.action){var C=e.action,O=C.eventIdWhichProposedDeploymentConfiguration,A=(0,v._)(C,["eventIdWhichProposedDeploymentConfiguration"]);t.contents=(0,o.withKind)("appliedDeploymentConfiguration",(0,g._)((0,i._)({},A),{eventWhichProposedDeploymentConfiguration:O}))}else if("eventIdWhichProposedWorkflowConfiguration"in e.action){var _=e.action,k=_.eventIdWhichProposedWorkflowConfiguration,U=(0,v._)(_,["eventIdWhichProposedWorkflowConfiguration"]);t.contents=(0,o.withKind)("appliedWorkflowConfiguration",(0,g._)((0,i._)({},U),{eventWhichProposedWorkflowConfiguration:k}))}return u({session:e.session,parent:e.parent,sender:e.sender,contents:(0,o.withKind)("iterativeAgentEventContents",t),context:(0,o.withKind)("iterativeAgentEventContext",m.context)})}(eJ);case"localShellExecution":return(x=Object.assign({},S.contents)).command=eJ.command,x.channelName=eJ.channelName,x.eventId=eJ.event,x.index=0,x.result="",x.exitCode=0,x.executed=!1,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("localShellExecutionEventContents",x),context:(0,o.withKind)("localShellExecutionEventContext",S.context)});case"message":return ew=Object.assign({},E.contents),eN=Object.assign({},E.context),eD=p(eJ.model),ew.content=eJ.message,ew.intent=eJ.intent,ew.media=null!=(Y=eJ.media)?Y:[],ew.codeReference=null!=(Q=eJ.codeReference)?Q:E.reference,ew.usedModelSelector=eD,ew.sources=null!=(X=eJ.sources)?X:[],ew.extraActions=null!=(J=eJ.extraActions)?J:E.proposedFileChanges,ew.agentAction=null!=(Z=eJ.agentAction)?Z:{},ew.uploadedFiles=null!=(ee=eJ.uploadedFiles)?ee:[],ew.attachedUrls=null!=(et=eJ.attachedUrls)?et:[],eJ.requestedStackBlueprint&&(ew.requestedStackBlueprint=eJ.requestedStackBlueprint),eJ.agentStackTriggerType&&(ew.agentStackTriggerType=eJ.agentStackTriggerType),ew.customStackReplId=null!=(en=eJ.customStackReplId)?en:"",ew.themeConfig=null!=(er=eJ.themeConfig)?er:"",ew.attachedForm=null!=(ei=eJ.attachedForm)?ei:{formType:r.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN,fields:[]},ew.enableDeepThinking=null!=(eo=eJ.enableDeepThinking)&&eo,eN.intent=eJ.intent,eN.mostRecentFile=null!=(ea=eJ.mostRecentFile)?ea:"",eN.fileContext=null!=(es=eJ.fileContext)?es:[],eN.modelSelector=eD,eN.useRag=null!=(ep=eJ.useRag)&&ep,eN.extraResources=null!=(el=eJ.extraResources)?el:[],eN.messageSource=null!=(eu=eJ.messageSource)?eu:r.MessageSource.MESSAGE_SOURCE_REPLIT_UI,eN.agentConfig={maxSteps:0,modelProfile:null!=(ec=null==(j=eJ.agentConfig)?void 0:j.modelProfile)?ec:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:null==(L=eJ.agentConfig)?void 0:L.thinkingEnabled,enableAutomatedTesting:null==(B=eJ.agentConfig)?void 0:B.enableAutomatedTesting,samplingRate:null!=(ed=null==(F=eJ.agentConfig)?void 0:F.samplingRate)?ed:0,webSearchEnabled:null!=(ey=null==(G=eJ.agentConfig)?void 0:G.webSearchEnabled)&&ey,imageGenerationEnabled:null!=(ef=null==(q=eJ.agentConfig)?void 0:q.imageGenerationEnabled)&&ef,agentMode:null!=(eT=null==(V=eJ.agentConfig)?void 0:V.agentMode)?eT:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(eh=null==($=eJ.agentConfig)?void 0:$.initialBuildMode)?eh:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(eg=null==(W=eJ.agentConfig)?void 0:W.maxAutonomyEnabled)&&eg,autonomyLevel:null!=(ev=null==(z=eJ.agentConfig)?void 0:z.autonomyLevel)?ev:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:null!=(em=null==(H=eJ.agentConfig)?void 0:H.agentInitialBuildTier)?em:r.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:null==(K=eJ.agentConfig)?void 0:K.workspaceLessMode},eJ.webviewTargetedElement&&(ew.targetedElement=eJ.webviewTargetedElement),void 0!==eJ.quickEdit&&(ew.quickEdit=eJ.quickEdit),eJ.agentConfig&&(ew.agentConfig={maxSteps:0,modelProfile:null!=(eb=eJ.agentConfig.modelProfile)?eb:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:eJ.agentConfig.thinkingEnabled,enableAutomatedTesting:eJ.agentConfig.enableAutomatedTesting,samplingRate:null!=(eR=eJ.agentConfig.samplingRate)?eR:0,webSearchEnabled:null!=(eI=null==(eS=eJ.agentConfig)?void 0:eS.webSearchEnabled)&&eI,imageGenerationEnabled:null!=(eC=null==(eE=eJ.agentConfig)?void 0:eE.imageGenerationEnabled)&&eC,agentMode:null!=(eO=eJ.agentConfig.agentMode)?eO:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(eA=eJ.agentConfig.initialBuildMode)?eA:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(e_=eJ.agentConfig.maxAutonomyEnabled)&&e_,autonomyLevel:null!=(ek=eJ.agentConfig.autonomyLevel)?ek:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:null!=(eU=eJ.agentConfig.agentInitialBuildTier)?eU:r.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:eJ.agentConfig.workspaceLessMode}),u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("messageEventContents",ew),context:(0,o.withKind)("messageEventContext",eN)});case"revert":return(eP=Object.assign({},b.contents)).eventIdBeforeRevert=eJ.eventIdBeforeRevert,eP.commitId=eJ.commitHash,eP.message=eJ.commitMessage,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("revertEventContents",eP),context:(0,o.withKind)("revertEventContext",b.context)});case"shellSuggestion":return eM=Object.assign({},I.contents),ex=Object.assign({},I.context),ej=p(eJ.model),eM.content=eJ.message,ex.modelSelector=ej,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("shellSuggestionEventContents",eM),context:(0,o.withKind)("shellSuggestionEventContext",ex)});case"translate":return(eL=Object.assign({},O.contents)).content=eJ.content,eL.inputTarget=eJ.inputTarget,eL.outputTarget=eJ.outputTarget,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("translateEventContents",eL),context:(0,o.withKind)("translateEventContext",O.context)});case"stepTooComplex":return(eB=Object.assign({},C.contents)).state=eJ.state,eB.stepId=eJ.stepId,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("stepTooComplexEventContents",eB),context:null});case"agentAskUserForActionResponse":return(eF=Object.assign({},d.contents)).response=eJ.response,eF.requestEventId=eJ.requestEventId,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentAskUserForActionResponse",eF),context:null});case"agentAskUserForActionRequest":return(eG=Object.assign({},c.contents)).request=eJ.request,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentAskUserForActionRequest",eG),context:null});case"requestFeatureAdd":return u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:{$kind:"requestFeatureAddData",requestFeatureAddData:{type:eJ.feature}},context:null});case"triggerCheckpoint":return(e$=Object.assign({},A.contents)).description=eJ.description,e$.onlyIfDiff=null!=(eq=eJ.onlyIfDiff)&&eq,e$.author=null!=(eV=eJ.author)?eV:r.CommitAuthor.COMMIT_AUTHOR_AGENT,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("triggerCheckpointEventContents",e$),context:null});case"setupImportedProject":return(eW=Object.assign({},R.contents)).importSource=eJ.importSource,eW.agentConfig=eJ.agentConfig,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("setupImportedProjectEventContents",eW),context:null})}}(e),n=Object.assign({},_);return n.addToChild=e.addToChild,n.state=t.state,n.sessionId=t.sessionId,n.parentEventId=t.parentEventId,n.eventId=t.id,n.context=t.context,n.contents=t.contents,{event:t,request:n}}e.s(["createEventRequest",()=>k],910951)},590225,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(188507),i=(0,n.freeze)(t.Value.Create(r.UpdateEventMessageSchema),!0);function o(e){var t,n,o=Object.assign({},i);return o.eventId=e.id,o.state=null!=(t=e.state)?t:r.EventState.COMPLETE,o.typedOperations=null!=(n=e.typedOperations)?n:[],o}e.s(["createUpdateEventRequest",()=>o])},576106,e=>{"use strict";var t=e.i(862927),n=e.i(131141);e.i(660670);var r=e.i(957410),i=e.i(986194),o=e.i(188507),a={session:(0,n.freeze)(t.Value.Create(o.SessionSchema),!0),data:(0,n.freeze)(t.Value.Create(r.SessionDataSchema),!0),create:(0,n.freeze)(t.Value.Create(o.CreateSessionRequestSchema),!0),update:(0,n.freeze)(t.Value.Create(o.UpdateSessionRequestSchema),!0)};function s(e){var t,n=Object.assign({},a.create);return n.title=null!=(t=e.title)?t:"",n.sessionType=e.sessionType,n.replId=e.replId,n.SeededAiFirstEventContents=e.seededEvent?(0,i.withKind)("seededAiFirstEventContents",{benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:e.seededEvent}):void 0,e.taskId&&(n.taskId=e.taskId),n}function p(e,t){var r=(0,n.produce)(e,function(e){var n,r,i,o,a;e.title=null!=(n=t.title)?n:e.title,e.sessionType=null!=(r=t.sessionType)?r:e.sessionType,e.archived=null!=(i=t.archived)?i:e.archived,e.readOnly=null!=(o=t.readOnly)?o:e.readOnly,e.taskId=null!=(a=t.taskId)?a:e.taskId}),i=Object.assign({},a.update);return i.id=r.id,i.title=r.title,i.sessionType=r.sessionType,i.replId=r.replId,i.activeEventId=r.activeEventId,void 0!==t.archived&&r.archived!==e.archived&&(i.archived=r.archived),void 0!==t.readOnly&&r.readOnly!==e.readOnly&&(i.readOnly=r.readOnly),void 0!==t.taskId&&r.taskId!==e.taskId&&(i.taskId=r.taskId),void 0!==t.isActiveAgentSession&&(i.isActiveAgentSession=t.isActiveAgentSession,r===e&&(r=Object.assign({},r))),{session:r,request:i}}function l(e){var t=Object.assign({},a.session),n=new Date;return t.id=e.sessionId,t.title=e.title,t.sessionType=e.sessionType,t.replId=e.replId,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=!!e.archived,t.taskId=e.taskId,t.lastEventTime=n,t.created=n,t.updated=n,t.revertedToSessionId=e.revertedToSessionId,t.revertedToEventId=e.revertedToEventId,t}function u(e,t){return(0,n.produce)(e,function(e){var n,r;e.title=t.title,e.sessionType=t.sessionType,e.archived=null!=(n=t.archived)?n:e.archived,e.activeEventId=t.activeEventId,e.readOnly=null!=(r=t.readOnly)?r:e.readOnly})}function c(e,t){var n=Object.assign({},a.session);return n.id=t.id,n.title=t.title,n.sessionType=t.sessionType,n.replId=e,n.sessionCreationEventId=t.sessionCreationEventId,n.archived=t.archived,n.lastEventTime=t.created,n.created=t.created,n.updated=t.updated,n.readOnly=t.readOnly,n.taskId=t.taskId,n}function d(e){var t=Object.assign({},a.data);return t.id=e.id,t.title=e.title,t.sessionType=e.sessionType,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=e.archived,t.readOnly=e.readOnly,t.taskId=e.taskId,t.created=e.created,t.updated=e.updated,t}e.s(["applySessionUpdateMessage",()=>u,"compatDataToSession",()=>c,"compatSessionToData",()=>d,"createSessionFromCreateSessionMessage",()=>l,"createSessionRequest",()=>s,"createUpdateSessionRequest",()=>p])},877212,51553,204203,970187,765695,334712,545525,145864,165680,805763,e=>{"use strict";e.i(267710),e.i(439725);var t=e.i(530658),n=e.i(276385),r=e.i(389959),i=e.i(971131),o=e.i(906368),a=e.i(541793),s=e.i(188507),p=e.i(644464),l=e.i(952098),u=e.i(600637),c=e.i(924908),d=e.i(904851),y=e.i(90659),f=e.i(721281),T=e.i(297083),h=e.i(817556);e.i(242933);var g=e.i(424360),v=e.i(885505),m=e.i(394212),S=e.i(119468),E=e.i(281128);e.i(660670);var b=e.i(813702),R=e.i(353838),I=e.i(910951),C=e.i(590225),O=e.i(576106),A=e.i(986194);function _(e){return{state:e.runState,reason:e.transitionReason.reasons?(0,A.unwrapKind)(e.transitionReason.reasons):null}}var k=function(){function e(t,n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"active",new g.Multicast(function(e){return r.api.currentAgentSession.select(function(e){return!!e&&e.id===r.session.id}).subscribe(e)})),(0,f._)(this,"state",new g.Multicast(function(e){var t=null,n=null,i=!1,o=r.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){return e.next(t)},update:function(e){var n=!1;if("agent-state-modified"===e.kind&&e.session===r.session.id&&(t=e.state,n=!0),e.optimistic||l(),n)return!0}}),a=function(){return(0,T._)(function(){var r,a,s,p;return(0,h._)(this,function(u){switch(u.label){case 0:n=null,i=!0,u.label=1;case 1:return u.trys.push([1,,3,4]),[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(r=u.sent(),(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];return(a=_(r.payload)).state!==(null==t?void 0:t.state)&&(null==(s=(p=this.api.logger).warn)||s.call(p,"state transition was manually corrected"),t=a,o.commit(),e.next(t)),[3,4];case 3:return i=!1,l(),[7];case 4:return[2]}})}).call(r)},p=function(){null!==n&&(clearTimeout(n),n=null)},l=function(){p(),i||(null==t?void 0:t.state)!==s.AgentRunState.AGENT_STATE_RUNNING||(n=setTimeout(a,1e4))},u=r.api.connected.lift(e,function(n){return(0,T._)(function(){var r,i;return(0,h._)(this,function(a){switch(a.label){case 0:return[4,(0,v.get)(this.active)];case 1:if(r=a.sent(),n.aborted||(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];if(!r.payload)return t=null,o.commit(),e.next(t),[2];return[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(i=a.sent(),n.aborted||(0,v.isError)(i,"UNEXPECTED_DISCONNECT"))return[2];if(!i.ok)return[2,this.api.error(i,e)];return t=_(i.payload),o.commit(),e.next(t),l(),[2]}})}).call(r)});return function(){p(),o.unsubscribe(),u.unsubscribe()}})),this.api=t,this.session=n}return(0,y._)(e,[{key:"update",value:function(e){return(0,T._)(function(){var n,r,i,o,a,s;return(0,h._)(this,function(p){switch(p.label){case 0:return[4,(0,v.get)(this.state)];case 1:if(!(n=p.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("session is not an agent session")];if(r=(0,E.create)(n.payload,function(t){t.state=e}),n.payload===r)return[2,(0,v.Ok)(n.payload)];return o=(i=(0,t._)(this.api.state.stage({kind:"agent-state-modified",session:this.session.id,state:{state:e,reason:null}}),2))[0],a=i[1],[4,this.api.service.updateAgentState.rpc({replId:this.api.replId,sessionId:this.session.id,runState:e,transitionReason:{}})];case 2:if(!(s=p.sent()).ok)return a(),[2,this.api.error(s)];if(s.payload.runState!==e)return a(),[2,(0,v.Ok)(_(s.payload))];return this.api.hooks.trigger("client-updated-agent-state",{session:this.session,prev:n.payload,next:r}),o(),[2,(0,v.Ok)(r)]}})}).call(this)}},{key:"warmup",value:function(){return(0,T._)(function(){var t,n,r,i,o;return(0,h._)(this,function(a){switch(a.label){case 0:if((t=e.lastWarmTimeMap.get(this.api))||(t=new Map,e.lastWarmTimeMap.set(this.api,t)),n=Date.now(),(r=t.get(this.session.id))&&n-r<24e4)return[2,(0,v.Ok)(null)];return[4,(0,v.get)(this.state)];case 1:if(!(i=a.sent()).ok)return[2,this.api.error(i)];if(!i.payload)return[2,this.api.error("session is not an agent session")];if(i.payload.state===s.AgentRunState.AGENT_STATE_RUNNING||i.payload.state===s.AgentRunState.AGENT_STATE_PAUSING)return[2,(0,v.Ok)(null)];return t.set(this.session.id,n),[4,this.api.service.warmAgent.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(!(o=a.sent()).ok)return[2,this.api.error(o)];return[2,(0,v.Ok)(null)]}})}).call(this)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({sessionId:this.session.id,start:e})}}]),e}();(0,f._)(k,"lastWarmTimeMap",new WeakMap);var U=e.i(399119),w=e.i(445789),N=e.i(279606),D=function(){function e(n){if((0,d._)(this,e),(0,f._)(this,"forward",new Map),(0,f._)(this,"reverse",new Map),n){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=(0,t._)(a.value,2),l=p[0],u=p[1];this.set(l,u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}return(0,y._)(e,[{key:"size",get:function(){return this.forward.size}},{key:"keys",value:function(){return this.forward.keys()}},{key:"values",value:function(){return this.reverse.keys()}},{key:"entries",value:function(){return this.forward.entries()}},{key:"hasKey",value:function(e){return this.forward.has(e)}},{key:"hasValue",value:function(e){return this.reverse.has(e)}},{key:"getValue",value:function(e){var t=this.forward.get(e);if(void 0===t)throw Error("key does not exist");return t}},{key:"getKey",value:function(e){var t=this.reverse.get(e);if(void 0===t)throw Error("value does not exist");return t}},{key:"set",value:function(e,t){var n=this.reverse.get(t),r=this.forward.get(e);this.forward.set(e,t),this.reverse.set(t,e),void 0!==n&&n!==e&&this.forward.delete(n),void 0!==r&&r!==t&&this.reverse.delete(r)}},{key:"deleteKey",value:function(e){var t=this.forward.get(e);void 0!==t&&(this.forward.delete(e),this.reverse.delete(t))}},{key:"deleteValue",value:function(e){var t=this.reverse.get(e);void 0!==t&&(this.reverse.delete(e),this.forward.delete(t))}},{key:"clear",value:function(){this.forward.clear(),this.reverse.clear()}},{key:Symbol.iterator,value:function(){return this.forward.entries()}}]),e}(),P=function(){function e(t){if((0,d._)(this,e),(0,f._)(this,"map",new D),(0,f._)(this,"offset",0),(0,f._)(this,"length",0),t){for(var n=0;n<t.length;n++)this.map.set(n,t[n]);this.length=t.length}}return(0,y._)(e,[{key:"first",get:function(){return this.length?this.map.getValue(0+this.offset):null}},{key:"last",get:function(){return this.length?this.map.getValue(this.map.size-1+this.offset):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"has",value:function(e){return"number"==typeof e?this.map.hasKey(e-this.offset):this.map.hasValue(e)}},{key:"index",value:function(e){return this.map.getKey(e)-this.offset}},{key:"id",value:function(e){return this.map.getValue(e+this.offset)}},{key:"dir",value:function(e,t){var n=this.map.getKey(e),r=this.map.getKey(t);return n<r?1:n>r?-1:0}},{key:"append",value:function(e){for(var t=0;t<e.length;t++)this.map.set(this.map.size+this.offset,e[t]);this.length=this.map.size}},{key:"prepend",value:function(e){for(var t=e.length-1;t>=0;t--)this.offset--,this.map.set(0+this.offset,e[t]);this.length=this.map.size}},{key:"pop",value:function(){if(!this.last)return null;var e=this.last;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset:0,e}},{key:"shift",value:function(){if(!this.first)return null;var e=this.first;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset+1:0,e}},{key:"parent",value:function(e){var t=this.map.getKey(e);return t!==0+this.offset?this.map.getValue(t-1):null}},{key:"child",value:function(e){var t=this.map.getKey(e);return t!==this.map.size-1+this.offset?this.map.getValue(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;if(0===this.length)return[];var r=0+this.offset,i=this.map.size-1+this.offset,o="number"==typeof t?Math.min(Math.max(t+this.offset,r),i):this.map.getKey(t),a="number"==typeof n?Math.max(Math.min(n+this.offset,i),r):this.map.getKey(n),s=o>a;s&&(o=(e=[a,o])[0],a=e[1]);for(var p=[],l=o;l<=a;l++)p.push(this.map.getValue(l));return s?p.reverse():p}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.last;if(t&&!e.has(t)||n&&!e.has(n))throw Error("invalid merge");if(!t||!n){if(this.map.size){var r=Array.from(this.map.values());return this.clear(),{removed:r,added:[]}}return null}var i=e.slice(t,n),o=new Set(this.map.values()),a=new Set(o),s=new Set(i),p=!0,l=!1,u=void 0;try{for(var c,d=i[Symbol.iterator]();!(p=(c=d.next()).done);p=!0){var y=c.value;a.delete(y)}}catch(e){l=!0,u=e}finally{try{p||null==d.return||d.return()}finally{if(l)throw u}}var f=!0,T=!1,h=void 0;try{for(var g,v=o[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var m=g.value;s.delete(m)}}catch(e){T=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(T)throw h}}return a.size||s.size?(this.clear(),this.append(i),{removed:Array.from(a),added:Array.from(s)}):null}},{key:"clear",value:function(){this.map.clear(),this.offset=0,this.length=0}},{key:"clone",value:function(){var t=new e;return t.map=new D(this.map),t.offset=this.offset,t.length=this.length,t}}]),e}(),M=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"ids",new P),(0,f._)(this,"events",new Map),(0,f._)(this,"incomplete",new Set),(0,f._)(this,"length",0),t&&this.append(t)}return(0,y._)(e,[{key:"set",value:function(e){this.events.set(e.id,e),e.state!==s.EventState.COMPLETE?this.incomplete.add(e.id):this.incomplete.delete(e.id)}},{key:"delete",value:function(e){this.events.delete(e),this.incomplete.delete(e)}},{key:"first",get:function(){return this.ids.first?this.get(this.ids.first):null}},{key:"last",get:function(){return this.ids.last?this.get(this.ids.last):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"index",value:function(e){return this.ids.index(e)}},{key:"id",value:function(e){return this.ids.id(e)}},{key:"dir",value:function(e,t){return this.ids.dir(e,t)}},{key:"has",value:function(e){return this.ids.has(e)}},{key:"get",value:function(e){e="number"==typeof e?this.id(e):e;var t=this.events.get(e);if(!t)throw Error("event does not exist");return t}},{key:"append",value:function(e){this.ids.append(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"prepend",value:function(e){this.ids.prepend(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"pop",value:function(){var e,t=this.ids.pop(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for popped event");return t&&n&&(this.delete(t),this.length--),n}},{key:"shift",value:function(){var e,t=this.ids.shift(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for shifted event");return t&&n&&(this.delete(t),this.length--),n}},{key:"parent",value:function(e){var t=this.index(e);return t>0?this.get(t-1):null}},{key:"child",value:function(e){var t=this.index(e);return t<this.length-1?this.get(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;return this.ids.slice(t,n).map(function(t){return e.get(t)})}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.ids.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.ids.last,r=this.ids.patch(e.ids,t,n);this.length=this.ids.length;var i=!this.events.size,o=null,a=null;if(r){null!=o||(o={removed:[],added:[],changed:[]});var p=!0,l=!1,u=void 0;try{for(var c,d=r.removed[Symbol.iterator]();!(p=(c=d.next()).done);p=!0){var y=c.value;o.removed.push(this.get(y)),this.delete(y)}}catch(e){l=!0,u=e}finally{try{p||null==d.return||d.return()}finally{if(l)throw u}}var f=!0,T=!1,h=void 0;try{for(var g,v=r.added[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var m=g.value,S=e.get(m);o.added.push(S),this.set(S),i||(null!=a||(a=new Set),a.add(m))}}catch(e){T=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(T)throw h}}}if(i)return o;for(var E=new Set(this.incomplete),b=this.length-1;b>=0;b--){var R=this.ids.id(b);if(E.delete(R),null==a||!a.has(R)){var I=e.events.get(R);if(I&&I!==this.events.get(R)){null!=o||(o={removed:[],added:[],changed:[]}),o.changed.push(I),this.set(I);continue}if(!E.size&&I&&I.state===s.EventState.COMPLETE)break}}return o}},{key:"adopt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.first,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.last;if(!n||!r){if(!this.length)return null;var i=Array.from(this.events.values());return this.clear(),{removed:i,added:[],changed:[],missing:[]}}if(!(null==t?void 0:t.size)&&!this.length)return{removed:[],added:[],changed:[],missing:e.slice(n,r)};for(var o=[],a=[],s=null,p=null,l=e.index(n),u=e.index(r),c=u;c>=l;c--){var d=e.id(c);if(!(null==t?void 0:t.has(d))&&!this.events.has(d)){o.push(d),p&&!s&&(s=e.child(d));continue}if(null!=p||(p=d),s){o.push(d);continue}if((null==t?void 0:t.has(d))&&this.events.has(d)){var y=null==t?void 0:t.get(d);y&&this.events.get(d)!==y&&(a.push(y),this.set(y))}}if(!p&&!s){if(!this.length&&!o.length)return null;var f=Array.from(this.events.values());return this.clear(),{removed:f,added:[],changed:[],missing:o}}s||(s=n),p||(p=r);var T=this.ids.patch(e,s,p);if(this.length=this.ids.length,!T)return o.length||a.length?{removed:[],added:[],changed:a,missing:o}:null;var h=[],g=[],v=!0,m=!1,S=void 0;try{for(var E,b=T.removed[Symbol.iterator]();!(v=(E=b.next()).done);v=!0){var R=E.value;h.push(this.get(R)),this.delete(R)}}catch(e){m=!0,S=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw S}}var I=!0,C=!1,O=void 0;try{for(var A,_=T.added[Symbol.iterator]();!(I=(A=_.next()).done);I=!0){var k=A.value,U=null==t?void 0:t.get(k);if(!U)throw Error("unexpected null");g.push(U),this.set(U)}}catch(e){C=!0,O=e}finally{try{I||null==_.return||_.return()}finally{if(C)throw O}}return{removed:h,added:g,changed:a,missing:o}}},{key:"clear",value:function(){this.ids.clear(),this.events.clear(),this.incomplete.clear(),this.length=0}},{key:"clone",value:function(){var t=new e;return t.ids=this.ids.clone(),t.events=new Map(this.events),t.incomplete=new Set(this.incomplete),t}}]),e}(),x=Object.prototype.hasOwnProperty;function j(e,t,n){var r=!0,i=!1,o=void 0;try{for(var a,s=e.keys()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0)if(n=a.value,L(n,t))return n}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function L(e,t){var n,r,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&L(e[r],t[r]););return -1===r}if(n===Set){if(e.size!==t.size)return!1;var o=!0,a=!1,s=void 0;try{for(var p,l=e[Symbol.iterator]();!(o=(p=l.next()).done);o=!0)if((i=r=p.value)&&(void 0===i?"undefined":(0,S._)(i))==="object"&&!(i=j(t,i))||!t.has(i))return!1}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}return!0}if(n===Map){if(e.size!==t.size)return!1;var u=!0,c=!1,d=void 0;try{for(var y,f=e[Symbol.iterator]();!(u=(y=f.next()).done);u=!0)if((i=(r=y.value)[0])&&(void 0===i?"undefined":(0,S._)(i))==="object"&&!(i=j(t,i))||!L(r[1],t.get(i)))return!1}catch(e){c=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw d}}return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return -1===r}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return -1===r}if(!n||(void 0===e?"undefined":(0,S._)(e))==="object"){for(n in r=0,e)if(x.call(e,n)&&++r&&!x.call(t,n)||!(n in t)||!L(e[n],t[n]))return!1;return Object.keys(t).length===r}}return e!=e&&t!=t}var B=function(){function e(t){var n=t.api,r=t.session,i=t.direction,o=t.initial,a=t.transducer;if((0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"direction",void 0),(0,f._)(this,"initial",void 0),(0,f._)(this,"transducer",void 0),this.api=n,this.session=r,this.direction=i,this.initial=o,this.transducer=a,!(0,E.isDraftable)(o))throw Error("state must be draftable")}return(0,y._)(e,[{key:"compute",value:function(e,n,r){var i=(0,t._)((0,E.create)([n,void 0]),2),o=i[0],a=i[1];o[1]=this.transducer(e,o[0]);var s=a();return s[0]!==n&&r&&L(s[0],r)&&(s[0]=r),s}},{key:"step",value:function(e,n,r){var i=r.id,o=-this.direction,a=e.peek(o);a&&(a=i===a||r===a?a:e.adjacent(i,o)),a&&(a="string"!=typeof a?a.id:a);var s=i===a?this.initial:a&&n.get(a),p=n.get(i);if(!s)throw Error("starting state not found");var l=(0,t._)(this.compute(r,s,p),2),u=l[0],c=l[1],d=u!==s||!p||u!==p;return d&&n.set(i,u),{ret:c,recomputing:d}}},{key:"indexed",value:function(e,t){for(var n=this,r=Array(t.length),i=0;i<t.length;i++){var o=t[i],a="string"==typeof o?o:o.id;r[i]=e.index(a)}return r.sort(function(e,t){return(e-t)*n.direction}),r}}]),e}(),F=((ee=F||{})[ee.PEEK=10]="PEEK",ee[ee.SCAN=150]="SCAN",ee[ee.TRAVERSE=500]="TRAVERSE",ee),G=function(e){function t(e,n,r){var i,o;return(0,d._)(this,t),i=(0,U._)(this,t,[{api:e,session:n,direction:"forward"===r.direction?1:-1,initial:r.state,transducer:r.reducer}]),(0,f._)(i,"map",void 0),(0,f._)(i,"result",new g.Multicast(function(e){var t=new P,n=new Set,r=new Map,o=null,a=null,s=10,p=function(){if(!n.size)return!1;for(var e=i.indexed(t,Array.from(n)),o=e[0],p=!1;o>=0&&o<t.length;){var l=t.id(o),u=o===e[0];if(a&&a!==l&&t.dir(l,a)!==i.direction)break;var c=i.api.materializer.get(l);if(!c){if(n.add(l),p)switch(s){case 10:s=150;break;case 150:s=500}var d=Math.max(o+(s-1)*i.direction,0);u&&e.length>1&&(d=1===i.direction?Math.min(d,e[e.length-1]):Math.max(d,e[e.length-1]));var y=t.slice(o,d);return i.api.materializer.enqueue(i.session.id,y),!1}u&&(e.shift(),n.delete(l));var f=i.step(t,r,c),T=f.ret,h=f.recomputing;if(p||(p=u||h||!1===T),!1===T){a=c.id;break}if(c.id===a&&(a=null),h||e.length){o=h?o+i.direction:e[0];continue}break}return n.size||(s=10),p},l=function(){var n;if(t.length){var s=null!=a?a:t.peek(i.direction);n=s?r.get(s):void 0}else n=i.initial;if(void 0===n)throw Error("unexpected undefined");o!==n&&(o=n,e.next(i.map(n)))},u=i.api.state.register({snapshot:function(){return{ids:t.clone(),pending:new Set(n),states:new Map(r),stop:a,batchSize:s}},rollback:function(e){t=e.ids,n=e.pending,r=e.states,a=e.stop,s=e.batchSize},notify:function(){return l()},update:function(e){if("event-modified"===e.kind&&t.has(e.event.id))return n.add(e.event.id),p()}}),c=i.api.materializer.events.lift(e,function(e){e.filter(function(e){var t=e.id;return n.has(t)}).length&&p()&&l()}),d=i.session.ids.lift(e,function(e){var i=t.patch(e);if(i){var o=!0,s=!1,u=void 0;try{for(var c,d=i.removed[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var y=c.value;r.delete(y),n.delete(y),y===a&&(a=null)}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}var f=!0,T=!1,h=void 0;try{for(var g,v=i.added[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var m=g.value;n.add(m)}}catch(e){T=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(T)throw h}}p()&&l()}});return function(){u.unsubscribe(),c.unsubscribe(),d.unsubscribe()}})),(0,f._)(i,"subscribe",i.result.subscribe.bind(i.result)),i.map=null!=(o=r.map)?o:function(e){return e},i}return(0,w._)(t,e),(0,y._)(t,[{key:Symbol.observable,value:function(){return this.result}}]),t}(B),q=function(e){function n(e,r,i,o){var a,s;return(0,d._)(this,n),a=(0,U._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.reducer}]),(0,f._)(a,"window",void 0),(0,f._)(a,"map",void 0),(0,f._)(a,"exhaustive",new g.Multicast(function(e){return N.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,f._)(a,"result",new g.Multicast(function(e){var t=new M,n=null,r=null,i=new Map,o=new Set,s=function(){if(o.size)for(var s=a.indexed(t,Array.from(o)),p=s[0];p>=0&&p<t.length;){var l=t.get(p),u=l.id,c=p===s[0];if(r&&r!==u&&t.dir(u,r)!==a.direction)break;c&&(s.shift(),o.delete(l.id));var d=a.step(t,i,l),y=d.ret,f=d.recomputing;if(!1===y){r=l.id;break}if(u===r&&(r=null),f||s.length){p=f?p+a.direction:s[0];continue}break}if(t.length){var T,h,g=null!=r?r:null==(h=t.peek(a.direction))?void 0:h.id;T=g?i.get(g):void 0}else T=a.initial;if(void 0===T)throw Error("unexpected undefined");n!==T&&(n=T,e.next(a.map(T)))},p=a.window.events.lift(e,function(e){var n=t.patch(e);if(n){var a=!0,p=!1,l=void 0;try{for(var u,c=n.removed[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;i.delete(d.id),o.delete(d.id),d.id===r&&(r=null)}}catch(e){p=!0,l=e}finally{try{a||null==c.return||c.return()}finally{if(p)throw l}}var y=!0,f=!1,T=void 0;try{for(var h,g=n.added[Symbol.iterator]();!(y=(h=g.next()).done);y=!0){var v=h.value;o.add(v.id)}}catch(e){f=!0,T=e}finally{try{y||null==g.return||g.return()}finally{if(f)throw T}}var m=!0,S=!1,E=void 0;try{for(var b,R=n.changed[Symbol.iterator]();!(m=(b=R.next()).done);m=!0){var I=b.value;o.add(I.id)}}catch(e){S=!0,E=e}finally{try{m||null==R.return||R.return()}finally{if(S)throw E}}s()}});return function(){p.unsubscribe()}})),(0,f._)(a,"subscribe",a.result.subscribe.bind(a.result)),a.window=a.session.window(o),a.map=null!=(s=i.map)?s:function(e){return e},a}return(0,w._)(n,e),(0,y._)(n,[{key:"size",get:function(){return this.window.size}},{key:Symbol.observable,value:function(){return this.result}}]),n}(B),V=e.i(377930),$=function(e){function n(e,r,i,o){var a;return(0,d._)(this,n),a=(0,U._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.transformer}]),(0,f._)(a,"window",void 0),(0,f._)(a,"exhaustive",new g.Multicast(function(e){return N.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,f._)(a,"state",new g.Multicast(function(e){var t=new M,n=new Map,r=new Map;return a.window.events.lift(e,function(i){var o=t.patch(i);if(o){var s=!1,p=!1;if(!t.length){s||(s=!!(n.size||r.size)),p||(p=s),s&&(n.clear(),r.clear(),e.next({events:t,transformed:r,scaled:s}));return}var l=!0,u=!1,c=void 0;try{for(var d,y=o.removed[Symbol.iterator]();!(l=(d=y.next()).done);l=!0){var f=d.value;s||(s=r.has(f.id)),p||(p=s),n.delete(f.id),r.delete(f.id)}}catch(e){u=!0,c=e}finally{try{l||null==y.return||y.return()}finally{if(u)throw c}}if(o.added.length||o.changed.length)for(var T=a.indexed(t,o.added.concat(o.changed)),h=T[0];h>=0&&h<t.length;){var g=h===T[0];g&&T.shift();var v=t.get(h),m=r.get(v.id),S=a.step(t,n,v),E=S.ret,b=S.recomputing;if((b||g)&&(void 0!==E?r.set(v.id,E):void 0!==m&&r.delete(v.id)),s||(s=!!m!=!!E),p||(p=b||g||s),b||T.length){h=b?h+a.direction:T[0];continue}break}(s||p)&&e.next({events:t,transformed:r,scaled:s})}})})),(0,f._)(a,"tuples",new g.Multicast(function(e){var t=new Map,n=!0;return a.state.lift(e,function(r){if(r.scaled||n){n=!1;for(var i=[],o=0;o<r.events.length;o++){var s=r.events.get(o);if(s&&r.transformed.has(s.id)){var p,l=null!=(p=t.get(s.id))?p:a.create(s.id);t.set(s.id,l),i.push([s.id,l])}}e.next(i)}})})),(0,f._)(a,"flat",new g.Multicast(function(e){return a.state.lift(e,function(t){for(var n=[],r=0;r<t.events.length;r++){var i=t.events.get(r),o=i&&t.transformed.get(i.id);void 0!==o&&n.push(o)}e.next(n)})})),(0,f._)(a,"mapped",a.tuples.map(function(e){return new Map(e)})),(0,f._)(a,"subscribe",a.tuples.subscribe.bind(a.tuples)),a.window=a.session.window(o),a}return(0,w._)(n,e),(0,y._)(n,[{key:"size",get:function(){return this.window.size}},{key:"create",value:function(e){var t=this;return new g.Multicast(function(n){var r=V.None;return t.state.lift(n,function(t){var i=t.transformed.get(e);if(void 0===i)return n.complete();r!==i&&(r=i,n.next(i))})})}},{key:"map",value:function(e){var t=this;return new g.Multicast(function(n){var r=new Map,i=V.None;return t.state.lift(n,function(o){for(var a=[],s=0;s<o.events.length;s++){var p,l=null==(p=o.events.get(s))?void 0:p.id,u=l&&o.transformed.get(l);if(l&&u){var c=r.get(l);c||(c=t.create(l),r.set(l,c)),a.push({id:l,value:u,observable:c})}}var d=e(a);L(d,i)||(i=d,n.next(d))})})}},{key:"chunked",value:function(e){var n=this;return new g.Multicast(function(r){var i=null;return N.Observable.combine(n.mapped,n.state).lift(r,function(n){for(var o=(0,t._)(n,2),a=o[0],s=o[1],p=[],l=function(e){if(e<0||e>=s.events.length)return null;var t=s.events.get(e),n=s.transformed.get(t.id);return a.has(t.id)&&n?{event:t,transformed:n}:null},u=[],c=null,d=0;d<s.events.length;d++){var y=l(d);if(y){for(var f=null,T=d+1;T<s.events.length;T++)if(a.has(s.events.get(T).id)){f=l(T);break}var h=e(y,c,f);switch(c=y,h){case"continue":u.push(y.event.id);break;case"break":u.length&&(p.push(u),u=[]),u.push(y.event.id);break;case"isolate":u.length&&(p.push(u),u=[]),p.push([y.event.id])}}}u.length&&p.push(u),L(p,i)||(i=p,r.next(p.map(function(e){return e.map(function(e){return[e,a.get(e)]})})))})})}},{key:Symbol.observable,value:function(){return this.tuples}}]),n}(B),W=function(){function e(){(0,d._)(this,e),(0,f._)(this,"nodes",new Set),(0,f._)(this,"up",new Map),(0,f._)(this,"down",new Map),(0,f._)(this,"leafs",new Map)}return(0,y._)(e,[{key:"size",get:function(){return this.nodes.size}},{key:"ids",value:function(){return new Set(this.nodes.keys())}},{key:"has",value:function(e){return this.nodes.has(e)}},{key:"parent",value:function(e){var t;return null!=(t=this.up.get(e))?t:null}},{key:"children",value:function(e){var t;return null!=(t=this.down.get(e))?t:null}},{key:"siblings",value:function(e){var t=this.parent(e);return t?this.children(t):null}},{key:"hierarchy",value:function(e){for(var t=[e],n=e;this.up.has(n);)t.unshift(n=this.up.get(n));return t}},{key:"isLeaf",value:function(e){return this.leafs.has(e)}},{key:"latest",value:function(){var e=null,n=-1,r=!0,i=!1,o=void 0;try{for(var a,s=this.leafs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=(0,t._)(a.value,2),l=p[0],u=p[1];u>n&&(e=l,n=u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return e}},{key:"walk",value:function(e,t){if(!this.nodes.has(e))throw Error("node not in graph");if(!1!==t(e,this.isLeaf(e))){for(var n=this.children(e);(null==n?void 0:n.size)===1;){if(!1===t(e=n.values().next().value,this.isLeaf(e)))return;n=this.children(e)}if(null==n?void 0:n.size){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=a.value;this.walk(p,t)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}}},{key:"append",value:function(e){var t=this.nodes.size,n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=a.value;if(!n.has(p.id)&&this.nodes.has(p.id)){var l=this.up.get(p.id);if(l&&l!==p.parent)throw Error("parent mismatch");continue}if(this.nodes.add(p.id),n.add(p.id),this.down.has(p.id)||this.leafs.set(p.id,p.priority),p.parent){this.leafs.delete(p.parent);var u=this.down.get(p.parent);u||(u=new Set,this.down.set(p.parent,u),this.nodes.add(p.parent),n.add(p.parent)),this.up.set(p.id,p.parent),u.add(p.id)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return this.nodes.size!==t}},{key:"clone",value:function(){var n=new e;n.nodes=new Set(this.nodes),n.up=new Map(this.up),n.leafs=new Map(this.leafs);var r=!0,i=!1,o=void 0;try{for(var a,s=this.down[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=(0,t._)(a.value,2),l=p[0],u=p[1];n.down.set(l,new Set(u))}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}]),e}(),z=function(){function e(){(0,d._)(this,e),(0,f._)(this,"queue",[]),(0,f._)(this,"locked",!1)}return(0,y._)(e,[{key:"acquire",value:function(){var e=this;return this.locked?new Promise(function(t){e.queue.push(t)}):(this.locked=!0,Promise.resolve())}},{key:"release",value:function(){if(this.queue.length>0){var e=this.queue.shift();null==e||e()}else this.locked=!1}},{key:"run",value:function(e){return(0,T._)(function(){return(0,h._)(this,function(t){switch(t.label){case 0:return[4,this.acquire()];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,,4,5]),[4,e()];case 3:return[2,t.sent()];case 4:return this.release(),[7];case 5:return[2]}})}).call(this)}},{key:"clear",value:function(){this.queue.length=0,this.locked=!1}}]),e}(),H=e.i(99145),K=e.i(862927),Y=e.i(131141),Q={messageEventContents:{$kind:"messageEventContext",messageEventContext:K.Value.Create(s.MessageEventContextSchema)},inlineActionEventContents:{$kind:"inlineActionEventContext",inlineActionEventContext:K.Value.Create(s.InlineActionEventContextSchema)},shellSuggestionEventContents:{$kind:"shellSuggestionEventContext",shellSuggestionEventContext:K.Value.Create(s.ShellSuggestionEventContextSchema)},sessionCreationEventContents:{$kind:"sessionCreationEventContext",sessionCreationEventContext:K.Value.Create(s.SessionCreationEventContextSchema)},localShellExecutionEventContents:{$kind:"localShellExecutionEventContext",localShellExecutionEventContext:K.Value.Create(s.LocalShellExecutionEventContextSchema)},translateEventContents:{$kind:"translateEventContext",translateEventContext:K.Value.Create(s.TranslateEventContextSchema)},byoPromptEventContents:{$kind:"byoPromptEventContext",byoPromptEventContext:K.Value.Create(s.BYOPromptEventContextSchema)},agentPlanEventContents:{$kind:"agentPlanEventContext",agentPlanEventContext:K.Value.Create(s.AgentPlanEventContextSchema)},agentTimelineEventContents:{$kind:"agentTimelineEventContext",agentTimelineEventContext:K.Value.Create(s.AgentTimelineEventContextSchema)},iterativeAgentEventContents:{$kind:"iterativeAgentEventContext",iterativeAgentEventContext:K.Value.Create(s.IterativeAgentEventContextSchema)}},X=!0,J=!1,Z=void 0;try{for(var ee,et,en=Object.values(Q)[Symbol.iterator]();!(X=(et=en.next()).done);X=!0){var er=et.value;(0,Y.freeze)(er,!0)}}catch(e){J=!0,Z=e}finally{try{X||null==en.return||en.return()}finally{if(J)throw Z}}var ei=(0,Y.freeze)(K.Value.Create(s.EventSchema),!0),eo=function(){function e(){var t=this;(0,d._)(this,e),(0,f._)(this,"stockpile",new Map),(0,f._)(this,"registry",new FinalizationRegistry(function(e){t.stockpile.delete(e)})),(0,f._)(this,"listeners",new H.ListenerList)}return(0,y._)(e,[{key:"empty",get:function(){return 0===this.stockpile.size}},{key:"has",value:function(e){var t;return this.stockpile.has(e)&&(null==(t=this.stockpile.get(e))?void 0:t.deref())!==void 0}},{key:"get",value:function(e){var t,n;return null!=(n=null==(t=this.stockpile.get(e))?void 0:t.deref())?n:null}},{key:"add",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n===e?n:(n&&this.registry.unregister(n),this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"emplace",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n||(this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"delete",value:function(e){var t=this.stockpile.get(e);if(t){this.stockpile.delete(e);var n=t.deref();n&&this.registry.unregister(n)}}},{key:"store",value:function(e){var t=this;null!=e||(e=[]),"string"==typeof e&&(e=[e]);var n=new Set,r=new Map,i=!0,o=!1,a=void 0;try{for(var s,p=e[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var l=s.value;n.add(l),r.set(l,this.get(l))}}catch(e){o=!0,a=e}finally{try{i||null==p.return||p.return()}finally{if(o)throw a}}var u=!1,c=this.listeners.add(function(e){n.has(e.id)&&r.set(e.id,e)});return(0,f._)({has:function(e){return n.has(e)},get:function(e){var t;return null!=(t=r.get(e))?t:null},track:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var i=!0,o=!1,a=void 0;try{for(var s,p=e[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var l=s.value;n.add(l),r.set(l,t.get(l))}}catch(e){o=!0,a=e}finally{try{i||null==p.return||p.return()}finally{if(o)throw a}}},untrack:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var t=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var p=a.value;p="string"==typeof p?p:p.id,n.delete(p),r.delete(p)}}catch(e){i=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw o}}},release:function(){u||(u=!0,c(),n.clear(),r.clear())}},Symbol.iterator,function(){var e,t,i,o,a,s,p,l;return(0,h._)(this,function(u){switch(u.label){case 0:e=!0,t=!1,i=void 0,u.label=1;case 1:u.trys.push([1,6,7,8]),o=n[Symbol.iterator](),u.label=2;case 2:if(e=(a=o.next()).done)return[3,5];if(s=a.value,!(p=r.get(s)))return[3,4];return[4,p];case 3:u.sent(),u.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return l=u.sent(),t=!0,i=l,[3,8];case 7:try{e||null==o.return||o.return()}finally{if(t)throw i}return[7];case 8:return[2]}})})}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.delete(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),ea={events:new(function(e){function t(){return(0,d._)(this,t),(0,U._)(this,t,arguments)}return(0,w._)(t,e),(0,y._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&o.state!==s.EventState.COMPLETE&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){var t,n,r;return this.add(((n=Object.assign({},ei)).id=e.eventId,n.parentEventId=e.parentEventId,n.sessionId=e.sessionId,n.state=e.state,n.error=e.error,n.sender=e.sender,n.contents=e.contents,n.created=new Date,(r=null==(t=e.contents.contents)?void 0:t.$kind)&&Q[r]&&(n.context={metadata:Q[r]}),n))}},{key:"update",value:function(e){var t=this.get(e.eventId);return t?this.add((0,R.applyEventUpdateMessage)(t,e)):null}}]),t}(eo)),sessions:new(function(e){function t(){return(0,d._)(this,t),(0,U._)(this,t,arguments)}return(0,w._)(t,e),(0,y._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&!o.archived&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){return this.add((0,O.createSessionFromCreateSessionMessage)(e))}},{key:"update",value:function(e){var t=this.get(e.sessionId);return t?this.add((0,O.applySessionUpdateMessage)(t,e)):null}}]),t}(eo))},es=function(){function e(t,n,r,i,o){var a=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"eventId",void 0),(0,f._)(this,"parent",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"event",new g.Multicast(function(e){var t=ea.events.store(a.eventId),n=a.api.materializer.get(a.eventId);n&&e.next(n);var r=a.api.state.register({snapshot:function(){return n},rollback:function(e){return n=e},notify:function(){n&&e.next(n)},update:function(e){if("event-modified"===e.kind&&e.event.id===a.eventId)return n=e.event,!0}}),i=a.api.connected.lift(e,function(t){return(0,T._)(function(){var i,o,a;return(0,h._)(this,function(s){switch(s.label){case 0:return(i=ea.events.get(this.eventId))&&n!==i&&(n=i,r.commit(),e.next(n)),[4,(0,v.get)(this.api.materializer.materialize(this.parent.id,[this.eventId]))];case 1:if(o=s.sent(),t.aborted||(0,v.isError)(o,"UNEXPECTED_DISCONNECT"))return[2];if(!o.ok)return[2,this.api.error(o,e)];return a=ea.events.emplace(o.payload[0]),n!==a&&(n=a,r.commit(),e.next(n)),[2]}})}).call(a)});return function(){t.release(),r.unsubscribe(),i.unsubscribe()}})),(0,f._)(this,"data",this.event.select(function(e){return e.contents.contents.subagentRunning})),(0,f._)(this,"kind",this.data.filter(function(e){return void 0!==e.contents}).select(function(e){return e.contents.$kind})),(0,f._)(this,"running",this.event.select(function(e){return e.state!==s.EventState.COMPLETE})),(0,f._)(this,"totalExecutionTimeSeconds",this.data.select(function(e){return e.totalExecutionTimeSeconds})),this.api=t,this.id=n,this.eventId=r,this.parent=i,this.session=o}return(0,y._)(e,[{key:"contents",value:function(e){return this.data.filter(function(t){var n;return(null==(n=t.contents)?void 0:n.$kind)===e}).select(function(e){return(0,A.unkind)(e.contents)})}},{key:"abort",value:function(){return(0,T._)(function(){var e;return(0,h._)(this,function(t){switch(t.label){case 0:return[4,this.api.service.abortSubagent.rpc({replId:this.api.replId,sessionId:this.parent.id,subagentId:this.id})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,v.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r,i,o){var a=this.subagents.get(t);a||(a=new Map,this.subagents.set(t,a));var s=a.get(n),p=null==s?void 0:s.deref();if(s&&p||(s=new WeakRef(p=new e(t,n,r,i,o)),a.set(n,s)),p.eventId!==r)throw Error("Subagent event ID mismatch");if(p.parent!==i)throw Error("Subagent parent mismatch");if(p.session!==o)throw Error("Subagent session mismatch");return p}}]),e}();(0,f._)(es,"subagents",new WeakMap);var ep=e.i(790164),el=function(){function e(n,r,i){var o=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"size",void 0),(0,f._)(this,"events",new g.Multicast(function(e){var n=new P,r=new M,i=function(e){var t=(null==e?void 0:e.length)?new Map(e.map(function(e){return[e.id,e]})):null,i=r.adopt(n,t);return!!i&&(i.missing.length&&o.api.materializer.enqueue(o.session.id,i.missing),!0)},a=o.api.state.register({snapshot:function(){return{ids:n.clone(),events:r.clone()}},rollback:function(e){n=e.ids,r=e.events},notify:function(){return e.next(r)},update:function(e){if("event-modified"===e.kind&&n.has(e.event.id))return i([e.event])}}),s=o.api.materializer.events.lift(e,function(t){var o=t.filter(function(e){var t=e.id;return n.has(t)});o.length&&i(o)&&e.next(r)}),p=N.Observable.combine(o.session.ids,o.size).lift(e,function(a){var s=(0,t._)(a,2),p=s[0],l=s[1],u=p.length?p.id(Math.max(0,p.length-l)):null,c=n.patch(p,u);c&&i(c.added.map(function(e){return o.api.materializer.get(e)}).filter(function(e){return null!==e}))&&e.next(r)});return function(){a.unsubscribe(),s.unsubscribe(),p.unsubscribe()}})),(0,f._)(this,"subscribe",this.events.subscribe.bind(this.events)),this.api=n,this.session=r,this.size=new ep.ObservableState(i)}return(0,y._)(e,[{key:Symbol.observable,value:function(){return this.events}}]),e}();function eu(e){var t=e.api,n=e.sessionId,r=e.tip,i=e.onGraphFetched;return new g.Multicast(function(e){var o=!0,a=!0,s=new W,p=function(){if(r&&!s.has(r))return t.error("Tip event ".concat(r," not found in graph"),e);var n=null!=r?r:s.latest();if(!n)return t.error("Unexpected empty graph",e);var i=s.hierarchy(n),o=new P;o.append(i),e.next(o)},l=t.state.register({snapshot:function(){return s.clone()},rollback:function(e){return s=e},notify:function(){return p()},update:function(e){if(!a&&"event-modified"===e.kind&&"created"===e.type&&e.event.sessionId===n)return s.append([{id:e.event.id,parent:e.event.parentEventId,priority:e.event.created.getTime()}])}}),u=t.connected.lift(e,function(u){return(0,T._)(function(){var c,d,y,f,T,g,m,S,E,b,R,I,C,O,A,_,k,U,w,N,D;return(0,h._)(this,function(h){switch(h.label){case 0:if(T=Date.now(),l.rollback(),a=!0,null==(c=(d=t.logger).info)||c.call(d,r?"Starting to fetch session graph from tip":"Starting to fetch session graph",{sessionId:n,tip:r}),g=0,m=!1,S=null!=r?r:null,E=[],!r)return[3,2];return[4,t.service.batchGetEvents.rpc({sessionId:n,eventIds:[r]})];case 1:if(b=h.sent(),u.aborted||(0,v.isError)(b,"UNEXPECTED_DISCONNECT"))return[2];if(!b.ok)return[2,t.error(b,e)];b.payload.events.length>0&&(R=b.payload.events[0],E.push({id:R.id,parent:R.parentEventId||null,priority:R.created.getTime()})),h.label=2;case 2:I=200,h.label=3;case 3:if(!(I>0))return[3,6];return g++,[4,t.service.getEventList.rpc({sessionId:n,limit:500,AncestorsOf:S?{$kind:"ancestorsOf",ancestorsOf:S}:void 0})];case 4:if(C=h.sent(),(u.aborted||!C.ok)&&(null==(O=(A=t.logger).info)||O.call(A,r?"Aborted fetching session graph from tip":"Aborted fetching session graph",{sessionId:n,tip:r,numPagesFetched:g,amountFetched:E.length,duration:Date.now()-T})),u.aborted||(0,v.isError)(C,"UNEXPECTED_DISCONNECT"))return[2];if(!C.ok)return[2,t.error(C,e)];_=!0,k=!1,U=void 0;try{for(w=C.payload.shapes[Symbol.iterator]();!(_=(N=w.next()).done);_=!0)D=N.value,E.push({id:D.id,parent:D.parentEventId||null,priority:D.created.getTime()})}catch(e){k=!0,U=e}finally{try{_||null==w.return||w.return()}finally{if(k)throw U}}if(C.payload.shapes.length<500||(S=C.payload.shapes[C.payload.shapes.length-1].id,s.has(S)))return[3,6];h.label=5;case 5:return I--,[3,3];case 6:return E.length&&(m=s.append(E)),a=!1,(m||o)&&(o=!1,l.commit(),p()),null==(y=(f=t.logger).info)||y.call(f,r?"Finished fetching session graph from tip":"Finished fetching session graph",{sessionId:n,tip:r,numPagesFetched:g,amountFetched:E.length,duration:Date.now()-T}),null==i||i(Date.now()-T,E.length),[2]}})})()});return function(){l.unsubscribe(),u.unsubscribe()}})}var ec=function(){function e(t,n,r){var i=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"agent",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"created",void 0),(0,f._)(this,"mutex",new z),(0,f._)(this,"data",new g.Multicast(function(e){var t=null,n=ea.sessions.get(i.id);n&&(t=(0,O.compatSessionToData)(n),e.next(n));var r=i.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next((0,O.compatDataToSession)(i.api.replId,t))},update:function(e){if(t&&e.optimistic&&"session-modified"===e.kind&&e.session.id===i.id){var n=(0,E.create)(t,function(t){t.title=e.session.title,t.archived=e.session.archived,t.readOnly=e.session.readOnly,t.taskId=e.session.taskId}),r=t!==n;return t=n,r&&(t.updated=new Date),r}}}),o=i.api.connected.lift(e,function(n){return(0,T._)(function(){var i,o,a,s,p,l,u,c,d,y,f,T,g;return(0,h._)(this,function(h){switch(h.label){case 0:return i=this,[4,(0,b.getSyncResult)(this.api.chort.sessions.data.subscribe({sessionId:this.id},{signal:n}))];case 1:if(a=(o=h.sent()).snapshot,s=o.deltas,(0,v.isError)(a,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!a.ok)return[2,this.api.error(a,e)];ea.sessions.add((0,O.compatDataToSession)(this.api.replId,a.payload)),r.rollback(),r.rebase(function(){return t=a.payload,!0}),p=!1,l=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),d=function(){var n=f.value;if((0,v.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL"))return{v:void 0};if(!n.ok)return{v:c.api.error(n,e)};var o=n.payload;if(!t)return{v:c.api.error(Error("Unexpected: no data"),e)};r.rebase(function(){var e=(0,E.apply)(t,o),n=t!==e;return t=e,n&&ea.sessions.add((0,O.compatDataToSession)(i.api.replId,t)),n})},y=(0,m._)(s),h.label=3;case 3:return[4,y.next()];case 4:if(!(p=!(f=h.sent()).done))return[3,6];if(c=this,T=d(),"object"===(0,S._)(T))return[2,T.v];h.label=5;case 5:return p=!1,[3,3];case 6:return[3,13];case 7:return g=h.sent(),l=!0,u=g,[3,13];case 8:if(h.trys.push([8,,11,12]),!(p&&null!=y.return))return[3,10];return[4,y.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(l)throw u;return[7];case 12:return[7];case 13:return[2]}})}).call(i)});return function(){r.unsubscribe(),o.unsubscribe()}})),(0,f._)(this,"type",this.data.select(function(e){return e.sessionType})),(0,f._)(this,"ids",void 0),(0,f._)(this,"leaf",void 0),this.api=t,this.agent=new k(t,this),this.id=n,this.created=r,this.ids=eu({api:this.api,sessionId:this.id,onGraphFetched:function(e,t){i.api.hooks.trigger("session-graph-fetched",{session:i,duration:e,size:t})}}),this.leaf=this.ids.select(function(e){return e.last}).filter(function(e){return null!==e}),this.api.teardown(function(){return i.mutex.clear()})}return(0,y._)(e,[{key:"subagent",value:function(t,n,r,i){return es.create(this.api,t,n,this,e.create(this.api,r,i))}},{key:"window",value:function(e){return new el(this.api,this,e)}},{key:"from",value:function(e){return new ed(this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new G(this.api,this,e):new q(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new $(this.api,this,e,t)}},{key:"updateSession",value:function(e){return(0,T._)(function(){var n,r,i,o,a,s,p,l,u;return(0,h._)(this,function(c){switch(c.label){case 0:return[4,(0,v.get)(this.data)];case 1:if(!(n=c.sent()).ok)return[2,this.api.error(n)];if(r=n.payload,o=(i=(0,O.createUpdateSessionRequest)(r,e)).session,a=i.request,r===o)return[2,(0,v.Ok)(r)];return p=(s=(0,t._)(this.api.state.stage({kind:"session-modified",type:"updated",session:o}),2))[0],l=s[1],[4,this.api.service.updateSession.rpc(a)];case 2:if(!(u=c.sent()).ok)return l(),[2,this.api.error(u)];return p(),this.api.hooks.trigger("client-updated-session",{session:this,request:a,prev:r,next:o}),[2,(0,v.Ok)(o)]}})}).call(this)}},{key:"updateEvent",value:function(e){var n=this;return this.mutex.run(function(){return(0,T._)(function(){var n,r,i,o,a,s,p,l,u,c,d,y;return(0,h._)(this,function(f){switch(f.label){case 0:return[4,(0,v.get)(this.ids.map(function(t){return t.has(e.id)}))];case 1:if(!(n=f.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("Event does not exist in the session")];return[4,(0,v.get)(this.api.materializer.materialize(this.id,[e.id]))];case 2:if(!(r=f.sent()).ok)return[2,this.api.error(r)];if(i=(0,t._)(r.payload,1)[0],o=(0,C.createUpdateEventRequest)(e),(a=(0,R.applyEventUpdateMessage)(i,o))===i)return[2,(0,v.Ok)(a)];return p=(s=(0,t._)(this.api.state.stage({kind:"event-modified",type:"updated",event:a}),2))[0],l=s[1],[4,this.api.service.updateEvent.upload()];case 3:return c=(u=t._.apply(void 0,[f.sent(),2]))[0],d=u[1],c.push(o),c.end(),[4,d];case 4:if(!(y=f.sent()).ok)return l(),[2,this.api.error(y)];return this.api.hooks.trigger("client-updated-event",{session:this,request:o,prev:i,next:a}),p(),[2,(0,v.Ok)(a)]}})}).call(n)})}},{key:"appendEvent",value:function(e,n){var r=this;return this.mutex.run(function(){return(0,T._)(function(){var r,i,o,a,p,l,u,c,d,y,f,T,g;return(0,h._)(this,function(h){switch(h.label){case 0:return[4,(0,v.get)([this.leaf,this.data.select(function(e){return e.sessionType})])];case 1:if(!(r=h.sent()).ok)return[2,this.api.error(r)];if(o=(i=(0,t._)(r.payload,2))[0],a=i[1],void 0!==e.modelType&&a===s.SessionType.AGENT_SESSION)return[2,this.api.error("Agent sessions do not support model type configuration")];if(p=s.ModelType.BASIC,e.modelType===s.ModelType.ADVANCED&&(p=this.api.hasAdvancedModel.current?this.api.overrideModel.current?{type:s.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}:s.ModelType.ADVANCED:s.ModelType.BASIC),e.modelType===s.ModelType.OVERRIDE){if(!this.api.overrideModel.current)return[2,this.api.error("No override model set")];p={type:s.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}}return u=(l=(0,I.createEventRequest)({session:this.id,sender:this.api.user.current,addToChild:!0,parent:o,model:p,data:e,benchmark:n})).event,c=l.request,y=(d=(0,t._)(this.api.state.stage({kind:"event-modified",type:"created",event:u,condition:function(e){return!("event-modified"===e.kind&&"created"===e.type&&(e.event.id===u.id?e.event.parentEventId!==u.parentEventId:e.event.parentEventId===u.parentEventId))}}),2))[0],f=d[1],[4,this.api.service.createEvent.rpc(c)];case 2:if(!(T=h.sent()).ok)return f(),[2,this.api.error(T)];if(T.payload.eventId===u.id&&T.payload.parentEventId===u.parentEventId)return[3,4];return f(),[4,(0,v.get)(this.api.materializer.materialize(this.id,[T.payload.eventId]))];case 3:if(!(g=h.sent()).ok)return[2,this.api.error(g)];return this.api.hooks.trigger("client-appended-event",{session:this,event:g.payload[0]}),[2,(0,v.Ok)(g.payload[0])];case 4:return y(),this.api.hooks.trigger("client-appended-event",{session:this,event:u}),[2,(0,v.Ok)(u)]}})}).call(r)})}},{key:"abortLastEvent",value:function(){var e=this;return this.mutex.run(function(){return(0,T._)(function(){var e,t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,(0,v.get)(this.leaf)];case 1:if(!(e=n.sent()).ok)return[2,this.api.error(e)];return[4,this.api.service.abortEvent.rpc({eventId:e.payload})];case 2:if(!(t=n.sent()).ok)return[2,this.api.error(t)];return[2,(0,v.Ok)(null)]}})}).call(e)})}},{key:"submitUserFeedback",value:function(e){return(0,T._)(function(){var n,r,i,o,a;return(0,h._)(this,function(s){switch(s.label){case 0:return[4,(0,v.get)([this.data.select(function(e){return e.sessionType}),this.leaf])];case 1:if(!(n=s.sent()).ok)return[2,this.api.error(n)];return i=(r=(0,t._)(n.payload,2))[0],o=r[1],[4,this.api.service.submitAgentUserFeedback.rpc({sessionId:this.id,sessionType:i,feedback:e,sourceEventId:o})];case 2:if(!(a=s.sent()).ok)return[2,this.api.error(a)];return[2,(0,v.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r){var i=this.sessions.get(t);i||(i=new Map,this.sessions.set(t,i));var o=i.get(n),a=null==o?void 0:o.deref();return o&&a||(o=new WeakRef(a=new e(t,n,r)),i.set(n,o)),a}}]),e}();(0,f._)(ec,"sessions",new WeakMap);var ed=function(){function e(t,n){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"id",void 0),(0,f._)(this,"tip",void 0),(0,f._)(this,"session",void 0),(0,f._)(this,"ids",void 0),this.api=t.api,this.id=t.id,this.tip=n,this.session=t,this.ids=eu({api:this.api,sessionId:this.id,tip:this.tip})}return(0,y._)(e,[{key:"window",value:function(e){return new el(this.api,this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new G(this.api,this,e):new q(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new $(this.api,this,e,t)}}]),e}(),ey=function(){function e(t){var n,r,i,o,a=this,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"archived",void 0),(0,f._)(this,"readonly",void 0),(0,f._)(this,"limit",void 0),(0,f._)(this,"types",void 0),(0,f._)(this,"map",new g.Multicast(function(e){var t=!1,n=ea.sessions.store(),r=new Map,i=a.api.state.register({snapshot:function(){return new Map(r)},rollback:function(e){r=new Map(e);var t=n;n=ea.sessions.store(Array.from(r.keys())),t.release()},notify:function(){return e.next(new Map(r))},update:function(e){if(t&&"session-modified"===e.kind){var n=e.session,i=a.types.includes(n.sessionType)&&(null===a.archived||n.archived===a.archived)&&(null===a.readonly||n.readOnly===a.readonly);if(!r.has(n.id)&&i)return r.set(n.id,ec.create(a.api,n.id,n.created)),!0;if(r.has(n.id)&&!i)return r.delete(n.id),!0}}}),o=a.api.connected.lift(e,function(o){a.api.queryFetchCounter.scope(function(){return(0,T._)(function(){var a,s,p,l,u,c,d,y,f,T,g,m,S,E,b,R,I;return(0,h._)(this,function(h){switch(h.label){case 0:return[4,this.api.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:this.limit,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:this.api.replId,sessionTypes:this.types,archived:null!=(a=this.archived)?a:void 0})];case 1:if(s=h.sent(),o.aborted||(0,v.isError)(s,"UNEXPECTED_DISCONNECT"))return[2];if(!s.ok)return[2,this.api.error(s,e)];i.rollback(),p=new Set(r.keys()),l=!1,u=!0,c=!1,d=void 0;try{for(y=s.payload.sessions[Symbol.iterator]();!(u=(f=y.next()).done);u=!0)(T=f.value).events=[],ea.sessions.emplace(T),(null===this.readonly||T.readOnly===this.readonly)&&(p.delete(T.id),r.has(T.id)||(g=ec.create(this.api,T.id,T.created),n.track(T.id),r.set(T.id,g),l=!0))}catch(e){c=!0,d=e}finally{try{u||null==y.return||y.return()}finally{if(c)throw d}}m=!0,S=!1,E=void 0;try{for(b=p[Symbol.iterator]();!(m=(R=b.next()).done);m=!0)I=R.value,n.untrack(I),r.delete(I),l=!0}catch(e){S=!0,E=e}finally{try{m||null==b.return||b.return()}finally{if(S)throw E}}return(l||!t)&&(t=!0,i.commit(),e.next(new Map(r))),[2]}})}).call(a)})});return function(){n.release(),i.unsubscribe(),o.unsubscribe()}})),(0,f._)(this,"list",this.map.select(function(e){return Array.from(e.values()).sort(function(e,t){return t.created.getTime()-e.created.getTime()})},function(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})})),(0,f._)(this,"latest",this.map.select(function(e){var t=null,n=!0,r=!1,i=void 0;try{for(var o,a=e.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;(!t||s.created>t.created)&&(t=s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t})),(0,f._)(this,"subscribe",this.map.subscribe.bind(this.map)),this.api=t,this.archived=null!=(n=p.archived)?n:null,this.readonly=null!=(r=p.readonly)?r:null,this.limit=null!=(i=p.limit)?i:1e3,this.types=null!=(o=p.types)?o:[s.SessionType.CHAT,s.SessionType.AGENT_SESSION]}return(0,y._)(e,[{key:Symbol.observable,value:function(){return this.map}}]),e}(),ef=e.i(167626),eT=e.i(878420),eh=e.i(64386),eg=e.i(886513),ev=function(){function e(){(0,d._)(this,e),(0,f._)(this,"__brand",void 0)}return(0,y._)(e,[{key:"is",value:function(e){return"effect"===e.kind&&e.effect===this}}]),e}(),em=function(){function e(n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"handles",new Map),(0,f._)(this,"onUpdateHandlers",null),(0,f._)(this,"refs",new Set),(0,f._)(this,"buffer",[]),(0,f._)(this,"conditions",new Set),(0,f._)(this,"listeners",new H.ListenerList),(0,f._)(this,"optimistic",!1),(0,f._)(this,"emitter",new N.Observable(function(e){return r.api.connected.lift(e,function(n){return(0,T._)(function(){var r,i,o,a,p,l,u,c,d,y,f,T,g,S,E,b,R,I,C,O,k,U,w,N,D;return(0,h._)(this,function(h){switch(h.label){case 0:return r=ea.events.store(),i=ea.sessions.store(),[4,this.api.service.subscribeToReplEvents.subscribe({replId:this.api.replId})];case 1:if(a=(o=t._.apply(void 0,[h.sent(),2]))[0],p=o[1],l=function(){p(),r.release(),i.release()},n.aborted)return[2,l()];n.addEventListener("abort",p),u=!1,c=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),y=(0,m._)(a),h.label=3;case 3:return[4,y.next()];case 4:if(!(u=!(f=h.sent()).done)||(T=f.value,n.aborted||(0,v.isError)(T,"UNEXPECTED_DISCONNECT")))return[3,6];if(!T.ok)return this.api.error(T,e),[3,6];if(!T.payload.message)return[3,5];if(g=void 0,S=(0,A.unwrapKind)(T.payload.message),T.payload.sender.type!==s.UserType.USER)switch(S.$kind){case"createEventMessage":case"updateEventMessage":this.api.hooks.trigger("agent-activity",{type:"modify-event"});break;case"createSessionMessage":case"updateSessionMessage":this.api.hooks.trigger("agent-activity",{type:"modify-session"});break;case"updateAgentStateMessage":this.api.hooks.trigger("agent-activity",{type:"modify-state"})}switch(S.$kind){case"subscriptionStatusMessage":case"abortEventMessage":return[3,5];case"createEventMessage":(E=ea.events.create(S)).state===s.EventState.COMPLETE?this.api.hooks.trigger("received-completed-event",{event:E}):this.api.hooks.has("received-completed-event")&&r.track(E.id),void 0===E.contents.contents&&this.api.hooks.has("received-event")?i.track(E.id):this.api.hooks.trigger("received-event",{event:E}),g={kind:"event-modified",optimistic:!1,type:"created",event:E};break;case"updateEventMessage":if(!(b=ea.events.update(S)))return[3,5];r.has(b.id)&&b.state===s.EventState.COMPLETE&&(r.untrack(b.id),this.api.hooks.trigger("received-completed-event",{event:b})),i.has(b.id)&&void 0!==b.contents.contents&&(i.untrack(b.id),this.api.hooks.trigger("received-event",{event:b})),g={kind:"event-modified",optimistic:!1,type:"updated",event:b};break;case"createSessionMessage":g={kind:"session-modified",optimistic:!1,type:"created",session:ea.sessions.create(S)};break;case"updateSessionMessage":if(!(R=ea.sessions.update(S)))return[3,5];g={kind:"session-modified",optimistic:!1,type:"updated",session:R};break;case"updateAgentStateMessage":I=_(S),this.api.hooks.trigger("agent-state-changed",{sessionId:S.sessionId,state:I}),g={kind:"agent-state-modified",optimistic:!1,session:S.sessionId,state:I}}C=!0,O=!1,k=void 0;try{for(U=this.conditions[Symbol.iterator]();!(C=(w=U.next()).done);C=!0)if(N=w.value,!1===N(g)){this.rollback();break}}catch(e){O=!0,k=e}finally{try{C||null==U.return||U.return()}finally{if(O)throw k}}e.next(g),h.label=5;case 5:return u=!1,[3,3];case 6:return[3,13];case 7:return D=h.sent(),c=!0,d=D,[3,13];case 8:if(h.trys.push([8,,11,12]),!(u&&null!=y.return))return[3,10];return[4,y.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(c)throw d;return[7];case 12:return[7];case 13:return n.removeEventListener("abort",l),l(),[2]}})}).call(r)})})),(0,f._)(this,"updates",new g.StatelessMulticast(function(e){var t=r.listeners.add(function(t){e.next(t)}),n=r.emitter.subscribe(e);return function(){t(),n.unsubscribe()}})),this.api=n;var i=this.api.status.subscribe(function(e){"connected"!==e&&(ea.events.invalidate(),ea.sessions.invalidate(),r.optimistic&&r.rollback())}),o=null,a=this.api.hooks.subscribe(function(e){if("agent-state-changed"===e.type||"received-completed-event"===e.type||"received-event"===e.type){var t=r.api.hooks.has("agent-state-changed")||r.api.hooks.has("received-completed-event")||r.api.hooks.has("received-event");t&&!o?o=r.updates.subscribe(function(){}):!t&&o&&(o.unsubscribe(),o=null)}});this.api.teardown(function(){i.unsubscribe(),a(),null==o||o.unsubscribe()})}return(0,y._)(e,[{key:"isOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});return!!t&&t.type}},{key:"getOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});if(!t)throw Error("Event not found in optimistic state");return t.event}},{key:"apply",value:function(e){var n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=this.handles[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p,l=(0,t._)(a.value,2),u=l[0],c=l[1];if(e.optimistic&&c!==V.None){(null==(d=u.update)?void 0:d.call(u,e))&&n.add(u);continue}if(e.optimistic&&c===V.None){var d,y,f=u.snapshot();(null==(y=u.update)?void 0:y.call(u,e))&&(this.handles.set(u,f),n.add(u));continue}if(!e.optimistic&&c!==V.None){u.rollback(c),(null==(m=u.update)?void 0:m.call(u,e))&&n.add(u);var T=u.snapshot(),h=!0,g=!1,v=void 0;try{for(var m,S,E=this.buffer[Symbol.iterator]();!(h=(S=E.next()).done);h=!0){var b,R=S.value;(null==(b=u.update)?void 0:b.call(u,R))&&(this.handles.set(u,T),n.add(u))}}catch(e){g=!0,v=e}finally{try{h||null==E.return||E.return()}finally{if(g)throw v}}continue}!e.optimistic&&c===V.None&&(null==(p=u.update)?void 0:p.call(u,e))&&n.add(u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}var I=!0,C=!1,O=void 0;try{for(var A,_=n[Symbol.iterator]();!(I=(A=_.next()).done);I=!0){var k,U=A.value;null==(k=U.notify)||k.call(U)}}catch(e){C=!0,O=e}finally{try{I||null==_.return||_.return()}finally{if(C)throw O}}}},{key:"rollback",value:function(){if(!this.optimistic)throw Error("Cannot rollback while not optimistic");this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var e=new Set,n=!0,r=!1,i=void 0;try{for(var o,a=this.handles[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=(0,t._)(o.value,2),p=s[0],l=s[1];l!==V.None&&(p.rollback(l),this.handles.set(p,V.None),e.add(p))}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}var u=!0,c=!1,d=void 0;try{for(var y,f=e[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){var T,h=y.value;null==(T=h.notify)||T.call(h)}}catch(e){c=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw d}}}},{key:"commit",value:function(){if(!this.optimistic)throw Error("Cannot commit while not optimistic");var e=!0,t=!1,n=void 0;try{for(var r,i=this.buffer[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;switch(o.kind){case"event-modified":ea.events.emplace(o.event);break;case"session-modified":ea.sessions.emplace(o.session)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var a=!0,s=!1,p=void 0;try{for(var l,u=this.handles.keys()[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;this.handles.set(c,V.None)}}catch(e){s=!0,p=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw p}}}},{key:"stage",value:function(e,t){var n,r=this;if((0,ef._)(e,ev))n={kind:"effect",effect:e,data:t};else if(e)n=e;else throw Error("Invalid effect or update");if("connected"!==this.api.status.current)throw Error("Cannot notify while not connected");var i=n.condition,o=(0,eg._)(n,["condition"]),a=(0,eh._)((0,eT._)({},o),{optimistic:!0});this.buffer.push(a),i&&this.conditions.add(i);var s=function(e){r.refs.has(s)&&(r.refs.delete(s),e?0===r.refs.size&&r.commit():(r.rollback(),r.api.hooks.trigger("client-state-rollback",{failed:a})),i&&r.conditions.delete(i))};return this.refs.add(s),this.optimistic=!0,this.listeners.notify(a),[function(){return s(!0)},function(){return s(!1)}]}},{key:"register",value:function(e){var t=this;return null!=this.onUpdateHandlers||(this.onUpdateHandlers=this.updates.subscribe(function(e){t.apply(e)})),this.handles.set(e,V.None),this.optimistic&&e.update&&Promise.resolve().then(function(){if(t.handles.has(e)&&t.optimistic){var n,r=e.snapshot(),i=!1,o=!0,a=!1,s=void 0;try{for(var p,l=t.buffer[Symbol.iterator]();!(o=(p=l.next()).done);o=!0){var u,c=p.value;(null==(u=e.update)?void 0:u.call(e,c))&&(i=!0)}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}i&&(t.handles.set(e,r),null==(n=e.notify)||n.call(e))}}),{get optimistic(){return t.handles.get(e)!==V.None},rollback:function(){var n=t.handles.get(e);n!==V.None&&(e.rollback(n),t.handles.set(e,V.None))},commit:function(){t.handles.set(e,V.None)},rebase:function(n){var r=t.handles.get(e);if(r===V.None){n()&&(null==(c=e.notify)||c.call(e));return}var i=e.snapshot();if(e.rollback(r),t.handles.set(e,V.None),!n()){t.handles.set(e,r),e.rollback(i);return}var o=!1,a=e.snapshot(),s=!0,p=!1,l=void 0;try{for(var u,c,d,y=t.buffer[Symbol.iterator]();!(s=(d=y.next()).done);s=!0){var f,T=d.value;(null==(f=e.update)?void 0:f.call(e,T))&&!o&&(t.handles.set(e,a),o=!0)}}catch(e){p=!0,l=e}finally{try{s||null==y.return||y.return()}finally{if(p)throw l}}null==(u=e.notify)||u.call(e)},unsubscribe:function(){if(t.handles.delete(e),0===t.handles.size){var n;null==(n=t.onUpdateHandlers)||n.unsubscribe(),t.onUpdateHandlers=null}}}}}]),e}(),eS=new ev,eE=new ev,eb=new ev,eR=function(){function e(t){var n=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"state",new g.Multicast(function(e){var t=null,r=n.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next(t)},update:function(e){if(t){if(eS.is(e)){var n=(0,E.create)(t,function(t){var n=t.find(function(t){return t.id===e.data.id});n&&(n.contents=e.data.contents)}),r=n!==t;return t=n,r}if(eE.is(e)){var i=(0,E.create)(t,function(t){var n=!0,r=!1,i=void 0;try{for(var o,a=e.data.ids[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)!function(){var e=o.value,n=t.findIndex(function(t){return t.id===e});-1!==n&&t.splice(n,1)}()}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}),o=i!==t;return t=i,o}if(eb.is(e)){var a=(0,E.create)(t,function(t){var n=t.findIndex(function(t){return t.id===e.data.id}),r=t[n];if(r){if(null===e.data.after){t.splice(n,1),t.unshift(r);return}var i=t.findIndex(function(t){return t.id===e.data.after});-1!==i&&(n<i&&i--,t.splice(n,1),t.splice(i+1,0,r))}}),s=a!==t;return t=a,s}}}}),i=n.api.connected.lift(e,function(i){return(0,T._)(function(){var n,o,a,s,p,l,u,c,d,y;return(0,h._)(this,function(f){switch(f.label){case 0:n=this.api.chort.queue.state.subscribe({},{signal:i}).resReadable,o=!1,a=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),l=function(){var n=c.value;return(0,v.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL")?{v:void 0}:n.ok?void r.rebase(function(){return t=n.payload,!0}):{v:p.api.error(n,e)}},u=(0,m._)(n),f.label=2;case 2:return[4,u.next()];case 3:if(!(o=!(c=f.sent()).done))return[3,5];if(p=this,d=l(),"object"===(0,S._)(d))return[2,d.v];f.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return y=f.sent(),a=!0,s=y,[3,12];case 7:if(f.trys.push([7,,10,11]),!(o&&null!=u.return))return[3,9];return[4,u.return()];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(n)});return function(){i(),r.unsubscribe()}})),this.api=t}return(0,y._)(e,[{key:"get",value:function(){return(0,T._)(function(){var e;return(0,h._)(this,function(t){switch(t.label){case 0:return[4,this.api.chort.queue.get.rpc({})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,v.Ok)(e.payload)]}})}).call(this)}},{key:"enqueue",value:function(e){return(0,T._)(function(e){var t,n;return(0,h._)(this,function(r){switch(r.label){case 0:return t=e.contents,[4,this.api.chort.queue.enqueue.rpc({contents:t})];case 1:if(!(n=r.sent()).ok)return[2,this.api.error(n)];return[2,(0,v.Ok)(n.payload)]}})}).apply(this,arguments)}},{key:"update",value:function(e){return(0,T._)(function(e){var n,r,i,o,a,s;return(0,h._)(this,function(p){switch(p.label){case 0:return n=e.id,r=e.contents,o=(i=(0,t._)(this.api.state.stage(eS,{id:n,contents:r}),2))[0],a=i[1],[4,this.api.chort.queue.update.rpc({id:n,contents:r})];case 1:if(!(s=p.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"reorder",value:function(e){return(0,T._)(function(e){var n,r,i,o,a,s;return(0,h._)(this,function(p){switch(p.label){case 0:return n=e.id,r=e.after,o=(i=(0,t._)(this.api.state.stage(eb,{id:n,after:r}),2))[0],a=i[1],[4,this.api.chort.queue.reorder.rpc({id:n,after:r})];case 1:if(!(s=p.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"flush",value:function(e){return(0,T._)(function(e){var n,r,i,o,a,s;return(0,h._)(this,function(p){switch(p.label){case 0:return n=e.ids,r=e.session,o=(i=(0,t._)(this.api.state.stage(eE,{ids:n}),2))[0],a=i[1],[4,this.api.chort.queue.flush.rpc({ids:n,session:r})];case 1:if(!(s=p.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,v.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"delete",value:function(e){return(0,T._)(function(e){var n,r,i,o,a;return(0,h._)(this,function(s){switch(s.label){case 0:return n=e.ids,i=(r=(0,t._)(this.api.state.stage(eE,{ids:n}),2))[0],o=r[1],[4,this.api.chort.queue.delete.rpc({ids:n})];case 1:if(!(a=s.sent()).ok)return o(),[2,this.api.error(a)];return i(),[2,(0,v.Ok)(a.payload)]}})}).apply(this,arguments)}}]),e}(),eI=function(){function e(t){var n=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"sessions",void 0),(0,f._)(this,"queue",void 0),this.api=t,this.sessions={query:function(e){return new ey(n.api,e)},create:function(e){return n.api.createSession(e)},rollback:function(e){return n.api.revertToCommit(e)},get:function(e){return n.api.getSessionObservableById(e)},chat:{all:new ey(t,{types:[s.SessionType.CHAT]}),open:new ey(t,{types:[s.SessionType.CHAT],archived:!1}),archived:new ey(t,{types:[s.SessionType.CHAT],archived:!0})},agent:{all:new ey(t,{types:[s.SessionType.AGENT_SESSION]}),current:this.api.currentAgentSession,readonly:new ey(t,{types:[s.SessionType.AGENT_SESSION],readonly:!0})}},this.queue=new eR(this.api)}return(0,y._)(e,[{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({start:e})}}]),e}(),eC=e.i(693482),eO=e.i(452723),eA=e.i(346715),e_=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"hooks",{}),(0,f._)(this,"listeners",new H.ListenerList),this.api=t}return(0,y._)(e,[{key:"has",value:function(e){return void 0!==this.hooks[e]}},{key:"add",value:function(e,t){var n=this,r=this.hooks[e];r||(r=new Map,this.hooks[e]=r);var i=function(){r&&r.has(i)&&(r.delete(i),0===r.size&&(delete n.hooks[e],r=void 0),n.listeners.notify({kind:"hook-unregistered",type:e}))};return r.set(i,t),this.listeners.notify({kind:"hook-registered",type:e}),i}},{key:"trigger",value:function(e,t){var n=this.hooks[e];if(n){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,eA._)(n.values())[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var p=a.value;try{p(t)}catch(e){this.api.error(e)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}},{key:"subscribe",value:function(e){return this.listeners.add(e)}},{key:"dispose",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=Object.values(this.hooks)[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,p=void 0;try{for(var l,u=o.keys()[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)(0,l.value)()}catch(e){s=!0,p=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw p}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),ek=e.i(395266),eU=function(){function e(n){var r,i,o,a,p=this,l=n.connection,u=n.chortConnection,c=n.user,y=n.hasAdvancedModel,m=n.overrideModel,S=n.logger,E=n.onError;(0,d._)(this,e),(0,f._)(this,"connection",void 0),(0,f._)(this,"chortConnection",void 0),(0,f._)(this,"user",void 0),(0,f._)(this,"hasAdvancedModel",void 0),(0,f._)(this,"overrideModel",void 0),(0,f._)(this,"onError",void 0),(0,f._)(this,"hooks",void 0),(0,f._)(this,"disposed",!1),(0,f._)(this,"teardowns",new H.ListenerList),(0,f._)(this,"logger",void 0),(0,f._)(this,"status",void 0),(0,f._)(this,"connected",new g.Multicast(function(e){var t=null,n=p.teardowns.add(function(){null==t||t.abort(),t=null,e.complete()}),r=p.status.subscribe(function(n){"connected"!==n?(null==t||t.abort(),t=null,"closed"===n?e.complete():"error"===n&&e.error(Error("Connection error"))):t||(t=new AbortController,e.next(t.signal))});return function(){null==t||t.abort(),t=null,n(),r.unsubscribe()}})),(0,f._)(this,"closed",new g.Multicast(function(e){var t=p.teardowns.add(function(){e.next(),e.complete()}),n=p.status.subscribe(function(t){("closed"===t||"error"===t)&&(e.next(),e.complete())});return function(){t(),n.unsubscribe()}})),(0,f._)(this,"models",new g.Multicast(function(e){var n=0;return N.Observable.combine(p.connected,p.overrideModel).filter(function(e){return!(0,t._)(e,1)[0].aborted}).lift(e,function(r){var i=(0,t._)(r,2),o=i[0],a=i[1];return(0,T._)(function(){var t,r,i,p,l;return(0,h._)(this,function(u){switch(u.label){case 0:return t=++n,[4,this.service.getAvailableModels.rpc({overrideModel:null!=a?a:""})];case 1:if(r=u.sent(),n!==t||o.aborted||(0,v.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.error(r,e)];return i=r.payload.basicModel.map(function(e){return new ek.ChatModel({type:s.ModelType.BASIC,readable:e.readable,qualified:e.qualified})}),p=r.payload.advancedModel.map(function(e){return new ek.ChatModel({type:s.ModelType.ADVANCED,readable:e.readable,qualified:e.qualified})}),l=null,a&&r.payload.overrideModel&&r.payload.overrideModel.qualified===a&&(l=new ek.ChatModel({type:s.ModelType.OVERRIDE,readable:r.payload.overrideModel.readable,qualified:r.payload.overrideModel.qualified})),e.next({basic:i,advanced:p,override:l}),[2]}})}).call(p)})})),this.connection=l,this.chortConnection=null!=u?u:null,this.user=new ep.ObservableState(c),this.hasAdvancedModel=new ep.ObservableState(y),this.overrideModel=new ep.ObservableState(null!=m?m:null),this.logger=function(e){var t={},n="chatter: ";if(e.debug){var r=e.debug;t.debug=function(e,t){r(n+e,t)}}if(e.info){var i=e.info;t.info=function(e,t){i(n+e,t)}}if(e.warn){var o=e.warn;t.warn=function(e,t){o(n+e,t)}}if(e.error){var a=e.error;t.error=function(e,t){a(n+e,t)}}return t}(null!=S?S:{}),this.onError=E,this.hooks=new e_(this),this.teardown(function(){return p.hooks.dispose()});var b=new ep.ObservableState(ew(this.connection.status.current,null!=(a=null==(r=this.chortConnection)?void 0:r.status.current)?a:null));this.teardown(function(){"closed"!==b.current&&"error"!==b.current&&b.set("closed")}),this.status=b;var R=this.connection.status.subscribe(function(e){var t,n,r,i,o=null!=(i=null==(t=p.chortConnection)?void 0:t.status.current)?i:null;null==(n=(r=p.logger).info)||n.call(r,"connection status changed",{connectionStatus:e,chortConnectionStatus:o}),b.set(ew(e,o)),("closed"===e||"error"===e)&&p.dispose()});if(this.teardown(function(){return R.unsubscribe()}),this.chortConnection){var I=this.chortConnection.status.subscribe(function(e){var t,n,r=p.connection.status.current;null==(t=(n=p.logger).info)||t.call(n,"connection status changed",{connectionStatus:r,chortConnectionStatus:e}),b.set(ew(r,e)),("closed"===e||"error"===e)&&p.dispose()});this.teardown(function(){return I.unsubscribe()})}null==(i=(o=this.logger).info)||i.call(o,"API initialized")}return(0,y._)(e,[{key:"service",get:function(){return this.connection.service}},{key:"chort",get:function(){if(!this.chortConnection)throw Error("Chort connection is not set");return this.chortConnection.client}},{key:"error",value:function(e,t){var n=(0,v.Err)(e);if(!(0,v.isError)(n,"UNEXPECTED_DISCONNECT")&&!n.reported)if(n.reported=!0,this.onError){var r=null;(void 0===e?"undefined":(0,S._)(e))==="object"&&"payload"in e&&(r=n.payload),this.onError(n,r)}else setTimeout(function(){throw n},0);return t&&t.error(n),(0,v.isError)(n,"UNEXPECTED_DISCONNECT")?this.hooks.trigger("unexpected-disconnect",{error:n}):this.hooks.trigger("unhandled-exception",{error:n}),n}},{key:"teardown",value:function(e){return this.disposed?(e(),function(){}):this.teardowns.add(e)}},{key:"ping",value:function(){return(0,T._)(function(){var e,t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.service.pingPong.rpc({})];case 1:if(e=n.sent(),(0,v.isError)(e,"UNEXPECTED_DISCONNECT"))return[2,(0,v.Ok)(!1)];if(!e.ok)return[2,this.error(e)];if(!this.chortConnection)return[3,3];return[4,this.chort.debug.ping.rpc({})];case 2:if(t=n.sent(),(0,v.isError)(t,"UNEXPECTED_DISCONNECT"))return[2,(0,v.Ok)(!1)];if(!t.ok)return[2,this.error(t)];n.label=3;case 3:return[2,(0,v.Ok)(!0)]}})}).call(this)}},{key:"dispose",value:function(){if(!this.disposed){var e,t;this.disposed=!0,this.teardowns.notify(),this.teardowns.clear(),null==(t=this.logger)||null==(e=t.info)||e.call(t,"API disposed")}}},{key:"enhancePrompt",value:function(e,t){return(0,T._)(function(e){var t,n,r,i,o=arguments;return(0,h._)(this,function(a){switch(a.label){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:[],n=o.length>2&&void 0!==o[2]?o[2]:[],r=o.length>3?o[3]:void 0,[4,this.service.enhanceAgentPrompt.rpc({userPrompt:e,uploadedFiles:t,attachedUrls:n,selectedTheme:r||""})];case 1:if(!(i=a.sent()).ok)return[2,this.error(i)];return[2,(0,v.Ok)(i.payload.enhancedPrompt)]}})}).apply(this,arguments)}},{key:"generateReplName",value:function(e,t){return(0,T._)(function(){var n;return(0,h._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateReplName.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,v.Ok)(n.payload.replName)]}})}).call(this)}},{key:"getUrlScrapedContent",value:function(e){return(0,T._)(function(){var t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScrapedContent.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.content)]}})}).call(this)}},{key:"getUrlScreenshot",value:function(e){return(0,T._)(function(){var t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScreenshot.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.imageDownloadUrl)]}})}).call(this)}},{key:"getUrlBranding",value:function(e){return(0,T._)(function(){var t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlBranding.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload.branding)]}})}).call(this)}},{key:"generateReplIcon",value:function(e,t){return(0,T._)(function(){var n;return(0,h._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateIcon.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,v.Ok)(n.payload.imageUrl)]}})}).call(this)}},{key:"classifyInitialUserPrompt",value:function(e){return(0,T._)(function(e){var t,n,r=arguments;return(0,h._)(this,function(i){switch(i.label){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:[],[4,this.service.classifyInitialUserPrompt.rpc({userPrompt:e,uploadedFiles:t})];case 1:if(!(n=i.sent()).ok)return[2,this.error(n)];return[2,(0,v.Ok)(n.payload)]}})}).apply(this,arguments)}},{key:"uploadStackSelectionFile",value:function(e){return(0,T._)(function(e){var t,n,r,i,o,a,s,p,l,u,c,d,y,f,T,g,S,E;return(0,h._)(this,function(b){switch(b.label){case 0:t=e.fileName,n=e.mimeType,r=e.file;try{i=(0,ef._)(r,ArrayBuffer)?new Blob([r]).stream():r.stream()}catch(e){return[2,this.error(e)]}o=new AbortController,s=(a=this.chort.media.uploadStackSelectionFile.upload({fileName:t,mimeType:n},{signal:o.signal})).reqWritable,p=a.finalize,l=null,b.label=1;case 1:b.trys.push([1,14,,15]),u=!1,c=!1,b.label=2;case 2:var R;b.trys.push([2,7,8,13]),y=(0,m._)((R=i,(0,eO._)(function(){var e,t,n,r;return(0,h._)(this,function(i){switch(i.label){case 0:e=R.getReader(),i.label=1;case 1:i.trys.push([1,,6,7]),i.label=2;case 2:return[4,(0,eC._)(e.read())];case 3:if(n=(t=i.sent()).done,r=t.value,n)return[3,5];return[4,r];case 4:return i.sent(),[3,2];case 5:return[3,7];case 6:return e.releaseLock(),[7];case 7:return[2]}})})())),b.label=3;case 3:return[4,y.next()];case 4:if(!(u=!(f=b.sent()).done))return[3,6];if(T=f.value,o.signal.aborted)return l=Error("Upload aborted"),[3,6];try{s.write({chunk:T})}catch(e){return l=(0,ef._)(e,Error)?e:String(e),[3,6]}b.label=5;case 5:return u=!1,[3,3];case 6:return[3,13];case 7:return g=b.sent(),c=!0,d=g,[3,13];case 8:if(b.trys.push([8,,11,12]),!(u&&null!=y.return))return[3,10];return[4,y.return()];case 9:b.sent(),b.label=10;case 10:return[3,12];case 11:if(c)throw d;return[7];case 12:return[7];case 13:return[3,15];case 14:return S=b.sent(),l=(0,ef._)(S,Error)?S:String(S),o.abort(),[3,15];case 15:return[4,p()];case 16:if(E=b.sent(),l){if(o.signal.aborted||(0,ef._)(l,Error)&&l.message.includes("closed"))return[2,(0,v.Err)({code:"UPLOAD_CANCELLED",message:"Upload was cancelled"})];return[2,this.error(l)]}if(!E.ok)return[2,this.error(E)];return[2,(0,v.Ok)({url:E.payload.url,expires:E.payload.expires})]}})}).apply(this,arguments)}},{key:"getResourceUploadUrl",value:function(e){return(0,T._)(function(){var t;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.service.getResourceUploadUrl.rpc({mimeType:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,v.Ok)(t.payload)]}})}).call(this)}}]),e}();function ew(e,t){return null===t?e:"closed"===e||"closed"===t?"closed":"error"===e||"error"===t?"error":"disconnected"===e||"disconnected"===t?"disconnected":"connecting"===e||"connecting"===t?"connecting":"connected"}var eN=function(){function e(){(0,d._)(this,e),(0,f._)(this,"current",0),(0,f._)(this,"resolves",[])}return(0,y._)(e,[{key:"count",get:function(){return this.current}},{key:"increment",value:function(){this.current++}},{key:"decrement",value:function(){if(this.current--,this.current<0)throw this.current=0,Error("Reference count cannot be negative");for(;0===this.current&&this.resolves.length>0;){var e=this.resolves.shift();null==e||e()}}},{key:"drained",value:function(){return(0,T._)(function(){var e;return(0,h._)(this,function(t){switch(t.label){case 0:if(e=this,0!==this.current)return[3,2];return[4,Promise.resolve()];case 1:if(t.sent(),0===this.current)return[2];t.label=2;case 2:return[2,new Promise(function(t){e.resolves.push(t)})]}})}).call(this)}},{key:"scope",value:function(e){return(0,T._)(function(){return(0,h._)(this,function(t){switch(t.label){case 0:this.increment(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e()];case 2:return[2,t.sent()];case 3:return this.decrement(),[7];case 4:return[2]}})}).call(this)}}]),e}(),eD=function(){function e(n){var r=this;(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"queue",new Map),(0,f._)(this,"store",ea.events.store()),(0,f._)(this,"enqueued",null),(0,f._)(this,"events",new g.StatelessMulticast(function(e){var n=!1,i=r.api.closed.subscribe(function(){e.complete()});return r.enqueued=function(){n||(n=!0,(0,T._)(function(){var r,i,o,a,s,p,l,u,c,d,y,f,T,g,m,S,E,b,I,C,O,A,_,k,U,w,N,D,P,M,x,j,L,B,F,G,q,V,$,W,z,H,K,Y,Q,X,J,Z,ee,et,en,er,ei,eo,es,ep;return(0,h._)(this,function(h){switch(h.label){case 0:if(!this.queue.size)return[3,9];r=!0,i=!1,o=void 0,h.label=1;case 1:h.trys.push([1,6,7,8]),a=this.queue[Symbol.iterator](),h.label=2;case 2:if(r=(s=a.next()).done)return[3,5];if(l=(p=(0,t._)(s.value,2))[0],u=p[1],this.api.state.optimistic){y=[],f=!0,T=!1,g=void 0;try{for(m=u[Symbol.iterator]();!(f=(S=m.next()).done);f=!0)E=S.value,(b=this.api.state.isOptimisticEvent(E))&&(O=this.api.state.getOptimisticEvent(E),y.push(O),u.delete(E),null==(I=(C=this.api.logger).warn)||I.call(C,"materialized optimistic event",{sessionId:l,eventId:E,eventOptimisticType:b}))}catch(e){T=!0,g=e}finally{try{f||null==m.return||m.return()}finally{if(T)throw g}}if(y.length&&(this.store.untrack(y),e.next(y)),!u.size)return this.queue.delete(l),[3,4]}if(!ea.events.empty){A=[],_=!0,k=!1,U=void 0;try{for(w=u[Symbol.iterator]();!(_=(N=w.next()).done);_=!0)D=N.value,(P=ea.events.get(D))&&(A.push(P),u.delete(D))}catch(e){k=!0,U=e}finally{try{_||null==w.return||w.return()}finally{if(k)throw U}}A.length&&(this.store.untrack(A),e.next(A))}if(!u.size)return this.queue.delete(l),[3,4];return M=Date.now(),x=Array.from(u).slice(0,500),[4,this.api.service.batchGetEvents.rpc({sessionId:l,eventIds:x})];case 3:if(j=h.sent(),!n)return[2];if((0,v.isError)(j,"UNEXPECTED_DISCONNECT"))return[3,4];if(j.ok&&!j.payload.events.length){F=!0,G=!1,q=void 0;try{for(V=x[Symbol.iterator]();!(F=($=V.next()).done);F=!0)W=$.value,u.delete(W)}catch(e){G=!0,q=e}finally{try{F||null==V.return||V.return()}finally{if(G)throw q}}return u.size||this.queue.delete(l),this.store.untrack(x),null==(L=(B=this.api.logger).warn)||L.call(B,"detected infinite materialization loop",{sessionId:l,eventIds:x}),[3,4]}if(!j.ok){z=!0,H=!1,K=void 0;try{for(Y=x[Symbol.iterator]();!(z=(Q=Y.next()).done);z=!0)X=Q.value,u.delete(X)}catch(e){H=!0,K=e}finally{try{z||null==Y.return||Y.return()}finally{if(H)throw K}}return u.size||this.queue.delete(l),this.store.untrack(x),[2,this.api.error(j,e)]}J=j.payload.events,null==(d=this.api.logger)||null==(c=d.info)||c.call(d,"materialized events",{sessionId:l,duration:Date.now()-M,count:J.length}),this.api.hooks.trigger("events-materialized",{sessionId:l,duration:Date.now()-M,count:J.length}),Z=[],ee=!0,et=!1,en=void 0;try{for(er=J[Symbol.iterator]();!(ee=(ei=er.next()).done);ee=!0)eo=ei.value,(es=ea.events.get(eo.id))?eo=es:((0,R.applyEventOperations)(eo),ea.events.add(eo)),u.has(eo.id)&&(Z.push(eo),u.delete(eo.id))}catch(e){et=!0,en=e}finally{try{ee||null==er.return||er.return()}finally{if(et)throw en}}u.size||this.queue.delete(l),Z.length&&(this.store.untrack(Z),e.next(Z)),h.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return ep=h.sent(),i=!0,o=ep,[3,8];case 7:try{r||null==a.return||a.return()}finally{if(i)throw o}return[7];case 8:return[3,0];case 9:return n=!1,[2]}})}).call(r).catch(function(t){return e.error(t)}))},r.queue.size&&r.enqueued(),function(){n=!1,r.enqueued=null,i.unsubscribe()}})),this.api=n}return(0,y._)(e,[{key:"enqueue",value:function(e,t){if(t.length){var n=this.queue.get(e);n||(n=new Set,this.queue.set(e,n));var r=!0,i=!1,o=void 0;try{for(var a,s,p=t[Symbol.iterator]();!(r=(s=p.next()).done);r=!0){var l=s.value;n.add(l)}}catch(e){i=!0,o=e}finally{try{r||null==p.return||p.return()}finally{if(i)throw o}}this.store.track(t),null==(a=this.enqueued)||a.call(this)}}},{key:"materialize",value:function(e,t){return(0,T._)(function(){var n,r,i,o,a,s,p,l,u,c,d,y,f,T,g,v,m;return(0,h._)(this,function(h){switch(h.label){case 0:n=this,r=new Set(t),i=ea.events.store(t),o=!0,a=!1,s=void 0;try{for(p=i[Symbol.iterator]();!(o=(l=p.next()).done);o=!0)u=l.value,r.delete(u.id)}catch(e){a=!0,s=e}finally{try{o||null==p.return||p.return()}finally{if(a)throw s}}if(!r.size)return[3,2];return this.enqueue(e,Array.from(r)),[4,new Promise(function(e,t){var o=n.events.subscribe({next:function(t){var n=!0,i=!1,a=void 0;try{for(var s,p=t[Symbol.iterator]();!(n=(s=p.next()).done);n=!0){var l=s.value;r.has(l.id)&&r.delete(l.id)}}catch(e){i=!0,a=e}finally{try{n||null==p.return||p.return()}finally{if(i)throw a}}r.size||(o.unsubscribe(),e())},error:function(e){i.release(),t(e)},complete:function(){i.release(),t(new N.CompletionError)}})})];case 1:h.sent(),h.label=2;case 2:c=[],d=!0,y=!1,f=void 0;try{for(T=t[Symbol.iterator]();!(d=(g=T.next()).done);d=!0){if(v=g.value,!(m=this.get(v)))throw i.release(),this.api.error("Unexpected missing event");c.push(m)}}catch(e){y=!0,f=e}finally{try{d||null==T.return||T.return()}finally{if(y)throw f}}return i.release(),[2,c]}})}).call(this)}},{key:"get",value:function(e){return this.api.state.isOptimisticEvent(e)?this.api.state.getOptimisticEvent(e):ea.events.get(e)}}]),e}(),eP=function(e){function t(e){var n;if((0,d._)(this,t),!e.replId)throw Error("Chatter API is disabled");return n=(0,U._)(this,t,[e]),(0,f._)(n,"replId",void 0),(0,f._)(n,"materializer",void 0),(0,f._)(n,"state",void 0),(0,f._)(n,"queryFetchCounter",void 0),(0,f._)(n,"sessionObservables",new Map),(0,f._)(n,"currentAgentSession",new g.Multicast(function(e){var t=!1,r="",i=null,o=function(t){return(0,T._)(function(){var r,o,a,s;return(0,h._)(this,function(p){switch(p.label){case 0:if(null==i||i.abort(),!t)return[2,e.next(null)];if(r=ea.sessions.get(t))return e.next(ec.create(n,t,r.created)),i=null,[2];return o=(i=new AbortController).signal,[4,n.service.getSessionEvents.rpc({excludeContents:!0,sessionId:t,limit:1})];case 1:if(a=p.sent(),o.aborted||(0,v.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];return a.payload.session.events=[],i=null,s=ea.sessions.emplace(a.payload.session),e.next(ec.create(n,t,s.created)),[2]}})})()},a=n.state.updates.filter(function(e){return"agent-state-modified"===e.kind}).select(function(e){return e.session}).lift(e,function(e){r!==e&&(r=e,o(e))}),p=n.connected.lift(e,function(i){return(0,T._)(function(){var a,p,l,u,c,d,y,f,T,g;return(0,h._)(this,function(h){switch(h.label){case 0:return[4,n.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:5,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:n.replId,sessionTypes:[s.SessionType.AGENT_SESSION],archived:void 0})];case 1:if(a=h.sent(),i.aborted||(0,v.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];p=!0,l=!1,u=void 0;try{for(c=a.payload.sessions[Symbol.iterator]();!(p=(d=c.next()).done);p=!0)(y=d.value).events=[],ea.sessions.emplace(y)}catch(e){l=!0,u=e}finally{try{p||null==c.return||c.return()}finally{if(l)throw u}}return f=a.payload.replAgentState.activeAgentSessionId,T=a.payload.sessions.filter(function(e){return!e.readOnly}).sort(function(e,t){return t.created.getTime()-e.created.getTime()})[0],g=f||(null==T?void 0:T.id)||"",r===g&&t||(t=!0,r=g,o(g)),[2]}})})()});return function(){null==i||i.abort(),a.unsubscribe(),p.unsubscribe()}})),n.replId=e.replId,n.materializer=new eD(n),n.state=new em(n),n.queryFetchCounter=new eN,n}return(0,w._)(t,e),(0,y._)(t,[{key:"getSessionObservableById",value:function(e){var t=this,n=this.sessionObservables.get(e);return n||(n=new g.Multicast(function(n){var r=null,i=ea.sessions.get(e);i?n.next(ec.create(t,e,i.created)):r=t.connected.lift(n,function(i){return(0,T._)(function(){var t,o;return(0,h._)(this,function(a){switch(a.label){case 0:return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:e,limit:1})];case 1:if(t=a.sent(),i.aborted||(0,v.isError)(t,"UNEXPECTED_DISCONNECT"))return[2];if(!t.ok)return[2,this.error(t,n)];return t.payload.session.events=[],o=ea.sessions.emplace(t.payload.session),n.next(ec.create(this,e,o.created)),null==r||r.unsubscribe(),r=null,[2]}})}).call(t)});var o=t.teardown(function(){n.complete()});return function(){null==r||r.unsubscribe(),o()}}),this.sessionObservables.set(e,n)),n}},{key:"createSession",value:function(e){return(0,T._)(function(){var t,n,r;return(0,h._)(this,function(i){switch(i.label){case 0:return t=(0,O.createSessionRequest)((0,eh._)((0,eT._)({},e),{replId:this.replId})),[4,this.service.createSession.rpc(t)];case 1:if(!(n=i.sent()).ok)return[2,this.error(n)];return r=ec.create(this,n.payload.sessionId,new Date),this.hooks.trigger("client-created-session",{session:r,request:t}),[2,(0,v.Ok)(r)]}})}).call(this)}},{key:"revertToCommit",value:function(e){return(0,T._)(function(){var t,n,r,i,o,a,s,p,l,u;return(0,h._)(this,function(c){switch(c.label){case 0:return r=(0,eT._)({replId:this.replId,databaseRollbackTimestamp:null!=(t=e.databaseRollbackTimestamp)?t:"",deploymentBuildId:null!=(n=e.deploymentBuildId)?n:""},e),[4,this.service.revertToCommit.rpc(r)];case 1:if(!(i=c.sent()).ok)return[2,this.error(i)];if(o=i.payload.revertedSessionId,a=ea.sessions.get(o))return s=ec.create(this,o,a.created),this.hooks.trigger("client-reverted-session",{session:s,request:r}),[2,(0,v.Ok)(s)];return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:o,limit:1})];case 2:if(!(p=c.sent()).ok)return[2,this.error(p)];return p.payload.session.events=[],l=ea.sessions.emplace(p.payload.session),u=ec.create(this,o,l.created),this.hooks.trigger("client-reverted-session",{session:u,request:r}),[2,(0,v.Ok)(u)]}})}).call(this)}},{key:"createUsageWatcher",value:function(e){var t=this,n=e.sessionId,r=e.start;return new g.Multicast(function(e){return t.connected.lift(e,function(i){return(0,T._)(function(){var t,o,a,s,p,l,u,c;return(0,h._)(this,function(d){switch(d.label){case 0:t=this.chort.agent.watchUsage.subscribe({sessionId:n,start:r},{signal:i}).resReadable,o=!1,a=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),p=(0,m._)(t),d.label=2;case 2:return[4,p.next()];case 3:if(!(o=!(l=d.sent()).done))return[3,5];if(u=l.value,(0,v.isError)(u,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!u.ok)return[2,this.error(u,e)];e.next({cents:u.payload.cents}),d.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return c=d.sent(),a=!0,s=c,[3,12];case 7:if(d.trys.push([7,,10,11]),!(o&&null!=p.return))return[3,9];return[4,p.return()];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(t)})})}}]),t}(eU),eM=function(){function e(t){(0,d._)(this,e),(0,f._)(this,"api",void 0),(0,f._)(this,"_chatter",void 0),t.replId?(this.api=new eP(t),this._chatter=new eI(this.api)):(this.api=new eU(t),this._chatter=null)}return(0,y._)(e,[{key:"chatter",value:function(){if(!this._chatter)throw Error("Chatter API is disabled");return this._chatter}},{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"status",get:function(){return this.api.status}},{key:"user",get:function(){return this.api.user}},{key:"hasAdvancedModel",get:function(){return this.api.hasAdvancedModel}},{key:"overrideModel",get:function(){return this.api.overrideModel}},{key:"models",get:function(){return this.api.models}},{key:"enhancePrompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;return this.api.enhancePrompt(e,t,n,r)}},{key:"getUrlScrapedContent",value:function(e){return this.api.getUrlScrapedContent(e)}},{key:"getUrlScreenshot",value:function(e){return this.api.getUrlScreenshot(e)}},{key:"getUrlBranding",value:function(e){return this.api.getUrlBranding(e)}},{key:"generateReplName",value:function(e,t){return this.api.generateReplName(e,t)}},{key:"generateReplIcon",value:function(e,t){return this.api.generateReplIcon(e,t)}},{key:"classifyInitialUserPrompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.api.classifyInitialUserPrompt(e,t)}},{key:"uploadStackSelectionFile",value:function(e){return this.api.uploadStackSelectionFile(e)}},{key:"getResourceUploadUrl",value:function(e){return this.api.getResourceUploadUrl(e)}},{key:"dispose",value:function(){this.api.dispose()}}]),e}(),ex=e.i(98816),ej=e.i(664152),eL=e.i(814563);e.i(925218);var eB=e.i(641555),eF=(0,a.atom)({hasAccessToAdvancedModel:!1,defaultAssistantChatMode:"basic",defaultAssistantInlineMode:"basic"});function eG(){return(0,c.useValue)(eF)}function eq(){var e=(0,c.useYapper)();return(0,eB.useObservableMemo)(function(){return e.status.map(function(e){return"connected"===e})},[e],{default:!1})}function eV(){var e=(0,c.useYapper)();return(0,eB.useObservableMemo)(function(){return e.status.map(function(e){return"error"===e})},[e],{default:!1})}var e$=(0,eL.atomWithDefault)(function(e){return e(eF).defaultAssistantChatMode}),eW=(0,eL.atomWithDefault)(function(e){return e(eF).defaultAssistantInlineMode});e.s(["assistantChatModeAtom",()=>e$,"assistantInlineModeAtom",()=>eW,"configAtom",()=>eF,"useConfig",()=>eG,"useIsAiClientConnected",()=>eq,"useIsRiverProtocolError",()=>eV],51553);var ez=e.i(61524),eH=(0,a.atom)(!1);function eK(){return(0,c.useValue)(eH)}function eY(e){var d,y,f,T,h,g,v,m,S,E,b,R,I,C,O,A,_,k,U,w,N,D,P,M,x,j,L,B,F=e.replId,G=e.currentUser,q=e.hasAccessToAdvancedModel,V=e.children,$=e.mockStore,W=e.mockYapper,z=e.orgId,H=e.renderEmptyState,K=(y=(d={replId:F,currentUser:G,hasAccessToAdvancedModel:q,mockStore:$,mockYapper:W,orgId:z}).replId,f=d.currentUser,T=d.orgId,h=d.hasAccessToAdvancedModel,g=d.mockStore,v=d.mockYapper,m=(0,ez.usePreferences)("assistantAdvancedModelOverride").preferences.assistantAdvancedModelOverride,S=(0,u.useCreateChatConnection)({replId:y,currentUserId:f.id,orgId:T,onProtocolError:function(e){(0,p.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){(0,i.flushSync)(function(){return b.set(eH,!0)}),o.captureException("Chat service connection retries exhausted in AiProvider"),(0,p.sendErrorToSentry)(e.message,{code:e.type})}}),E=(0,l.useCreateChortRiverConnection)({replId:y,userId:f.id,onProtocolError:function(e){(0,p.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){(0,p.sendErrorToSentry)(e.message,{code:e.type})}}),b=(0,t._)((0,r.useState)(function(){return g&&console.error("mockStore in only meant for tests or development, not production"),null!=g?g:(0,a.createStore)()}),1)[0],R=f.id,I=f.timeCreated,(0,r.useEffect)(function(){b.set(eF,{hasAccessToAdvancedModel:h,defaultAssistantChatMode:h?"advanced":"basic",defaultAssistantInlineMode:h?"advanced":"basic"})},[b,h,m]),O=(C={connection:S,chortConnection:E,replId:y,user:(0,r.useMemo)(function(){return{id:R.toString(),type:s.UserType.USER,isTeam:!1,roles:[],membership:h?s.MembershipType.CORE:s.MembershipType.FREE,orgId:"",username:"",timeCreated:new Date(I),flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1}},[R,h,I]),hasAdvancedModel:h,overrideModel:m||null,onError:function(e,t){setTimeout(function(){(0,p.sendErrorToSentry)(e,null!=t?t:void 0)})}}).connection,A=C.chortConnection,_=C.replId,k=C.user,U=C.hasAdvancedModel,N=void 0===(w=C.overrideModel)?null:w,D=C.onError,M=(P=(0,t._)((0,r.useState)(null),2))[0],x=P[1],j=(0,ex.default)(D),L=!!D,(0,r.useEffect)(function(){if(O&&A){var e=new eM({connection:O,chortConnection:A,replId:_,user:k,hasAdvancedModel:U,overrideModel:N,logger:ej.logger,onError:L?function(e,t){var n;return null==(n=j.current)?void 0:n.call(j,e,t)}:void 0});return x(e),function(){x(null),Promise.resolve().then(function(){return e.dispose()})}}},[O,A,_,L]),(0,r.useEffect)(function(){M&&(M.user.current!==k&&M.user.set(k),M.hasAdvancedModel.current!==U&&M.hasAdvancedModel.set(U),M.overrideModel.current!==N&&M.overrideModel.set(null!=N?N:null))},[M,k,U,N]),B=M,{store:b,yapper:null!=v?v:B}),Y=K.store,Q=K.yapper;return Q?(0,n.jsx)(c.StoreProvider,{store:Y,yapper:Q,children:V}):(0,n.jsx)(void 0===H?function(){return null}:H,{})}function eQ(){var e=(0,c.useValue)(e$),t=(0,c.useSet)(e$),n=(0,c.useGet)(e$),i=(0,r.useCallback)(function(){return"basic"===n()?s.MessageAction.NONE:s.MessageAction.ITERATIVE_AGENT},[n]),o=(0,r.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n();return e.isAuthorized?"advanced"===t?s.ModelType.ADVANCED:s.ModelType.BASIC:s.ModelType.MODEL_TYPE_UNKNOWN},[n]);return{assistantMode:e,setAssistantMode:t,getAssistantMode:n,getAssistantMessageIntent:i,getAssistantMessageModel:o}}function eX(){return{assistantInlineMode:(0,c.useValue)(eW)}}e.s(["AiProvider",()=>eY,"useIsRiverRetryBudgetExceeded",()=>eK],204203),e.s(["useAssistantChatMode",()=>eQ,"useAssistantInlineMode",()=>eX],970187);var eJ=e.i(629536),eZ=e.i(55796),e0=e.i(267103),e1=e.i(993796);function e2(){var e=eQ().assistantMode,t=e3(),n=t.basicModel,r=t.advancedModel,i=t.overrideModel;return null!=i?i:"advanced"===e?r:n}function e3(){var e=(0,c.useYapper)(),n=(0,e0.useObservable)(e.models),i=e4();return(0,r.useMemo)(function(){var e,r,o=(0,t._)(null!=(e=null==n?void 0:n.basic)?e:[],1)[0],a=null!=(r=null==n?void 0:n.advanced)?r:[],s=null==n?void 0:n.override,p=a.find(function(e){return e.name.readable===(null==i?void 0:i.readable)}),l=(0,t._)(a.filter(function(e){return e.name.readable!==(null==i?void 0:i.readable)}),1)[0],u=(0,eZ.isGhostwriterChatModelName)(null==l?void 0:l.name)?l:eJ.CHAT_ENGINE_DEFAULT_MODELS.advanced,c=(0,eZ.isGhostwriterChatModelName)(null==s?void 0:s.name)?s:void 0;return{basicModel:(0,eZ.isGhostwriterChatModelName)(null==o?void 0:o.name)?o:eJ.CHAT_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eZ.isGhostwriterChatModelName)(null==p?void 0:p.name)?p:u,overrideModel:c}},[n,i])}function e4(){var e=(0,e1.useFlag)({controlName:"flag-assistant-advanced-model",type:"string",default:eJ.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified});return(0,r.useMemo)(function(){return(0,eZ.getModelNameFromQualified)(e)},[e])}function e6(){var e=(0,c.useYapper)(),n=(0,e0.useObservable)(e.models);return(0,r.useMemo)(function(){var e,r,i=(0,t._)(null!=(e=null==n?void 0:n.basic)?e:[],1)[0],o=(null!=(r=null==n?void 0:n.advanced)?r:[]).filter(function(e){return e.name.qualified!==eJ.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified})[0];return{basicModel:(0,eZ.isGhostwriterChatModelName)(null==i?void 0:i.name)?i:eJ.INLINE_ACTION_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eZ.isGhostwriterChatModelName)(null==o?void 0:o.name)?o:eJ.INLINE_ACTION_ENGINE_DEFAULT_MODELS.advanced,overrideModel:void 0}},[n])}function e8(e){var t=e.isSubscribed;return!(0,e1.useFlag)({controlName:"flag-assistant-sunset-free"})||t}e.s(["useChatEngine",()=>e2,"useChatEngineModels",()=>e3,"usePreferredAdvancedModelName",()=>e4],765695),e.s(["useInlineActionModels",()=>e6],334712),e.i(17886),e.s(["useHasAssistant",()=>e8],545525);var e5=(0,a.atom)(null);function e9(){return(0,c.useValue)(e5)}function e7(){return(0,c.useGet)(e5)}function te(){var e=(0,c.useSet)(e5);return(0,r.useCallback)(function(t){return e(t)},[e])}var tt=(0,a.atom)(void 0),tn=(0,a.atom)(void 0);function tr(){return(0,c.useValue)(tt)}function ti(){var e=(0,c.useSet)(tt);return(0,r.useCallback)(function(t){return e(t)},[e])}function to(){var e=(0,c.useSet)(tn);return(0,r.useCallback)(function(t){return e(t)},[e])}var ta=(0,a.atom)(void 0);function ts(){var e=(0,c.useGet)(ta);return(0,r.useCallback)(function(){return e()},[e])}function tp(){var e=(0,c.useSet)(ta);return(0,r.useCallback)(function(){return e(void 0)},[e])}e.s(["useAgentPlanApprovalState",()=>e9,"useClearPlanProposalUserSecretsResponse",()=>tp,"useGetAgentPlanApprovalState",()=>e7,"useGetPlanProposalUserSecretsResponse",()=>ts,"useProposedPlan",()=>tr,"useSetAgentPlanApprovalState",()=>te,"useSetApprovedPlan",()=>to,"useSetProposedPlan",()=>ti],145864);var tl=(0,a.atom)(!1);function tu(){return(0,c.useValue)(tl)}function tc(){var e=(0,c.useSet)(tl);return(0,r.useCallback)(function(t){return e(t)},[e])}e.s(["useAgentPausedByUser",()=>tu,"useSetAgentPausedByUser",()=>tc],165680);var td=e.i(63846),ty=e.i(299314),tf=e.i(416143);function tT(e,t){var n,r,i=(n=(0,td.getAiEndpoint)(),r=window.location.host.startsWith("staging")||n===tf.AiEndpoints.development||n===tf.AiEndpoints.staging,t===s.SessionType.AGENT_SESSION?r?"2a95b8aa-201c-481e-8ee3-858a19efdc53":"430ef9d3-abfe-4318-8a6d-4cadfe35d0ce":r?"c50da37d-4044-4795-b28e-8e1d21473f96":"cf9ea4d0-b92a-4076-b8f9-44441d907f6a"),o="".concat("https://smith.langchain.com","/o/").concat("ed54f928-4630-409b-b66a-947e0fbac288","/projects/p/").concat(i),a=encodeURIComponent('{"duration":"7d"}'),p=(0,ty.stringify)({timeModel:a,searchModel:'{"filter":"and(eq(is_root, true), and(eq(metadata_key, \\"session_id\\"), eq(metadata_value, \\"'.concat(e,'\\")))"}')});return"".concat(o,"?").concat(p)}function th(e){var t,n=(0,td.getAiEndpoint)(),r="https://cloud.temporal.io";switch(n){case tf.AiEndpoints.development:r="http://localhost:8233",t="default";break;case tf.AiEndpoints.staging:t="staging.ndbzr";break;case tf.AiEndpoints.production:default:t="production.ndbzr"}var i="".concat(r,"/namespaces/").concat(t,"/workflows"),o=(0,ty.stringify)({query:'session_id = "'.concat(e,'"')});return"".concat(i,"?").concat(o)}function tg(e){switch((0,td.getAiEndpoint)()){case tf.AiEndpoints.development:t="5ad850f0-3a1a-4980-b889-d21d4116b5d7";break;case tf.AiEndpoints.staging:t="45b3aed2-3dde-4f0d-a22c-9af69ee8508e";break;case tf.AiEndpoints.production:default:t="ce8b1d97-5fef-4a21-bc60-8910fa6852d5"}var t,n=["f=is_root:eq:true","f=metadata.session_id:eq:".concat(encodeURIComponent(e))];return"".concat("https://traceforge.app","/projects/").concat(t,"?").concat(n.join("&"),"&t=1d")}function tv(e){switch((0,td.getAiEndpoint)()){case tf.AiEndpoints.development:t="development";break;case tf.AiEndpoints.staging:t="staging";break;case tf.AiEndpoints.production:default:t="production"}var t,n="agent-".concat(t),r='is_root AND metadata.session_id = "'.concat(e,'"'),i=JSON.stringify({filter:[{label:r,text:r,originType:"btql"}]}),o=(0,ty.stringify)({qs:"spans",search:i});return"".concat("https://www.braintrust.dev/app/ai-replit","/p/").concat(n,"/logs?").concat(o)}function tm(e){return"https://us5.datadoghq.com/logs?query=%40replid%3A".concat(e)}function tS(e){return"https://us5.datadoghq.com/apm/traces?query=%40replid%3A".concat(e)}function tE(){return!0}e.s(["generateAiSessionBraintrustUrl",()=>tv,"generateAiSessionDatadogTracesUrl",()=>tS,"generateAiSessionDatadogUrl",()=>tm,"generateAiSessionLangSmithUrl",()=>tT,"generateAiSessionTemporalUrl",()=>th,"generateAiSessionTraceforgeUrl",()=>tg],805763),e.s(["useSupportsAgent",()=>tE],877212)}]);

//# debugId=42301948-a6b1-107f-64d1-51c7d798ef60
//# sourceMappingURL=c9cee657a1ab52f6.js.map